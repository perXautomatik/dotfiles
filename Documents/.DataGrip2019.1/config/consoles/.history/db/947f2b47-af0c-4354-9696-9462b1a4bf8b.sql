begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select * from #Socken_tillstånd)
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                           FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                           FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran), rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * from rod
        --insert into #Rud

INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select * from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                           FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                           FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran), rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * from rod
        --insert into #Rud

INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                           FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                           FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran), rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * from rod
        --insert into #Rud

INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran), rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * from rod
        --insert into #Rud

INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
     , rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * from rod
        --insert into #Rud

--INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
     , rod as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * insert into #Rud from rod ;

--INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,
     rod as (select socken,
                    fastighet,
                    Fastighet_tillstand,
                    Byggnadstyp,
                    Beslut_datum,
                    utförddatum,
                    Anteckning,
                    VaPlan,
                    egetOmhändertangandeInfo,
                    slam,
                    flaggnr,
                    flagga,
                    (case
                         when fstatus = N'röd' then (case
                                                         when (vaPlan is null and egetOmhändertangandeInfo is null)
                                                             then N'röd'
                                                         else (case
                                                                   when VaPlan is not null then 'KomV?'
                                                                   else (case when null is not null then 'gem' else '?' end) end) end)
                         else fstatus end) Fstatus
             from q)
insert into #Rud
select *  from rod

--INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,
     rod as (select socken,
                    fastighet,
                    Fastighet_tillstand,
                    Byggnadstyp,
                    Beslut_datum,
                    utförddatum,
                    Anteckning,
                    VaPlan,
                    egetOmhändertangandeInfo,
                    slam,
                    flaggnr,
                    flagga,
                    (case
                         when fstatus = N'röd' then (case
                                                         when (vaPlan is null and egetOmhändertangandeInfo is null)
                                                             then N'röd'
                                                         else (case
                                                                   when VaPlan is not null then 'KomV?'
                                                                   else (case when null is not null then 'gem' else '?' end) end) end)
                         else fstatus end) Fstatus
             from q)
insert into #Rud select * from rod

--INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer)

-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor                                   goto SockenYtor  end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken     goto ByggnadPåFastighetISocken end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd                       goto Socken_tillstånd  end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande                 goto egetOmhändertagande  end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten                                   goto spillvaten  end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam                                               goto taxekod  end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam
IF OBJECT_ID(N'tempdb..#Rud') IS NULL
    INSERT INTO @statusTable select 'GoingToRud',CURRENT_TIMESTAMP,0
    goto röd

    --(exists(select 1 from #Rud)) begin drop table #Rud
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


--if (select 1) IS NULL BEGIN Drop table #SockenYtor Drop table #ByggnadPåFastighetISocken Drop table #Socken_tillstånd Drop table #egetOmhändertagande Drop table #spillvaten Drop table #slam Drop table #Rud INSERT INTO @statusTable select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT goto TableInitiate

INSERT INTO @statusTable select '#PastDropBoutToSockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1 INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
 röd:
with slamm as (select strFastBeteckningHel,
                      strDelprodukt,
                      z2 = STUFF((SELECT distinct ',' + concat(nullif(x.strTaxebenamning, ''), nullif(
                                                    concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                'yyyy-MM-dd')), ' Avbrutet:')) as c3x
                                  FROM #slam x
                                  where q.strFastBeteckningHel = x.strFastBeteckningHel
                                  FOR XML PATH ('')), 1, 1, '')
               FROM #slam q
               group by strFastBeteckningHel, strDelprodukt),
     slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ',' + nullif(strDelprodukt + '|', '|') + z2 as ne FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')
              from slamm q group by strFastBeteckningHel),
     socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp, ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet, typ from #spillvaten),
     egetOmhandertagande as (select fastighet, egetOmhändertangandeInfo, LocaltOmH from #egetOmhändertagande),
     --anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
     anlaggningar as (select *,'' fstatus from #Socken_tillstånd),
     attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr
                       from (select anlaggningar.diarienummer,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus
                                         else '?' end)       fstatus,
                                    socknarOfInteresse.socken,
                                    socknarOfInteresse.fastighet,
                                    Byggnadstyp,
                                    Fastighet_tillstand,
                                    Beslut_datum,
                                    utförddatum,
                                    Anteckning,
                                    (case
                                         when anlaggningar.anlaggningspunkt is not null
                                             then anlaggningar.anlaggningspunkt
                                         else ByggShape end) flagga
                             from socknarOfInteresse
                                      left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet
                                      left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q
                       where q.flagga is not null),
     q as (select attUtsokaFran.socken,
                  attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,
     rod as (select socken,
                    fastighet,
                    Fastighet_tillstand,
                    Byggnadstyp,
                    Beslut_datum,
                    utförddatum,
                    Anteckning,
                    VaPlan,
                    egetOmhändertangandeInfo,
                    slam,
                    flaggnr,
                    flagga,
                    (case
                         when fstatus = N'röd' then (case
                                                         when (vaPlan is null and egetOmhändertangandeInfo is null)
                                                             then N'röd'
                                                         else (case
                                                                   when VaPlan is not null then 'KomV?'
                                                                   else (case when null is not null then 'gem' else '?' end) end) end)
                         else fstatus end) Fstatus
             from q)
select * into #Rud from rod

--INSERT INTO @statusTable select N'rebuilt#Rud',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Rud' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

      --  select * from #Rud where Socken = N'Björke'
       -- select * from #Rud where Socken = 'Dalhem'
      -- select * from #Rud where Socken = N'Fröjel'
       -- select * from #Rud where Socken = 'Ganthem'
      -- select * from #Rud where Socken = 'Halla'
       -- select * from #Rud where Socken = 'Klinte'
       -- select * from #Rud where Socken = 'Roma'

    --end try begin catch select * from @statusTable end catch
taxekod:

select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape INTO #SockenYtor
    from [sde_gsd].[gng].AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT ;Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),'yyyy-MM-dd')), ' Avbrutet:'))FROM #slam x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
             ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
             , socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
           ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                   attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                           FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                           FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga

                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)

select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape INTO #SockenYtor
    from [sde_gsd].[gng].AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT ;Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),'yyyy-MM-dd')), ' Avbrutet:'))FROM #slam x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
             ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
             , socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
           ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                   attUtsokaFran.fastighet,
                                                           attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                                                           attUtsokaFran.Byggnadstyp,
                                                            Beslut_datum,
                                                            utförddatum "utförddatum",
                                                       --    FORMAT(attUtsokaFran.Beslut_datum, 'yyyy-MM-dd') Beslut_datum,
                                                         --  FORMAT(attUtsokaFran.utförddatum,'yyyy-MM-dd') "utförddatum",
                                                           attUtsokaFran.Anteckning,
                                VaPlan                   = (select top 1 typ
                                                            from vaPlan
                                                            where vaPlan.fastighet = attUtsokaFran.fastighet),
                                                           fstatus,
                                egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                                            from egetOmhandertagande
                                                            where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                                slam                     = (select top 1 datStoppdatum
                                                            from slam
                                                            where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                                                           flaggnr,
                                                           flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)

select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape INTO #SockenYtor
    from [sde_gsd].[gng].AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT ;Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),'yyyy-MM-dd')), ' Avbrutet:'))FROM #slam x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
             ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
             , socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
           ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                                attUtsokaFran.Beslut_datum,
                                attUtsokaFran.utförddatum,
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape INTO #SockenYtor
    from [sde_gsd].[gng].AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT ;Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),'yyyy-MM-dd')), ' Avbrutet:'))FROM #slam x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
             ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
             , socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
           ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)),'yyyy-MM-dd')), ' Avbrutet:'))FROM #slam x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
             ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
             , socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
           ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''),
nullif(
                                        concat(' Avbrutet:', FORMAT(nullif(x.q2z,
smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                            'yyyy-MM-dd')), ' Avbrutet:'))
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not( isnull(Beslut_datum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum) and isnull(utförddatum, DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) > (select DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) datum)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat( nullif(x.strTaxebenamning,''),
nullif(
                                        concat(' Avbrutet:', FORMAT(nullif(x.q2z,
smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                            'yyyy-MM-dd')), ' Avbrutet:'))
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 FROM slamm x  where q.strFastBeteckningHel = x.strFastBeteckningHel  FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd),
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''),
                                                                                            nullif(
                                                                  concat(' Avbrutet:', FORMAT(nullif(x.q2z,
                          smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                                      'yyyy-MM-dd')), ' Avbrutet:')) as c3s
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 as nadas
                                                           FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:
select * from @statusTable


end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport

INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''),
                                                                                            nullif(
                                                                  concat(' Avbrutet:', FORMAT(nullif(x.q2z,
                          smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                                      'yyyy-MM-dd')), ' Avbrutet:')) as c3s
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 as nadas
                                                           FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:


select * from @statusTable
end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
INSERT INTO @statusTable select '#initiating#sockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
INSERT INTO @statusTable select '#initiating#Byggnader',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
INSERT INTO @statusTable select '#initiating#sockenTillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
INSERT INTO @statusTable select '#initiating#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
INSERT INTO @statusTable select '#initiating#Spillvatten',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
INSERT INTO @statusTable select '#initiating#slam',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
INSERT INTO @statusTable select '#initiating#röd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport



if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate;
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''),
                                                                                            nullif(
                                                                  concat(' Avbrutet:', FORMAT(nullif(x.q2z,
                          smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                                      'yyyy-MM-dd')), ' Avbrutet:')) as c3s
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 as nadas
                                                           FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:


select * from @statusTable
end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT;
INSERT INTO @statusTable select '#initiating#sockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
INSERT INTO @statusTable select '#initiating#Byggnader',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
INSERT INTO @statusTable select '#initiating#sockenTillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
INSERT INTO @statusTable select '#initiating#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
INSERT INTO @statusTable select '#initiating#Spillvatten',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
INSERT INTO @statusTable select '#initiating#slam',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
INSERT INTO @statusTable select '#initiating#röd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
goto repport



if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''),
                                                                                            nullif(
                                                                  concat(' Avbrutet:', FORMAT(nullif(x.q2z,
                          smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                                      'yyyy-MM-dd')), ' Avbrutet:')) as c3s
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 as nadas
                                                           FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:


select * from @statusTable
end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
;-- -. . -..- - / . -. - .-. -.--
Drop table #röd
;-- -. . -..- - / . -. - .-. -.--
Drop table #spillvaten
;-- -. . -..- - / . -. - .-. -.--
begin try
declare @statusTable table(one NVARCHAR(max),start datetime,rader integer);


-- dropTabels?
TableInitiate:
INSERT INTO @statusTable select '#initiating',CURRENT_TIMESTAMP,@@ROWCOUNT;
INSERT INTO @statusTable select '#initiating#sockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#SockenYtor')                     IS NULL goto SockenYtor else begin if not                   (exists(select 1 from #SockenYtor)) begin drop table #SockenYtor;                                  goto SockenYtor; end end INSERT INTO @statusTable select 'preloading#SockenYtor',CURRENT_TIMESTAMP,count(*) from #SockenYtor;
INSERT INTO @statusTable select '#initiating#Byggnader',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#ByggnadPåFastighetISocken')     IS NULL goto ByggnadPåFastighetISocken else begin if not    (exists(select 1 from #ByggnadPåFastighetISocken)) begin drop table #ByggnadPåFastighetISocken;    goto ByggnadPåFastighetISocken;end end INSERT INTO @statusTable select 'preloading#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,count(*) from #ByggnadPåFastighetISocken;
INSERT INTO @statusTable select '#initiating#sockenTillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#Socken_tillstånd')              IS NULL goto Socken_tillstånd else begin if not             (exists(select 1 from #Socken_tillstånd)) begin drop table #Socken_tillstånd;                      goto Socken_tillstånd; end end INSERT INTO @statusTable select 'preloading#Socken_tillstånd',CURRENT_TIMESTAMP,count(*) from #Socken_tillstånd;
INSERT INTO @statusTable select '#initiating#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#egetOmhändertagande')           IS NULL goto egetOmhändertagande  else begin if not         (exists(select 1 from #egetOmhändertagande)) begin drop table #egetOmhändertagande;                goto egetOmhändertagande; end end  INSERT INTO @statusTable select 'preloading#egetOmhändertagande',CURRENT_TIMESTAMP,count(*) from #egetOmhändertagande;
INSERT INTO @statusTable select '#initiating#Spillvatten',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#spillvaten')                     IS NULL goto spillvaten  else begin if not                  (exists(select 1 from #spillvaten)) begin drop table #spillvaten;                                  goto spillvaten; end end  INSERT INTO @statusTable select 'preloading#spillvaten',CURRENT_TIMESTAMP,count(*) from #spillvaten;
INSERT INTO @statusTable select '#initiating#slam',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID('tempdb..#slam')                           IS NULL goto taxekod  else begin if not                     (exists(select 1 from #slam)) begin drop table #slam;                                              goto taxekod; end end  INSERT INTO @statusTable select 'preloading#slam',CURRENT_TIMESTAMP,count(*) from #slam;
INSERT INTO @statusTable select '#initiating#röd',CURRENT_TIMESTAMP,@@ROWCOUNT;
IF OBJECT_ID(N'tempdb..#röd')                           IS NULL goto röd  else begin if not                         (exists(select 1 from #röd)) begin drop table #röd;                                                goto röd; end end  INSERT INTO @statusTable select 'preloading#röd',CURRENT_TIMESTAMP,count(*) from #röd
INSERT INTO @statusTable select '#goingToRepport',CURRENT_TIMESTAMP,@@ROWCOUNT;
goto repport


if (select 1) IS NULL
    BEGIN
        TRY
Drop table #SockenYtor
Drop table #ByggnadPåFastighetISocken
Drop table #Socken_tillstånd
Drop table #egetOmhändertagande
Drop table #spillvaten
Drop table #slam
Drop table #röd
        INSERT INTO @statusTable
        select '#Rebuilding',CURRENT_TIMESTAMP,@@ROWCOUNT END TRY BEGIN CATCH SELECT 1 END CATCH else INSERT INTO @statusTable select 'preloading#DidNotDiscard',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print '#Rebuilding' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate

SockenYtor:
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456)
    SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape
    INTO #SockenYtor from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT,
len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
--')
INSERT INTO @statusTable select 'rebuilt#SockenYtor',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print 'preloading#SockenYtor' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
ByggnadPåFastighetISocken:
    with byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join #SockenYtor socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp,shape ByggShape into #ByggnadPåFastighetISocken from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1; INSERT INTO @statusTable select  N'rebuilt#ByggnadPåFastighetISocken',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print N'rebuilt#ByggnadPåFastighetISocken' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;Socken_tillstånd:
      with
       AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from #sockenYtor FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt into #Socken_tillstånd from SammanSlagna INSERT INTO @statusTable select N'rebuilt#Socken_tillstånd',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print 'rebuilt#Socken_tillstånd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT

goto TableInitiate
;egetOmhändertagande:
     with
        LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
        ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,''),' ',nullif(LOKALT_SLAM_P.Fastighet_,''),' ',nullif(LOKALT_SLAM_P.Fastighe00,'')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(':',fas) > 0),
        utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, ''), ' ', nullif(LOKALT_SLAM_P.Fastighet_, ''), ' ', nullif(LOKALT_SLAM_P.Fastighe00, ''))) = 0) utan_fastighet inner join #SockenYtor sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

        select fastighet,concat(nullif(Diarienr+'-','-'), nullif(Fastighe00+'-',' -'), nullif(Fastighet_+'-',' -'), nullif(Eget_omhän+'-',' -'), nullif(Lokalt_omh+'-',' -'), nullif(Anteckning+'-',' -'),FORMAT(Beslutsdat,'yyyy-MM-dd')) egetOmhändertangandeInfo,Shape  LocaltOmH into #egetOmhändertagande from
              (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet
                  on fas like '%' + sYt.Fastighet + '%' where fas is not null
              union all
              select * from utan_fastighet) as [sYMfuf*] INSERT INTO @statusTable select N'rebuilt#egetOmhändertagande',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print 'rebuilt#egetOmhändertagande' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;spillvaten:
    with
        Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw)
         ,q as (
            select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all
            select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c
            from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all
            select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2
            from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all
            select shape,
                   isnull(coalesce(
                                  nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'),
                                  nullif(concat('planprog:',planprog) ,'planprog:'),
                                  nullif(concat('planansokn:',planansokn) ,'planansokn:')
                                                                        ),N'okändStatus') as i
            from
            Va_planomraden_171016_evw
         )
  select sYt.fastighet, q.typ  into #spillvaten
  from #SockenYtor sYt
           inner join q on sYt.shape.STIntersects(q.Shape) = 1 INSERT INTO @statusTable select 'rebuilt#spillvaten',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print 'rebuilt#spillvaten'  + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT
goto TableInitiate
;röd:
with     slamm as (select strFastBeteckningHel,
                          strDelprodukt,
                          z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''),
                                                                                            nullif(
                                                                  concat(' Avbrutet:', FORMAT(nullif(x.q2z,
                          smalldatetimefromparts(1900, 01, 01, 00, 00)),
                                                                                                      'yyyy-MM-dd')), ' Avbrutet:')) as c3s
                            FROM #slam x
                          where q.strFastBeteckningHel = x.strFastBeteckningHel
                          FOR XML PATH ('')), 1, 1, '')
FROM #slam q
group by strFastBeteckningHel,strDelprodukt),
slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 as nadas
                                                           FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel),

    socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor ),
     byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPåFastighetISocken),
     vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhändertangandeInfo,LocaltOmH from #egetOmhändertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstånd)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,gul as (select null "fstat" ), -- from fastighets_Anslutningar_Gemensamhetanläggningar)
       q as (select attUtsokaFran.socken,
                                attUtsokaFran.fastighet,
                               attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,
                               attUtsokaFran.Byggnadstyp,
                                Beslut_datum,
                                utförddatum "utförddatum",
                               attUtsokaFran.Anteckning,
    VaPlan                   = (select top 1 typ
                                from vaPlan
                                where vaPlan.fastighet = attUtsokaFran.fastighet),
                               fstatus,
    egetOmhändertangandeInfo = (select top 1 egetOmhändertangandeInfo
                                from egetOmhandertagande
                                where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
    slam                     = (select top 1 datStoppdatum
                                from slam
                                where attUtsokaFran.fastighet = slam.strFastBeteckningHel),
                               flaggnr,
                               flagga.STPointN(1) flagga
                            from attUtsokaFran)
        ,röd as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhändertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhändertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
select * into #röd from röd INSERT INTO @statusTable select N'rebuilt#Röd',CURRENT_TIMESTAMP,@@ROWCOUNT
--Print 'rebuilt#Röd' + CURRENT_TIMESTAMP + ' RowNR:' + @@ROWCOUNT;

repport:
    --begin try

select * from #röd where Socken = N'Björke';
select * from #röd where Socken = 'Dalhem';
select * from #röd where Socken = N'Fröjel';
select * from #röd where Socken = 'Ganthem';
select * from #röd where Socken = 'Halla';
select * from #röd where Socken = 'Klinte';
select * from #röd where Socken = 'Roma';
taxekod:


select * from @statusTable
end try begin catch
    insert into @statusTable select ERROR_MESSAGE(),CURRENT_TIMESTAMP,@@ROWCOUNT
    select * from @statusTable end catch
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken

;
    
    with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken
 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken

       ,LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw) ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,'),',nullif(LOKALT_SLAM_P.Fastighet_,'),' ',nullif(LOKALT_SLAM_P.Fastighe00,')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(' :',fas) > 0), utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, '), ' ', nullif(LOKALT_SLAM_P.Fastighet_, '), ' ', nullif(LOKALT_SLAM_P.Fastighe00, '))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+'- ','- '), nullif(Fastighe00+'- ',' - '), nullif(Fastighet_+'- ',' - '), nullif(Eget_omhän+'- ',' - '), nullif(Lokalt_omh+'- ',' - '), nullif(Anteckning+'- ',' - '),FORMAT(Beslutsdat,' yyyy-MM-dd ')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet on fas like '% ' + sYt.Fastighet + '% ' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]' +

;
with socknarOfIntresse as (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken

       ,with Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

;
    
    with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw) ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,'),',nullif(LOKALT_SLAM_P.Fastighet_,'),' ',nullif(LOKALT_SLAM_P.Fastighe00,')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(' :',fas) > 0), utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, '), ' ', nullif(LOKALT_SLAM_P.Fastighet_, '), ' ', nullif(LOKALT_SLAM_P.Fastighe00, '))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+'- ','- '), nullif(Fastighe00+'- ',' - '), nullif(Fastighet_+'- ',' - '), nullif(Eget_omhän+'- ',' - '), nullif(Lokalt_omh+'- ',' - '), nullif(Anteckning+'- ',' - '),FORMAT(Beslutsdat,' yyyy-MM-dd ')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet on fas like '% ' + sYt.Fastighet + '% ' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]' +

;
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,with Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

;
    
    with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw) ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,'),',nullif(LOKALT_SLAM_P.Fastighet_,'),' ',nullif(LOKALT_SLAM_P.Fastighe00,')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(' :',fas) > 0), utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, '), ' ', nullif(LOKALT_SLAM_P.Fastighet_, '), ' ', nullif(LOKALT_SLAM_P.Fastighe00, '))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+'- ','- '), nullif(Fastighe00+'- ',' - '), nullif(Fastighet_+'- ',' - '), nullif(Eget_omhän+'- ',' - '), nullif(Lokalt_omh+'- ',' - '), nullif(Anteckning+'- ',' - '),FORMAT(Beslutsdat,' yyyy-MM-dd ')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet on fas like '% ' + sYt.Fastighet + '% ' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]' +

;
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )
    select * from socknarOfIntresse
;
    
    with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(' ', Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(' ', Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(' ', Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(' ', Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,LOKALT_SLAM_P as ( select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat, shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw) ,Med_fastighet as (select * from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh,'),',nullif(LOKALT_SLAM_P.Fastighet_,'),' ',nullif(LOKALT_SLAM_P.Fastighe00,')) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) q where fas is not null and charindex(' :',fas) > 0), utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, '), ' ', nullif(LOKALT_SLAM_P.Fastighet_, '), ' ', nullif(LOKALT_SLAM_P.Fastighe00, '))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+'- ','- '), nullif(Fastighe00+'- ',' - '), nullif(Fastighet_+'- ',' - '), nullif(Eget_omhän+'- ',' - '), nullif(Lokalt_omh+'- ',' - '), nullif(Anteckning+'- ',' - '),FORMAT(Beslutsdat,' yyyy-MM-dd ')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet on fas like '% ' + sYt.Fastighet + '% ' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]' +

;
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,' ',Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )
    select * from socknarOfIntresse
;
    
    with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

      , LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape
                          from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
      , Med_fastighet as ( select * from (select *,
                                       concat(nullif(LOKALT_SLAM_P.Lokalt_omh,SPACE(0)),
                                                     nullif(LOKALT_SLAM_P.Fastighet_,SPACE(0)),
                                                            nullif(LOKALT_SLAM_P.Fastighe00,SPACE(0))) fas from
                                              sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                                where fas is not null
                                  and charindex(' :', fas) > 0),
                               utan_fastighet as (
   select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet
   from (select *
         from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P
         where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh,SPACE(0)), SPACE(0), nullif(LOKALT_SLAM_P.Fastighet_,SPACE(0)), SPACE(0),
                                     nullif(LOKALT_SLAM_P.Fastighe00,SPACE(0)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+' -',' - '), nullif(Fastighe00+' - ',' - '), nullif(Fastighet_+' - ',' -'), nullif(Eget_omhän+' - ',' - '), nullif(Lokalt_omh+' - ',' -'), nullif(Anteckning+' - ',' - '),FORMAT(Beslutsdat,' yyyy - MM - dd')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from #SockenYtor sYt left outer join Med_fastighet on fas like ' %' + sYt.Fastighet + ' %' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]

;
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )
    select * from socknarOfIntresse
;
    
    with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

 ,byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
        q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
        select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1

;


      with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
       AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand                                                             z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                           anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
       AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                            z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                         anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
       SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
       SammanSlagna as (select Diarienummer, q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum, isnull(TRY_CONVERT(DateTime, Utford_datum,102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum, Anteckning, anlShape, FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)
      select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;

   with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

      , LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape
                          from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw)
      , Med_fastighet as ( select * from (select *,
                                       concat(nullif(LOKALT_SLAM_P.Lokalt_omh,SPACE(0)),
                                                     nullif(LOKALT_SLAM_P.Fastighet_,SPACE(0)),
                                                            nullif(LOKALT_SLAM_P.Fastighe00,SPACE(0))) fas from
                                              sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                                where fas is not null
                                  and charindex(' :', fas) > 0),
                               utan_fastighet as (
   select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet
   from (select *
         from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P
         where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh,SPACE(0)), SPACE(0), nullif(LOKALT_SLAM_P.Fastighet_,SPACE(0)), SPACE(0),
                                     nullif(LOKALT_SLAM_P.Fastighe00,SPACE(0)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1) select fastighet,concat(nullif(Diarienr+' -',' - '), nullif(Fastighe00+' - ',' - '), nullif(Fastighet_+' - ',' -'), nullif(Eget_omhän+' - ',' - '), nullif(Lokalt_omh+' - ',' -'), nullif(Anteckning+' - ',' - '),FORMAT(Beslutsdat,' yyyy - MM - dd')) egetOmhändertangandeInfo,Shape  LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from socknarOfIntresse sYt left outer join Med_fastighet on fas like ' %' + sYt.Fastighet + ' %' where fas is not null union all select * from utan_fastighet) as [sYMfuf*]

;
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'Björke' "socken"  Union Select 'Dalhem' as alias2 Union Select N'Fröjel' as alias234567 Union Select 'Ganthem' as alias23 Union Select 'Halla' as alias234 Union Select 'Klinte' as alias2345 Union Select 'Roma' as alias23456) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )

       ,Va_planomraden_171016_evw as   (select shape,dp_i_omr,planprog,planansokn from sde_pipe.gng.Va_planomraden_171016_evw),q as ( select shape, concat(typkod,':',status,'(spill)') typ from sde_pipe.gng.VO_Spillvatten_evw VO_Spillvatten_evw union all select shape, concat('AVTALSABONNENT [Tabell_ObjID: ',OBJECTID,']') as c from sde_pipe.gng.AVTALSABONNENTER AVTALSABONNENTER union all select shape, concat('GEMENSAMHETSANLAGGNING: ',GEMENSAMHETSANLAGGNINGAR.GA) as c2 from sde_pipe.gng.GEMENSAMHETSANLAGGNINGAR GEMENSAMHETSANLAGGNINGAR union all select shape,isnull(coalesce(nullif(concat('dp_i_omr:',dp_i_omr) ,'dp_i_omr:'), nullif(concat('planprog:',planprog) ,'planprog:'), nullif(concat('planansokn:',planansokn) ,'planansokn:')),N'okändStatus') as i from Va_planomraden_171016_evw) select sYt.fastighet, q.typ  from socknarOfIntresse sYt inner join q on sYt.shape.STIntersects(q.Shape) = 1
;-- -. . -..- - / . -. - .-. -.--
rodx:
set @tid = CURRENT_TIMESTAMP INSERT INTO @statusTable (medelande)  select N'Starting#Röd' "a"
BEGIN TRY
 BEGIN TRANSACTION
        -- BEGIN TRY DROP TABLE #slam END TRY BEGIN CATCH select 1 END CATCH
        ;with
            taxekod as (select * from #taxekod )
            ,slam as ( select max(q2z) q2z,strDelprodukt, strTaxebenamning,strFastBeteckningHel, decAnlXKoordinat, decAnlYkoordinat
                        from taxekod q group by strDelprodukt, strTaxebenamning,strFastBeteckningHel,decAnlXKoordinat,decAnlYkoordinat)
            select * into #slam from slam;
        ;with
             slamm as (select strFastBeteckningHel,strDelprodukt,z2 = STUFF((SELECT distinct ','+ concat(nullif(x.strTaxebenamning,''), nullif(concat(' Avbrutet:', FORMAT(nullif(x.q2z, smalldatetimefromparts(1900, 01, 01, 00, 00)), 'yyyy-MM-dd')), ' Avbrutet:')) "c"
            FROM #slam x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')FROM #slam q group by strFastBeteckningHel,strDelprodukt)
            ,slam as (select strFastBeteckningHel,datStoppdatum =STUFF((SELECT distinct ','+nullif(strDelprodukt+'|','|')+z2 "n"  FROM slamm x where q.strFastBeteckningHel = x.strFastBeteckningHel FOR XML PATH ('')), 1, 1, '')from slamm q group by strFastBeteckningHel)
            ,socknarOfInteresse as (select distinct sockenX socken, fastighet from #SockenYtor )
            ,byggnader as (select Fastighetsbeteckning fastighet, Byggnadstyp,ByggShape from #ByggnadPaFastighetISocken)
            ,vaPlan as (select fastighet,typ  from #spillvaten)
            ,egetOmhandertagande as (select  fastighet,egetOmhandertangandeInfo,LocaltOmH from #egetOmhandertagande )
            ,anlaggningar as (select diarienummer,Fastighet,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when not (Beslut_datum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1) and utförddatum > DATETIME2FROMPARTS(2003, 1, 1, 1, 1, 1, 1, 1)) then N'röd' else N'grön' end) fstatus,anlaggningspunkt from #Socken_tillstand)
            , attUtsokaFran as (select *, row_number() over (partition by q.fastighet order by q.Anteckning desc ) flaggnr from (select anlaggningar.diarienummer,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.fstatus else '?' end) fstatus, socknarOfInteresse.socken,socknarOfInteresse.fastighet,Byggnadstyp,Fastighet_tillstand,Beslut_datum,utförddatum,Anteckning,(case when anlaggningar.anlaggningspunkt is not null then anlaggningar.anlaggningspunkt else ByggShape end) flagga from socknarOfInteresse left outer join byggnader on socknarOfInteresse.fastighet = byggnader.fastighet left outer join anlaggningar on socknarOfInteresse.fastighet = anlaggningar.fastighet) q  where q.flagga is not null)
            ,q as (select attUtsokaFran.socken,attUtsokaFran.fastighet,attUtsokaFran.Fastighet_tillstand,attUtsokaFran.Diarienummer,attUtsokaFran.Byggnadstyp,Beslut_datum,utförddatum "utförddatum",attUtsokaFran.Anteckning,
                    VaPlan                   = (select top 1 typ from vaPlan where vaPlan.fastighet = attUtsokaFran.fastighet),fstatus,
                    egetOmhandertangandeInfo = (select top 1 egetOmhandertangandeInfo from egetOmhandertagande where attUtsokaFran.fastighet = egetOmhandertagande.fastighet),
                    slam                     = (select top 1 datStoppdatum from slam where attUtsokaFran.fastighet = slam.strFastBeteckningHel),flaggnr,flagga.STPointN(1) flagga from attUtsokaFran)
            ,rodx as ( select socken,fastighet,Fastighet_tillstand,Byggnadstyp,Beslut_datum,utförddatum,Anteckning,VaPlan,egetOmhandertangandeInfo,slam,flaggnr,flagga, (case when fstatus = N'röd' then (case when (vaPlan is null and egetOmhandertangandeInfo is null) then N'röd' else (case when VaPlan is not null then 'KomV?' else (case when null is not null then 'gem' else '?' end) end) end) else fstatus end ) Fstatus from q)
            select *into #rodx from rodx
Commit Transaction
end try
begin catch ROLLBACK TRANSACTION  insert into @statusTable select ERROR_MESSAGE() "m",CURRENT_TIMESTAMP "t",@@ROWCOUNT  "c"print 'failed to build'  end catch set @tid = CURRENT_TIMESTAMP - @tid INSERT INTO @statusTable select 'rebuilt#',@tid,@@ROWCOUNT goto TableInitiate

repport:
    --begin try
select * from @statusTable
begin try
--end try
end try
begin catch
    insert into @statusTable select ERROR_MESSAGE() "e",CURRENT_TIMESTAMP "t",@@ROWCOUNT "c"
    select * from @statusTable end catch

--Kopierade tabellföreteckning från gng.FLAGGSKIKTET_P
set @tid = CURRENT_TIMESTAMP INSERT INTO @statusTable (medelande)  select 'tableCreate#Inventering_Bjorke' "a"  BEGIN TRY BEGIN TRANSACTION
create table gng.Inventering_Bjorke
(
    OBJECTID            int not null
        constraint invBj_pk
            primary key,
    FASTIGHET           nvarchar(150),Fastighet_tillstand nvarchar(150),Arendenummer        nvarchar(50),Beslut_datum        datetime2,Status              nvarchar(50),Utskick_datum       datetime2,Anteckning          nvarchar(254),Utforddatum         datetime2,Slamhamtning        nvarchar(100),Antal_byggnader     numeric(38, 8),alltidsant          int,Shape               geometry,GDB_GEOMATTR_DATA   varbinary(max),skapad_datum        datetime2,andrad_datum        datetime2
) end try begin catch ROLLBACK TRANSACTION  insert into @statusTable select ERROR_MESSAGE() "m",CURRENT_TIMESTAMP "t",@@ROWCOUNT  "c"print 'failed to build'  end catch set @tid = CURRENT_TIMESTAMP - @tid INSERT INTO @statusTable select 'built#',@tid,@@ROWCOUNT
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)

    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma' ;

    set @innerInnerQuery = 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'

EXEC sp_executesql @innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)

    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma' ;

    set @innerInnerQuery = 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'

EXEC sp_executesql @innerInnerQuery, @innerparam,,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)

    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma' ;

    set @innerInnerQuery = 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'

    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  '''';with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'''')'

EXEC sp_executesql @innerInnerQuery, @innerparam,,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)

    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma' ;

    set @innerInnerQuery = 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'

    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  '''';with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) ; select * from socknarOfIntresse'''')'

EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)

    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma' ;


with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse
;-- -. . -..- - / . -. - .-. -.--
declare @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma'

with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse
;-- -. . -..- - / . -. - .-. -.--
declare @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';

with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse
;-- -. . -..- - / . -. - .-. -.--
declare @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
;-- -. . -..- - / . -. - .-. -.--
declare @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerQuery nvarchar(MAX),@innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'

EXEC sp_executesql 'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
;-- -. . -..- - / . -. - .-. -.--
declare @query nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @query =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

EXEC sp_executesql @query, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@query nvarchar(max),@bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@outerparam nvarchar (250),@innerparam nvarchar (250)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510),@innerparam nvarchar (250)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerQuery=@innerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'

EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerInnerQuery=@innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'EXEC sp_executesql select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery), @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerInnerQuery=@innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),
        @innerInnerQuery nvarchar(MAX),@innerQuery nvarchar(510)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255), @innerInnerQuery nvarchar(250)'
    set @innerInnerQuery = 'EXEC sp_executesql select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery), @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerInnerQuery=@innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma

Exec sp_executesql 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma' , @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
declare @quert nvarchar(500)
 set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
Exec sp_executesql @quert , @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
declare @quert nvarchar(500)
 set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
set @innerparam = @innerparam + ',@innerInnerInnerQuery nvarchar(max)'
Exec sp_executesql @quert , @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
declare @quert nvarchar(500)
 set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
set @innerparam = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'
Exec sp_executesql @quert , @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
declare @quert nvarchar(500)
 set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
set @innerparam = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'
Exec sp_executesql @quert , @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'

--EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma
declare @quert nvarchar(500)
 set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'
Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma, @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
    set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'

Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
    @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @queryZ = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
    set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'
    set @quert = 'EXEC sp_executesql @queryZ, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'


   Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
    @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @queryZ nvarchar(max),@innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @queryZ = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
    set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'
    set @quert = 'EXEC sp_executesql @queryZ, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'


   Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
    @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @queryZ nvarchar(max),@innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @queryZ = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
    set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255),@queryZ nvarchar(max)'
    set @quert = 'EXEC sp_executesql @queryZ, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'


   Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
    @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam,@queryZ=@queryZ
;-- -. . -..- - / . -. - .-. -.--
declare @queryZ nvarchar(max),@innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
    set @bjorke=N'björke'
    set @dalhem = 'Dalhem'
    set @frojel = N'Fröjel'
    set @ganthem = 'Ganthem'
    set @Halla = 'Halla'
    set @Klinte = 'Klinte'
    set @Roma = 'Roma';
    set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
    set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
    set @queryZ = 'select * INTO #SockenYtor from OPENQUERY(gisdb01,  @innerInnerInnerQuery)'
    set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255),@queryZ nvarchar(max)'
    set @quert = 'EXEC sp_executesql @queryZ, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'


   Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
    @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam,@queryZ=@queryZ


EXEC sp_executesql @innerInnerQuery, @innerparam,@bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,@innerInnerInnerQuery=@innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
DECLARE @OPENQUERY nvarchar(4000), @TSQL nvarchar(4000), @LinkedServer nvarchar(4000)
SET @LinkedServer = 'MyLinkedServer'
SET @OPENQUERY = 'SELECT * FROM OPENQUERY('+ @LinkedServer + ','''
SET @TSQL = 'SELECT au_lname, au_id FROM pubs..authors'')'
EXEC (@OPENQUERY+@TSQL)
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
        set @bjorke=N'björke',@dalhem = 'Dalhem',@frojel = N'Fröjel',@ganthem = 'Ganthem',@Halla = 'Halla',@Klinte = 'Klinte',@Roma = 'Roma';
        set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
        set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
        set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
        set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'

    Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
        @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
declare @innerInnerInnerQuery nvarchar(max), @innerparamx nvarchar(255), @innerparam nvarchar(255), @bjorke nvarchar(255),@dalhem varchar(255),@frojel nvarchar(255),@ganthem varchar(255),@Halla varchar(255),@Klinte varchar(255),@Roma varchar(255),@quert nvarchar(500)
        set @bjorke=N'björke'
            set @dalhem = 'Dalhem'
                set @frojel = N'Fröjel'
                    set @ganthem = 'Ganthem'
                        set @Halla = 'Halla'
                            set @Klinte = 'Klinte'
                                set @Roma = 'Roma';
        set @innerparam = N'@bjorke nvarchar(255) , @dalhem varchar(255) , @frojel nvarchar(255) , @ganthem varchar(255) , @Halla varchar(255) , @Klinte varchar(255) ,  @Roma varchar(255)'
        set @innerInnerInnerQuery =  'with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(0),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken ) select * from socknarOfIntresse'
        set @quert = 'EXEC sp_executesql @innerInnerInnerQuery, @innerparam, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma'
        set @innerparamx = @innerparam + ',@innerInnerInnerQuery nvarchar(max), @innerparam nvarchar(255)'

    Exec sp_executesql @quert , @innerparamx, @bjorke=@bjorke, @dalhem=@dalhem, @frojel=@frojel, @ganthem= @ganthem, @Halla=@Halla, @Klinte= @Klinte, @Roma=@Roma,
        @innerInnerInnerQuery= @innerInnerInnerQuery,@innerparam=@innerparam
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join (Select @bjorke "socken"
                                                Union
                                                Select @dalhem "a"
                                                Union
                                                Select @frojel "a"
                                                Union
                                                Select @ganthem "a"
                                                Union
                                                Select @Halla "a"
                                                Union
                                                Select @Klinte "a"
                                                Union
                                                Select @Roma "a") socknarOfIntresse
                                               on left(x.TRAKT, len(socknarOfIntresse.socken)) =
                                                  socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case
                                                            when charindex(SPACE(0), Fastighet_tillstand) = 0
                                                                then len(Fastighet_tillstand) + 1
                                                            else charindex(SPACE(0), Fastighet_tillstand) end -
                                                        1) socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case
                                                            when charindex(SPACE(0), Fastighet_tillstand) = 0
                                                                then len(Fastighet_tillstand) + 1
                                                            else charindex(SPACE(0), Fastighet_tillstand) end -
                                                        1) socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case
                                                           when charindex(SPACE(0), Fastighet_tilstand) = 0
                                                               then len(Fastighet_tilstand) + 1
                                                           else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,
                              Diarienummer,
                              Fastighet_tilstand                                                                 z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                                                                              anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet
                        from AnSoMedSocken AllaAvlopp
                                 inner join(select FiltreradeFast.*
                                            from socknarOfIntresse FiltreradeFast
                                                     inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast
                                           on AllaAvlopp.socken = ffast.SockenX and
                                              AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet
                        from AnNoMedSocken AllaAvlopp
                                 inner join(select FiltreradeFast.*
                                            from socknarOfIntresse FiltreradeFast
                                                     inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast
                                           on AllaAvlopp.socken = ffast.SockenX and
                                              AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer,
                                   z q,
                                   Beslut_datum,
                                   Utford_datum,
                                   Anteckning,
                                   AllaAvlopp.anlShape,
                                   FAStighet
                            from AnMeMedSocken AllaAvlopp
                                     inner join(select FiltreradeFast.*
                                                from socknarOfIntresse FiltreradeFast
                                                         inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast
                                               on AllaAvlopp.socken = ffast.SockenX and
                                                  AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,
                             q                                                     "Fastighet_tillstand",
                             isnull(TRY_CONVERT(DateTime, Beslut_datum, 102),
                                    DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,
                             isnull(TRY_CONVERT(DateTime, Utford_datum, 102),
                                    DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,
                             Anteckning,
                             anlShape,
                             FAStighet
                      from (select *
                            from SodraFiltrerad
                            union all
                            select *
                            from NorraFiltrerad
                            union all
                            select *
                            from MellerstaFiltrerad) z)
select FAStighet,
       Diarienummer,
       Fastighet_tillstand,
       Beslut_datum,
       Utford_datum "utförddatum",
       Anteckning,
       anlShape     AnlaggningsPunkt
from SammanSlagna
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join (Select N'björke' "socken"
                                                Union
                                                Select 'dalhem' "a"
                                                Union
                                                Select N'fröjel' "a"
                                                Union
                                                Select 'ganthem' "a"
                                                Union
                                                Select 'Halla' "a"
                                                Union
                                                Select 'Klinte' "a"
                                                Union
                                                Select 'Roma' "a") socknarOfIntresse
                                               on left(x.TRAKT, len(socknarOfIntresse.socken)) =
                                                  socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case
                                                            when charindex(SPACE(0), Fastighet_tillstand) = 0
                                                                then len(Fastighet_tillstand) + 1
                                                            else charindex(SPACE(0), Fastighet_tillstand) end -
                                                        1) socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case
                                                            when charindex(SPACE(0), Fastighet_tillstand) = 0
                                                                then len(Fastighet_tillstand) + 1
                                                            else charindex(SPACE(0), Fastighet_tillstand) end -
                                                        1) socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case
                                                           when charindex(SPACE(0), Fastighet_tilstand) = 0
                                                               then len(Fastighet_tilstand) + 1
                                                           else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,
                              Diarienummer,
                              Fastighet_tilstand                                                                 z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                                                                              anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet
                        from AnSoMedSocken AllaAvlopp
                                 inner join(select FiltreradeFast.*
                                            from socknarOfIntresse FiltreradeFast
                                                     inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast
                                           on AllaAvlopp.socken = ffast.SockenX and
                                              AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet
                        from AnNoMedSocken AllaAvlopp
                                 inner join(select FiltreradeFast.*
                                            from socknarOfIntresse FiltreradeFast
                                                     inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast
                                           on AllaAvlopp.socken = ffast.SockenX and
                                              AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer,
                                   z q,
                                   Beslut_datum,
                                   Utford_datum,
                                   Anteckning,
                                   AllaAvlopp.anlShape,
                                   FAStighet
                            from AnMeMedSocken AllaAvlopp
                                     inner join(select FiltreradeFast.*
                                                from socknarOfIntresse FiltreradeFast
                                                         inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast
                                               on AllaAvlopp.socken = ffast.SockenX and
                                                  AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,
                             q                                                     "Fastighet_tillstand",
                             isnull(TRY_CONVERT(DateTime, Beslut_datum, 102),
                                    DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,
                             isnull(TRY_CONVERT(DateTime, Utford_datum, 102),
                                    DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,
                             Anteckning,
                             anlShape,
                             FAStighet
                      from (select *
                            from SodraFiltrerad
                            union all
                            select *
                            from NorraFiltrerad
                            union all
                            select *
                            from MellerstaFiltrerad) z)
select FAStighet,
       Diarienummer,
       Fastighet_tillstand,
       Beslut_datum,
       Utford_datum "utförddatum",
       Anteckning,
       anlShape     AnlaggningsPunkt
from SammanSlagna
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna



select * FROM socknarOfIntresse

select * from AnSoMedSocken
select * from SodraFiltrerad
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)

select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna;



select * FROM socknarOfIntresse;

select * from AnSoMedSocken;
select * from SodraFiltrerad;
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)



select * FROM socknarOfIntresse;

select * from AnSoMedSocken;
select * from SodraFiltrerad;

select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna;
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)



select * FROM socknarOfIntresse

select * from AnSoMedSocken
select * from SodraFiltrerad

select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna;
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)



select * FROM socknarOfIntresse

select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna;
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P),
     AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P),
     AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P),
     SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1),
     SammanSlagna as (select Diarienummer,q                                                     "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)



select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)

     select * from socknarOfIntresse
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)
   select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)
      select * from AnNoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)

     ,AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P)
   select * from AnMeMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)

     ,AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P)

     ,SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)
   select * from SodraFiltrerad
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)

     ,AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P)

     ,SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)

     ,NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)
      select * from NorraFiltrerad
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)



                 ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)

     ,AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(SPACE(0), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(SPACE(0), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P)

     ,SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)

     ,NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)

     ,MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)
         select * from MellerstaFiltrerad
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)
     ,AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(SPACE(0), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(SPACE(0), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)
select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)


   , AnSoMedSocken as (select charindex(SPACE(0), Fastighet_tillstand),
                              left(Fastighet_tillstand,
                                  case
                                    when charindex(SPACE(0), Fastighet_tillstand) = 0
                                        then len(Fastighet_tillstand) + 1
                                    else charindex(SPACE(0), Fastighet_tillstand) end -
                                    1)
                                  socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

   select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)


   , AnSoMedSocken as (select charindex(SPACE(0), Fastighet_tillstand) q,
                              left(Fastighet_tillstand,
                                  case
                                    when charindex(SPACE(0), Fastighet_tillstand) = 0
                                        then len(Fastighet_tillstand) + 1
                                    else charindex(SPACE(0), Fastighet_tillstand) end -
                                    1)
                                  socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

   select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)


   , AnSoMedSocken as (select charindex(

                                        SPACE(0), Fastighet_tillstand,0) q,
                              left(Fastighet_tillstand,
                                  case
                                    when charindex(

                                        SPACE(0), Fastighet_tillstand,0) = 0
                                        then len(Fastighet_tillstand) + 1
                                    else charindex(SPACE(0), Fastighet_tillstand) end -
                                    1)
                                  socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

   select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(0), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)


   , AnSoMedSocken as (select charindex(

                                        SPACE(1), Fastighet_tillstand,0) q,
                              left(Fastighet_tillstand,
                                  case
                                    when charindex(

                                        SPACE(0), Fastighet_tillstand,0) = 0
                                        then len(Fastighet_tillstand) + 1
                                    else charindex(SPACE(0), Fastighet_tillstand) end -
                                    1)
                                  socken,
                              Diarienummer,
                              Fastighet_tillstand          z,
                              Beslut_datum,
                              Utford_datum,
                              Anteckning,
                              Shape                        anlShape
                       from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)

   select * from AnSoMedSocken
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, Space(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select N'björke' "socken" Union Select 'dalhem' "a" Union Select N'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken)
   , AnSoMedSocken as (select left(Fastighet_tillstand, case when charindex(Space(1), Fastighet_tillstand,0) = 0 then len(Fastighet_tillstand) + 1 else charindex(Space(1), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_sodra_P)
     ,AnNoMedSocken as (select left(Fastighet_tillstand, case when charindex(Space(1), Fastighet_tillstand) = 0 then len(Fastighet_tillstand) + 1 else charindex(Space(1), Fastighet_tillstand) end - 1) socken,Diarienummer,Fastighet_tillstand          z,Beslut_datum,Utford_datum,Anteckning,Shape                        anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_Norra_P)
     ,AnMeMedSocken as (select left(Fastighet_tilstand, case when charindex(Space(1), Fastighet_tilstand) = 0 then len(Fastighet_tilstand) + 1 else charindex(Space(1), Fastighet_tilstand) end - 1) socken,Diarienummer,Fastighet_tilstand                                                                 z,Beslut_datum,Utford_datum,Anteckning,Shape                                                                              anlShape from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_MELLERSTA_P)
   , SodraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnSoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnSoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)
     ,NorraFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnNoMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnNoMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)
     ,MellerstaFiltrerad as (select Diarienummer, z q, Beslut_datum, Utford_datum, Anteckning, AllaAvlopp.anlShape, FAStighet from AnMeMedSocken AllaAvlopp inner join(select FiltreradeFast.*from socknarOfIntresse FiltreradeFast inner join (select socken from AnMeMedSocken group by socken) q on socken = sockenX) FFast on AllaAvlopp.socken = ffast.SockenX and AllaAvlopp.anlShape.STIntersects(FFast.Shape) = 1)

     ,SammanSlagna as (select Diarienummer,q "Fastighet_tillstand",isnull(TRY_CONVERT(DateTime, Beslut_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Beslut_datum,isnull(TRY_CONVERT(DateTime, Utford_datum, 102), DATETIME2FROMPARTS(1988, 1, 1, 1, 1, 1, 1, 1)) Utford_datum,Anteckning,anlShape,FAStighet from (select * from SodraFiltrerad union all select * from NorraFiltrerad union all select * from MellerstaFiltrerad) z)



select FAStighet,Diarienummer,Fastighet_tillstand,Beslut_datum,Utford_datum "utförddatum",Anteckning,anlShape     AnlaggningsPunkt from SammanSlagna
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join (Select 'björke' "socken"
                                                Union
                                                Select 'dalhem' "a"
                                                Union
                                                Select 'fröjel' "a"
                                                Union
                                                Select 'ganthem' "a"
                                                Union
                                                Select 'Halla' "a"
                                                Union
                                                Select 'Klinte' "a"
                                                Union
                                                Select 'Roma' "a") socknarOfIntresse
                                               on left(x.TRAKT, len(socknarOfIntresse.socken)) =
                                                  socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,
                              Fastighet_,
                              Fastighe00,
                              Eget_omhän,
                              Lokalt_omh,
                              Anteckning,
                              Beslutsdat,
                              shape
                       from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Med_fastighet as (select *
                       from (select *,
                                    concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)),
                                           nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)),
                                           nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1))) fas
                             from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                       where fas is not null and charindex(' :', fas) > 0),
     utan_fastighet as (select OBJECTID,
                               Fastighet_,
                               Fastighets,
                               Eget_omhän,
                               Lokalt_omh,
                               Fastighe00,
                               Beslutsdat,
                               Diarienr,
                               Anteckning,
                               utan_fastighet.Shape,
                               GDB_GEOMATTR_DATA,
                               SDE_STATE_ID,
                               FAStighet
                        from (select *
                              from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P
                              where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1),
                                                          nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1),
                                                          nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) =
                                    0) utan_fastighet
                                 inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), ' -'),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), ' -'),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,
       Shape                                         LocaltOmH
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             Med_fastighet.Shape,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet
                   on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Med_fastighet as (select *from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]where fas is not null and charindex(' :', fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from LOKALT_SLAM_P
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Med_fastighet as (select *from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]where fas is not null and charindex(' :', fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from Med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Med_fastighet as (select *from (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(0)), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(0)), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(0))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]where fas is not null and charindex(' :', fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from Med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),


     Med_fastighet as (select *
                       from (select *,
                                    concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(0)),
                                           nullif(LOKALT_SLAM_P.Fastighet_, SPACE(0)),
                                           nullif(LOKALT_SLAM_P.Fastighe00, SPACE(0))) fas
                             from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                       where fas is not null
                         and charindex(':', fas) > 0),


     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from Med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),


     Med_fastighet as (select *
                       from (select *,
                                    concat(nullif(LOKALT_SLAM_P.Lokalt_omh+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighet_+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighe00+space(1), space(1))) fas
                             from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                       where fas is not null and charindex(':', fas) > 0),


     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from Med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),


     Med_fastighet as (select *
                       from (select *,
                                    concat(nullif(LOKALT_SLAM_P.Lokalt_omh+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighet_+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighe00+space(1), space(1))) fas
                             from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                       where fas is not null and charindex(char(58), fas) > 0),


     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)




select fastighet,concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Fastighet_ + space(1) + char(45) + space(1), ' -'), nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Lokalt_omh + space(1) + char(45) + space(1), ' -'), nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,Shape                                         LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from socknarOfIntresse sYt left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)where fas is not null union all select *from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),
     LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),


     Med_fastighet as (select *
                       from (select *,
                                    concat(nullif(LOKALT_SLAM_P.Lokalt_omh+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighet_+space(1), space(1)),
                                           nullif(LOKALT_SLAM_P.Fastighe00+space(1), space(1))) fas
                             from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P) as [*2]
                       where fas is not null and charindex(char(58), fas) > 0),

     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P where charindex(':', concat(nullif(LOKALT_SLAM_P.Lokalt_omh, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighet_, SPACE(1)), SPACE(1), nullif(LOKALT_SLAM_P.Fastighe00, SPACE(1)))) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select * from Fas2 where fas is not null and charindex(char(58), fas) > 0),utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from Fas2 where fas is null OR charindex(char(58), fas) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select *from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select * from Fas2 where fas is not null and charindex(char(58), fas) > 0),utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select *from Fas2 where fas is null OR charindex(char(58), fas) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select *from fas2
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select * from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select *,charindex(char(58), fas) q from fas2
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select * from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select * from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2


select fastighet,concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Fastighet_ + space(1) + char(45) + space(1), ' -'), nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), nullif(Lokalt_omh + space(1) + char(45) + space(1), ' -'), nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)), FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,Shape                                         LocaltOmH from (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Med_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from socknarOfIntresse sYt left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)where fas is not null union all select *from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select * from utan_fastighet union med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select * from utan_fastighet union select * from med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select * from utan_fastighet union select * from med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,utan_fastighet.Shape,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select * from utan_fastighet union select * from med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)
--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select * from utan_fastighet union select * from med_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas FAStighet from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,
       Shape                                         LocaltOmH
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             Med_fastighet.Shape,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,
       Shape                                         LocaltOmH
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             Med_fastighet.Shape,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo,
       Shape                                         LocaltOmH
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like space(1) + char(37) + sYt.Fastighet + space(1) + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(Diarienr + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighe00 + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Fastighet_ + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Eget_omhän + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Lokalt_omh + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(Anteckning + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(trim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(trim(Fastighe00) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(trim(Fastighet_) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(trim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(trim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(trim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(trim(Beslutsdat), ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighe00) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighet_) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(ltrim(Beslutsdat), ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighe00) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighet_) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighe00) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(ltrim(Fastighet_),ltrim(Fastighe00)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, ' yyyy - MM - dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Fastighe00) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(ltrim(Fastighet_),ltrim(Fastighe00)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, 'yyyy-MM-dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(lower(ltrim(Fastighet_)),lower(fastighet)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(ltrim(Fastighet_),ltrim(Fastighe00)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, 'yyyy-MM-dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(lower(ltrim(Fastighe00)),lower(fastighet)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(ltrim(Fastighet_),ltrim(Fastighe00)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, 'yyyy-MM-dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),
     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

--select * from utan_fastighet

--select *,charindex(char(58), fas) q from fas2

select distinct fastighet,
       concat(nullif(ltrim(Diarienr) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(lower(ltrim(Fastighe00)),lower(fastighet)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(nullif(ltrim(Fastighet_),ltrim(Fastighe00)) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Eget_omhän) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Lokalt_omh) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              nullif(ltrim(Anteckning) + space(1) + char(45) + space(1), space(1) + char(45) + space(1)),
              FORMAT(Beslutsdat, 'yyyy-MM-dd')) egetOmhandertangandeInfo
from (select OBJECTID,
             Fastighet_,
             Fastighets,
             Eget_omhän,
             Lokalt_omh,
             Fastighe00,
             Beslutsdat,
             Diarienr,
             Anteckning,
             GDB_GEOMATTR_DATA,
             SDE_STATE_ID,
             FAStighet
      from socknarOfIntresse sYt
               left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37)
      where fas is not null
      union all
      select *
      from utan_fastighet) as [sYMfuf*]
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX,concat(Trakt,SPACE(1),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select  @bjorke  "socken" Union Select @dalhem  "a" Union Select @frojel  "a" Union Select  @ganthem "a" Union Select   @Halla "a" Union Select  @Klinte  "a" Union Select  @Roma   "a" ) socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken )' + N',

 LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),

     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,shape LocaltOmH,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,utan_fastighet.shape LocaltOmH,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

from (select Fastighet_, Fastighets, Eget_omhän, Lokalt_omh, Fastighe00, Beslutsdat, Diarienr, Anteckning,LocaltOmH, GDB_GEOMATTR_DATA, SDE_STATE_ID, FAStighet
      from socknarOfIntresse sYt left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37) where fas is not null union all select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),

 LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),

     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,shape LocaltOmH,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,utan_fastighet.shape LocaltOmH,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

from (select Fastighet_, Fastighets, Eget_omhän, Lokalt_omh, Fastighe00, Beslutsdat, Diarienr, Anteckning,LocaltOmH, GDB_GEOMATTR_DATA, SDE_STATE_ID, FAStighet
      from socknarOfIntresse sYt left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37) where fas is not null union all select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),

 LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),

     Med_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,shape LocaltOmH,SDE_STATE_ID,fas from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select OBJECTID,Fastighet_,Fastighets,Eget_omhän,Lokalt_omh,Fastighe00,Beslutsdat,Diarienr,Anteckning,GDB_GEOMATTR_DATA,utan_fastighet.shape LocaltOmH,SDE_STATE_ID,FAStighet fas from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0 ) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select Fastighet_, Fastighets, Eget_omhän, Lokalt_omh, Fastighe00, Beslutsdat, Diarienr, Anteckning,LocaltOmH, GDB_GEOMATTR_DATA, SDE_STATE_ID, FAStighet
      from socknarOfIntresse sYt left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37) where fas is not null union all select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with socknarOfIntresse as (SELECT socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join (Select 'björke' "socken" Union Select 'dalhem' "a" Union Select 'fröjel' "a" Union Select 'ganthem' "a" Union Select 'Halla' "a" Union Select 'Klinte' "a" Union Select 'Roma' "a") socknarOfIntresse on left(x.TRAKT, len(socknarOfIntresse.socken)) = socknarOfIntresse.socken),

 LOKALT_SLAM_P as (select Diarienr,Fastighet_,Fastighe00,Eget_omhän,Lokalt_omh,Anteckning,Beslutsdat,shape from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw),
     Fas2 as (select *,concat(nullif(LOKALT_SLAM_P.Lokalt_omh + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighet_ + space(1), space(1)), nullif(LOKALT_SLAM_P.Fastighe00 + space(1), space(1))) fas from sde_miljo_halsoskydd.gng.MoH_Slam_Lokalt_p_evw LOKALT_SLAM_P),

     Med_fastighet as (select Fastighet_,
                              Fastighets,
                              Eget_omhän,
                              Lokalt_omh,
                              Fastighe00,
                              Beslutsdat,
                              Diarienr,
                              Anteckning,
                              GDB_GEOMATTR_DATA,
                              shape LocaltOmH,
                              SDE_STATE_ID,
                              fas
                       from Fas2 where fas is not null and charindex(char(58), fas) > 0),
     utan_fastighet as (select Fastighet_,
                               Fastighets,
                               Eget_omhän,
                               Lokalt_omh,
                               Fastighe00,
                               Beslutsdat,
                               Diarienr,
                               Anteckning,
                               GDB_GEOMATTR_DATA,
                               utan_fastighet.shape LocaltOmH,
                               SDE_STATE_ID,
                               FAStighet            fas
                        from (select * from Fas2 where fas is null OR charindex(char(58), fas) = 0) utan_fastighet inner join socknarOfIntresse sYt on sYt.shape.STIntersects(utan_fastighet.Shape) = 1)

select Fastighet_, Fastighets, Eget_omhän, Lokalt_omh, Fastighe00, Beslutsdat, Diarienr, Anteckning,LocaltOmH, GDB_GEOMATTR_DATA, SDE_STATE_ID, FAStighet
      from socknarOfIntresse sYt left outer join Med_fastighet on fas like char(37) + sYt.Fastighet + char(37) where fas is not null union all select * from utan_fastighet
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select  'björke'  "socken" Union Select 'dalhem'  "a" Union Select 'fröjel'  "a" Union Select  'ganthem' "a" Union Select   'Halla' "a" Union Select  'Klinte'  "a" Union Select  'Roma'   "a" ),socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX,concat(Trakt,SPACE(1),Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken ),byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE from byggnad_yta inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1) select Fastighetsbeteckning, Byggnadstyp,shape ByggShape from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z where orderz = 1
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) =
                                                                   fastighetsFilter.socken),
     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape
from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where orderz = 1
and 
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) =
                                                                   fastighetsFilter.socken),
     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape
from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape
                           from sde_gsd.gng.AY_0980 x
                                    inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) =
                                                                   fastighetsFilter.socken),
     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape
from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel ansarve%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken),

     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STintersect(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape

from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel ansarve%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken),

     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STwithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape

from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel ansarve%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken),

     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STWithin(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape

from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel ansarve%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET
and status = 'röd'
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw INNER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')

select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
selection as (
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

                                                                                                where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET, FILTRERADEFAST.SHAPE
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET  evmFastighet
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET, FILTRERADEFAST.SHAPE
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET  evmFastighet
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET  evmFastighet
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evmFastighet
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                                                                                                      and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
												and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null

)

select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();

WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                        	and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
				and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
)
,fastigheter as (
select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND))
,
    fnrz as (select fnr from
         sde_geofir_gotland.gng.FA_FASTIGHET q
        	inner join fastigheter on FASTIGHETER.F = beteckning
        ),
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND,
       KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR IN (90035318, 90000487, 90028363, 90000807, 90042089, 90000849, 90061888, 90035635, 90028359))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where fnr in (90035318, 90000487, 90028363, 90000807, 90042089, 90000849, 90061888, 90035635, 90028359))
,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG
left outer join
sde_geofir_gotland.gng.info_OwnerShipChange oshx
on REALESTATEKEY = FARDIG.FNR AND FARDIG.PERSORGNR = OSHX.IDNUMBER


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();

WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                        	and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
				and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
)
,fastigheter as (
select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND))
,
    fnrz as (select fnr from
         sde_geofir_gotland.gng.FA_FASTIGHET q
        	inner join fastigheter on FASTIGHETER.F = beteckning
        ),
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND,
       KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR IN (90035318, 90000487, 90028363, 90000807, 90042089, 90000849, 90061888, 90035635, 90028359))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where fnr in (90035318, 90000487, 90028363, 90000807, 90042089, 90000849, 90061888, 90035635, 90028359))
,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();

WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                        	and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
				and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
)
,fastigheter as (
select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND))
,
    fnrz as (select fnr from
         sde_geofir_gotland.gng.FA_FASTIGHET q
        	inner join fastigheter on FASTIGHETER.F = beteckning
        ),
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND,
       KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE in (select fnr from fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where in (select fnr from fnrz))
,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();

WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980 X
			   INNER JOIN (SELECT VALUE "socken"
				       FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE
			   ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (
    select OBJECTID,
           FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET
         , FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET
    from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST
    on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET

    where status = 'röd'
                        	and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null
				and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null
)
,fastigheter as (
select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND))
,
    fnrz as (select fnr from
         sde_geofir_gotland.gng.FA_FASTIGHET q
        	inner join fastigheter on FASTIGHETER.F = beteckning
        ),
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND,
       KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from fnrz))
,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();

WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
;
with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))
,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();
startz:
IF object_id('tempdb..#fnrz') is null
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
;
ELSE
    drop table #fnrz
goto startz

with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
;
    end
ELSE
    drop table #fnrz
goto startz

with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
;
    end
ELSE
    drop table #fnrz
goto startz
;
with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
declare @time as SMALLDATETIME
set @time = getdate();
with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
;
    end
ELSE
    begin
    drop table #fnrz
	goto startz
    end
;-- -. . -..- - / . -. - .-. -.--
if (select 1) is null
begin
declare @time as SMALLDATETIME
set @time = getdate();
with
Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
,q2 as (select FNR, PERSORGNR, ANDEL,
     KORTNAMN  NAMN
     , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
,medFastighetsAgare as (
select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
      nullif(INSKSDATMIN,@time) INSKSDATMIN,
       ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	fal_postort postort,fal_postnr postnr,
       case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
from GROUPED
UNION
select REALESTATEKEY, PERSONORGANISATIONNR ,
     format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
     , Name NAMN, regdt
     ,Address,
       null postort,null postnr,
	 'info_CurrentOwner'
from
sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
),
fardig as (
select FNR, PERSORGNR, min(ANDELMIN) andel,
       	NAMN
	  , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	  , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	  , max(POSTORT)                                                                                     POSTORT
	  , max(POSTNR)                                                                                      POSTNR
	  ,

       case when  max(POSTORT) is null
	    then 'info_currentOwner'
           else
		case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
               		else 'FA_LAGFART' end
           end
           as source

from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
select * from FARDIG


ORDER BY fnr,PERSORGNR,source
end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select SOCKENX,OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select max(SOCKENX) socken,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and FLAGGSKIKTET_P_EVW.SKAPAD_DATUM is not null)
,fastigheter as (select max(selection.SOCKENX) socken,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null)
,fastigheter as (select max(selection.SOCKENX) socken,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where status = 'röd' and coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)
,fastigheter as (select max(selection.SOCKENX) socken,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)
,fastigheter as (select max(selection.SOCKENX) socken,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)

,fastigheter as (select max(selection.SOCKENX) socken, max(STATUS),coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken,status from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM, STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)

,fastigheter as (select max(selection.SOCKENX) socken, max(STATUS) status,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken,status from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
;
if (select 1) is null
begin
    declare @time as SMALLDATETIME
    set @time = getdate();
    with
    Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
    ,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
    ,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
    ,q2 as (select FNR, PERSORGNR, ANDEL,
	 KORTNAMN  NAMN
	 , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
    FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

    ,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
    ,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
    ,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
    ,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
    ,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
    ,medFastighetsAgare as (
    select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
	  nullif(INSKSDATMIN,@time) INSKSDATMIN,
	   ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	    fal_postort postort,fal_postnr postnr,
	   case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
    from GROUPED
    UNION
    select REALESTATEKEY, PERSONORGANISATIONNR ,
	 format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
	 , Name NAMN, regdt
	 ,Address,
	   null postort,null postnr,
	     'info_CurrentOwner'
    from
    sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
    where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
    ),
    fardig as (
    select FNR, PERSORGNR, min(ANDELMIN) andel,
	    NAMN
	      , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	      , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	      , max(POSTORT)                                                                                     POSTORT
	      , max(POSTNR)                                                                                      POSTNR
	      ,

	   case when  max(POSTORT) is null
		then 'info_currentOwner'
	       else
		    case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
			    else 'FA_LAGFART' end
	       end
	       as source

    from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
    select * from FARDIG


    ORDER BY fnr,PERSORGNR,source
end


    select * from #Fnrz
;-- -. . -..- - / . -. - .-. -.--
;
if (select 1) is null
begin
    declare @time as SMALLDATETIME
    set @time = getdate();
    with
    Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
    ,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
    ,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
    ,q2 as (select FNR, PERSORGNR, ANDEL,
	 KORTNAMN  NAMN
	 , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
    FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

    ,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
    ,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
    ,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
    ,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
    ,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
    ,medFastighetsAgare as (
    select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
	  nullif(INSKSDATMIN,@time) INSKSDATMIN,
	   ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	    fal_postort postort,fal_postnr postnr,
	   case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
    from GROUPED
    UNION
    select REALESTATEKEY, PERSONORGANISATIONNR ,
	 format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
	 , Name NAMN, regdt
	 ,Address,
	   null postort,null postnr,
	     'info_CurrentOwner'
    from
    sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
    where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
    ),
    fardig as (
    select FNR, PERSORGNR, min(ANDELMIN) andel,
	    NAMN
	      , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	      , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	      , max(POSTORT)                                                                                     POSTORT
	      , max(POSTNR)                                                                                      POSTNR
	      ,

	   case when  max(POSTORT) is null
		then 'info_currentOwner'
	       else
		    case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
			    else 'FA_LAGFART' end
	       end
	       as source

    from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
    select * from FARDIG


    ORDER BY fnr,PERSORGNR,source
end


    select socken,count(*) c from #Fnrz GROUP BY socken
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin
    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM,FLAGGSKIKTET_P_EVW.STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)

,fastigheter as (select max(selection.SOCKENX) socken, max(selection .STATUS) status,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken,fastigheter.status from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
;
if (select 1) is null
begin
    declare @time as SMALLDATETIME
    set @time = getdate();
    with
    Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
    ,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
    ,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
    ,q2 as (select FNR, PERSORGNR, ANDEL,
	 KORTNAMN  NAMN
	 , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
    FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

    ,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
    ,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
    ,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
    ,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
    ,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
    ,medFastighetsAgare as (
    select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
	  nullif(INSKSDATMIN,@time) INSKSDATMIN,
	   ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	    fal_postort postort,fal_postnr postnr,
	   case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
    from GROUPED
    UNION
    select REALESTATEKEY, PERSONORGANISATIONNR ,
	 format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
	 , Name NAMN, regdt
	 ,Address,
	   null postort,null postnr,
	     'info_CurrentOwner'
    from
    sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
    where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
    ),
    fardig as (
    select FNR, PERSORGNR, min(ANDELMIN) andel,
	    NAMN
	      , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	      , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	      , max(POSTORT)                                                                                     POSTORT
	      , max(POSTNR)                                                                                      POSTNR
	      ,

	   case when  max(POSTORT) is null
		then 'info_currentOwner'
	       else
		    case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
			    else 'FA_LAGFART' end
	       end
	       as source

    from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
    select * from FARDIG


    ORDER BY fnr,PERSORGNR,source
end


    select socken,count(*) c from #Fnrz
    where status = 'röd'
    GROUP BY socken
;-- -. . -..- - / . -. - .-. -.--
startz:
IF object_id('tempdb..#fnrz') is null
begin    ;
WITH
    FILTRERADEFAST AS (SELECT SOCKEN SOCKENX, concat(TRAKT, ' ', BLOCKENHET) FASTIGHET, SHAPE FROM SDE_GSD.GNG.AY_0980 X INNER JOIN (SELECT VALUE "socken" FROM STRING_SPLIT(N'Björke,Dalhem,Fröjel,Ganthem,Halla,Klinte,Roma', ',')) AS SOCKNAROFINTRESSE ON X.TRAKT LIKE SOCKNAROFINTRESSE.SOCKEN + '%')
,selection as (select OBJECTID, FLAGGSKIKTET_P_EVW.FASTIGHET as evwFASTIGHET, FASTIGHET_TILLSTAND, ARENDENUMMER, BESLUT_DATUM,FLAGGSKIKTET_P_EVW.STATUS, UTSKICK_DATUM, ANTECKNING, UTFORDDATUM, SLAMHAMTNING, ANTAL_BYGGNADER, ALLTIDSANT, FLAGGSKIKTET_P_EVW.SHAPE, GDB_GEOMATTR_DATA, SDE_STATE_ID, SKAPAD_DATUM, ANDRAD_DATUM, SOCKENX, FILTRERADEFAST.FASTIGHET from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw left OUTER JOIN FILTRERADEFAST on FILTRERADEFAST.FASTIGHET = Flaggskiktet_p_evw.FASTIGHET where coalesce( FILTRERADEFAST.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET,Flaggskiktet_p_evw.FASTIGHET_TILLSTAND) is not null and SOCKENX is not null)

,fastigheter as (select max(selection.SOCKENX) socken, max(selection .STATUS) status,coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND) f from selection GROUP BY  coalesce( FASTIGHET,evwFASTIGHET,FASTIGHET_TILLSTAND)) ,
fnrz as (select fnr,beteckning,socken,fastigheter.status from sde_geofir_gotland.gng.FA_FASTIGHET q inner join fastigheter on FASTIGHETER.F = beteckning)
    select * into #Fnrz from FNRZ
; end ELSE begin drop table #fnrz goto startz end
;-- -. . -..- - / . -. - .-. -.--
;


if (select 1) is null
begin
    declare @time as SMALLDATETIME
    set @time = getdate();
    with
    Q AS (SELECT FNR, INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT , UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND, KORTNAMN NAMN FROM SDE_GEOFIR_GOTLAND.GNG.FA_LAGFART_V2 WHERE FNR in (select fnr from #fnrz))
    ,Z AS (SELECT FNR, NAMN,INSKDATUM, andel,PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT FROM Q UNION SELECT FNR, NAMN,INSKDATUM, ANDEL, PERSORGNR, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND FROM Q)
    ,FA_LAGFART as (SELECT FNR,NAMN, INSKDATUM,ANDEL, PERSORGNR, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT FROM Z WHERE coalesce(FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT) IS NOT NULL)
    ,q2 as (select FNR, PERSORGNR, ANDEL,
	 KORTNAMN  NAMN
	 , FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND
    FROM sde_geofir_gotland.gng.FA_TAXERINGAGARE_V2 where FNR in (select fnr from #fnrz))

    ,z2 as(select FNR, PERSORGNR, ANDEL, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, SAL_CO, SAL_UTADR1, SAL_UTADR2, SAL_POSTNR, SAL_POSTORT from Q2 union select FNR, PERSORGNR, ANDEL, NAMN, UA_UTADR1, UA_UTADR2, UA_UTADR3, UA_UTADR4, UA_LAND from Q2)
    ,FA_TAXERINGAGARE as (select FNR, PERSORGNR, ANDEL, NAMN, nullif(FAL_CO, '')  FAL_CO, nullif(FAL_UTADR1, '') FAL_UTADR1, nullif(FAL_UTADR2, '') FAL_UTADR2, nullif(FAL_POSTNR, '') FAL_POSTNR, nullif(FAL_POSTORT, '') FAL_POSTORT from z2 WHERE coalesce(nullif(FAL_CO, ''), nullif(FAL_UTADR1, ''), nullif(FAL_UTADR2, ''), nullif(FAL_POSTNR, ''), nullif(FAL_POSTORT, '')) IS NOT NULL)
    ,combined as (select FNR, PERSORGNR, andel, Namn, INSKDATUM,FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_LAGFART union select FNR, PERSORGNR, ANDEL, NAMN, @time, 	FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from FA_TAXERINGAGARE)
    ,andelad as (select case when  charindex('/', ANDEL, 1) > 0 then try_cast(left(ANDEL, charindex('/', ANDEL, 1) - 1) as float) / try_cast(right(ANDEL, len(ANDEL) - charindex('/', ANDEL, 1)) as float)end as ANDEL, FNR, PERSORGNR, NAMN, INSKDATUM, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from COMBINED)
    ,grouped as (select FNR, PERSORGNR, min(ANDEL) AndelMin, NAMN, min(INSKDATUM) InsksDatMin, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT from ANDELAD GROUP BY FNR, PERSORGNR, NAMN, FAL_CO, FAL_UTADR1, FAL_UTADR2, FAL_POSTNR, FAL_POSTORT)
    ,medFastighetsAgare as (
    select FNR, PERSORGNR, format(ANDELMIN,'0.00') ANDELMIN, NAMN,
	  nullif(INSKSDATMIN,@time) INSKSDATMIN,
	   ltrim(CONCAT( case when FAL_POSTNR is null then fal_co else  nullif('c/o '+FAL_CO+', ','c/o , ') end, FAL_UTADR1+' ', FAL_UTADR2 + ', ',FAL_POSTNR,' ' +FAL_POSTORt)) ADRESS,
	    fal_postort postort,fal_postnr postnr,
	   case when INSKSDATMIN = @time then 'FA_TAXERINGAGARE' else 'FA_LAGFART' end as source
    from GROUPED
    UNION
    select REALESTATEKEY, PERSONORGANISATIONNR ,
	 format(case when charindex('/', SHAREPART, 1) > 0 then try_cast(left(SHAREPART, charindex('/', SHAREPART, 1) - 1) as float) / try_cast(right(SHAREPART, len(SHAREPART) - charindex('/', SHAREPART, 1)) as float)end,'0.00') ANDEL
	 , Name NAMN, regdt
	 ,Address,
	   null postort,null postnr,
	     'info_CurrentOwner'
    from
    sde_geofir_gotland.gng.info_CurrentOwner --sde_geofir_gotland.gng.FASTIGHETSÄGARE
    where REALESTATEKEY in (select fnr from #fnrz)and Address is not null
    ),
    fardig as (
    select FNR, PERSORGNR, min(ANDELMIN) andel,
	    NAMN
	      , format(nullif(min(INSKSDATMIN), @TIME), 'yyyy MMdd')                                             INSKDATUM
	      , replace(replace(replace(ADRESS,'  ',' '), isnull(' ' + max(POSTNR), ''), ''), isnull(', ' + max(POSTORT), ''), '') ADRESS
	      , max(POSTORT)                                                                                     POSTORT
	      , max(POSTNR)                                                                                      POSTNR
	      ,

	   case when  max(POSTORT) is null
		then 'info_currentOwner'
	       else
		    case when  min(INSKSDATMIN) is null then 'FA_TAXERINGAGARE'
			    else 'FA_LAGFART' end
	       end
	       as source

    from medFastighetsAgare GROUP BY FNR, PERSORGNR, NAMN, ADRESS)
    select * from FARDIG


    ORDER BY fnr,PERSORGNR,source
end


    select socken,count(*) c from #Fnrz
    where status = 'röd'
    GROUP BY socken
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'bj�rke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fr�jel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken),

     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STIntersects(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape

from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fr�jel' and
Fastighetsbeteckning like 'fr�jel ansarve%' or
Fastighetsbeteckning in (           'Fr�jel Hallg�rds 1:2',

'Fr�jel G�stavs 5:1',

'Fr�jel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

WHERE left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma'
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE #tempTable
(
                            INTDIARIENUMMERLOEPNUMMER int,
                            STRFASTIGHETSBETECKNING nvarchar(max),
                            STRFNRID int
)
CREATE INDEX tempBet on #tempTable (STRFASTIGHETSBETECKNING);


INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3620, 'DALHEM ANDERBÅTELS 1:8', '984');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3974, 'FRÖJEL MULDE 1:48', '949');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3747, 'FRÖJEL GÖSTAVS 1:26', '948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3721, 'KLINTE MÖLNER 1:2', '910');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3718, 'KLINTE LOGGARVE 1:50', '908');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3692, 'KLINTE HUNNINGE 1:16', '90068752');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3911, 'DALHEM VIDUNGE 1:25', '90066935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (713, 'FOLLINGBO ROSENDAL 1:39', '90063123');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (712, 'FOLLINGBO ROSENDAL 1:38', '90063122');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (711, 'FOLLINGBO ROSENDAL 1:37', '90063121');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (710, 'FOLLINGBO ROSENDAL 1:36', '90063120');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (709, 'FOLLINGBO ROSENDAL 1:35', '90063119');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3542, 'ROMA AJMUNDS 1:10', '90037623');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3781, 'KLINTE VALLE 1:196', '90027227');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3765, 'KLINTE TYRVALDS 1:42', '90027013');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3746, 'KLINTE SVARVARE 1:13', '90026962');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3734, 'KLINTE ROBBJÄNS 1:34', '90026546');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3733, 'KLINTE ROBBJÄNS 1:27', '90026539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3727, 'KLINTE PRÄSTGÅRDEN 1:13', '90026477');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3725, 'KLINTE PRÄSTGÅRDEN 1:10', '90026474');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3730, 'KLINTE PRÄSTGÅRDEN 1:7', '90026471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3729, 'KLINTE PRÄSTGÅRDEN 1:6', '90026470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3728, 'KLINTE PRÄSTGÅRDEN 1:3', '90026467');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3905, 'DALHEM VIDUNGE 1:10', '90007412');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3894, 'DALHEM SIGGUR 1:46', '90007347');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3885, 'DALHEM RÄKARVE 1:23', '90007298');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3871, 'DALHEM NYGÅRDS 1:2', '90007208');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3786, 'DALHEM HALLVIDE 1:52', '90007141');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4005, 'FRÖJEL STORA SOLBJÄRGE 5:2', '878');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3637, 'DALHEM BUSARVE 1:20', '771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3626, 'DALHEM BINGE 1:3', '770');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3604, 'DALHEM ANDERBÅTELS 1:19', '769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3909, 'DALHEM VIDUNGE 1:20', '745');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3933, 'BJÖRKE TYNNE 1:4', '673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3584, 'GANTHEM TULE 1:27', '641');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3568, 'GANTHEM KUMBLE 2:6', '640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3562, 'GANTHEM HARTVIKS 1:31', '639');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3598, 'FRÖJEL ALSTÄDE 1:39', '618');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3719, 'KLINTE MÖLNER 1:18', '605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4054, 'BJÖRKE TYNNE 1:12', '524');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3570, 'GANTHEM KUMBLE 4:2', '438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3558, 'GANTHEM GODRINGS 1:22', '437');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3546, 'GANTHEM GARDESE 1:11', '436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3976, 'FRÖJEL NYMANS 1:7', '423');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3599, 'FRÖJEL ALSTÄDE 1:40', '422');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3545, 'GANTHEM EKEBYS 2:1', '391');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3749, 'KLINTE SVARVARE 1:21', '3575');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3723, 'KLINTE MÖLNER 1:5', '3570');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3956, 'FRÖJEL LILLA HAJDES 2:2', '3488');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3910, 'DALHEM VIDUNGE 1:23', '3455');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3901, 'DALHEM SLITEGÅRDS 1:19', '3453');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3887, 'DALHEM RÄKARVE 3:1', '3452');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3884, 'DALHEM RÄKARVE 1:18', '3451');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3863, 'DALHEM KAUNGS 1:18', '3450');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3632, 'DALHEM BUSARVE 1:16', '3448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3907, 'DALHEM VIDUNGE 1:17', '340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3763, 'DALHEM HALLFOSE 1:5', '338');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3759, 'DALHEM HALLFOSE 1:3', '301');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3634, 'DALHEM BUSARVE 1:18', '296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3711, 'FRÖJEL DÄPPS 2:1', '280');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3677, 'FRÖJEL ANSARVE 1:63', '278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3807, 'ROMA TIMANS 2:1', '2626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3806, 'ROMA TIMANS 1:20', '2336');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3663, 'ROMA SNAUVALDS 1:14', '2335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3963, 'FRÖJEL MULDE 1:16', '224');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3955, 'FRÖJEL LILLA HAJDES 1:4', '223');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3262, 'VÄSKINDE KNUTS 1:7', '2222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4056, 'FRÖJEL KAUPE 1:3', '222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3873, 'DALHEM NYGÅRDS 1:9', '212');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3656, 'ROMA LILLA VÄLLER 1:12', '2115');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3790, 'DALHEM HARSTÄDE 1:1', '209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3722, 'KLINTE MÖLNER 1:21', '1974');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3896, 'DALHEM SIGGUR 1:49', '158');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3872, 'DALHEM NYGÅRDS 1:8', '157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3661, 'ROMA SNAUVALDS 1:13', '1143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3650, 'ROMA KLOSTER 1:142', '1134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3548, 'GANTHEM GARDESE 1:20', '1095');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3970, 'FRÖJEL MULDE 1:36', '1088');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3881, 'DALHEM PRÄSTGÅRDEN 1:12', '1062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3864, 'DALHEM KAUNGS 1:3', '1061');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3794, 'DALHEM HÄSSELBY 1:5', '1060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3768, 'DALHEM HALLVIDE 1:11', '1057');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3685, 'DALHEM GRINDER 1:4', '1056');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3931, 'BJÖRKE TYNNE 1:16', '090071889');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3811, 'BJÖRKE BJÖRKSARVE 1:21', '090071808');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3903, 'DALHEM SLITEGÅRDS 2:2', '090071593');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3704, 'FRÖJEL BOTTARVE 1:55', '090071542');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3703, 'FRÖJEL BOTTARVE 1:54', '090071541');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3615, 'HALLA BROE 1:86', '090071531');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3928, 'BJÖRKE SMIDGÅRDE 1:21', '090071171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3918, 'BJÖRKE HARKVIE 1:4', '090071170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4014, 'FRÖJEL SÄLLE 1:30', '090070823');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3753, 'KLINTE SVARVARE 1:24', '090069514');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3925, 'BJÖRKE NORRGÅRDE 1:82', '090069316');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3538, 'GANTHEM BÅTELS 1:21', '090068942');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3624, 'HALLA DALBO 2:2', '090068020');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3771, 'FRÖJEL GÖSTAVS 3:5', '090067503');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3784, 'KLINTE VALLE 1:229', '090067278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3783, 'FRÖJEL GÖSTAVS 5:4', '090067193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3780, 'FRÖJEL GÖSTAVS 5:3', '090067192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3777, 'FRÖJEL GÖSTAVS 5:2', '090067191');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3751, 'KLINTE SVARVARE 1:23', '090066905');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4059, 'GANTHEM HARTVIKS 1:47', '090066834');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3565, 'GANTHEM HARTVIKS 1:45', '090066832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3587, 'GANTHEMS ANNEX 1:3', '090066811');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3737, 'KLINTE ROBBJÄNS 1:76', '090066069');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3659, 'ROMA LILLA VÄLLER 1:15', '090065759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3973, 'FRÖJEL MULDE 1:47', '090065283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3564, 'GANTHEM HARTVIKS 1:44', '090064706');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3800, 'ROMA SNAUVALDS 1:20', '090064501');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3810, 'BJÖRKE BJÖRKSARVE 1:20', '090063894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3551, 'GANTHEM GARDESE 1:30', '090063387');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3736, 'KLINTE ROBBJÄNS 1:75', '090063299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3898, 'DALHEM SIGGUR 1:52', '090063049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3826, 'HALLA HALLEGÅRDE 1:49', '090062832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3640, 'DALHEM DUNE 2:3', '090062711');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3989, 'FRÖJEL ROVIDE 1:32', '090062398');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3988, 'FRÖJEL ROVIDE 1:31', '090062397');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3987, 'FRÖJEL ROVIDE 1:30', '090062396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3583, 'GANTHEM TOMASE 1:26', '090062147');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3638, 'DALHEM DUNE 2:2', '090061877');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3569, 'GANTHEM KUMBLE 2:7', '090061852');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3782, 'KLINTE VALLE 1:224', '090061704');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3702, 'FRÖJEL BOTTARVE 1:51', '090061569');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4013, 'FRÖJEL SÄLLE 1:26', '090061530');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4012, 'FRÖJEL SÄLLE 1:25', '090061529');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4011, 'FRÖJEL SÄLLE 1:24', '090061528');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3803, 'ROMA STORA VÄLLER 2:1', '090038245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3801, 'ROMA STORA VÄLLER 1:31', '090038239');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3799, 'ROMA SNAUVALDS 1:19', '090038209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3660, 'ROMA SNAUVALDS 1:11', '090038201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3658, 'ROMA LILLA VÄLLER 1:14', '090038144');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3657, 'ROMA LILLA VÄLLER 1:13', '090038143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3654, 'ROMA LARSARVE 1:45', '090038111');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3653, 'ROMA KLOSTER 1:186', '090038019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3651, 'ROMA KLOSTER 1:170', '090038003');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3649, 'ROMA KLOSTER 1:134', '090037967');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3647, 'ROMA KLOSTER 1:128', '090037961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3646, 'ROMA KARBY 1:29', '090037830');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3645, 'ROMA DISKARVE 1:13', '090037784');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3644, 'ROMA BUSARVE 1:32', '090037751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3639, 'ROMA BOTTÄNGEN 10:3', '090037720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3643, 'ROMA BOTTÄNGEN 9:2', '090037717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3642, 'ROMA BOTTÄNGEN 9:1', '090037716');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3641, 'ROMA BOTTÄNGEN 6:1', '090037713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3554, 'ROMA BJÄRS 1:31', '090037709');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3547, 'ROMA BJÄRS 1:17', '090037696');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3544, 'ROMA AJMUNDS 1:17', '090037629');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3787, 'KLINTE VÄRSÄNDE 1:12', '090027296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3785, 'KLINTE VALLE 1:53', '090027084');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3779, 'KLINTE TYRVALDS 1:55', '090027026');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3776, 'KLINTE TYRVALDS 1:54', '090027025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3774, 'KLINTE TYRVALDS 1:51', '090027022');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3770, 'KLINTE TYRVALDS 1:50', '090027021');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3769, 'KLINTE TYRVALDS 1:48', '090027019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3766, 'KLINTE TYRVALDS 1:46', '090027017');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3764, 'KLINTE TYRVALDS 1:38', '090027009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3761, 'KLINTE TYRVALDS 1:35', '090027006');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3760, 'KLINTE TYRVALDS 1:28', '090026999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3758, 'KLINTE SVARVARE 2:1', '090026972');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3748, 'KLINTE SVARVARE 1:15', '090026964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3745, 'KLINTE SVARVARE 1:11', '090026960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3743, 'KLINTE SVARVARE 1:10', '090026959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3756, 'KLINTE SVARVARE 1:8', '090026957');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3755, 'KLINTE SVARVARE 1:3', '090026952');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3741, 'KLINTE STORA SNÖGRINDE 1:7', '090026760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3740, 'KLINTE SICKLINGS 1:99', '090026695');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3739, 'KLINTE SICKLINGS 1:64', '090026660');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3738, 'KLINTE SICKLINGS 1:4', '090026600');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3735, 'KLINTE ROBBJÄNS 1:52', '090026564');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3732, 'KLINTE RANNARVE 1:34', '090026512');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3731, 'KLINTE RANNARVE 1:14', '090026492');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3726, 'KLINTE PRÄSTGÅRDEN 1:11', '090026475');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3724, 'KLINTE ODVALDS 1:18', '090026446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3717, 'KLINTE LOGGARVE 1:48', '090026392');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3714, 'KLINTE LOGGARVE 1:35', '090026379');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3712, 'KLINTE LOGGARVE 1:34', '090026378');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3710, 'KLINTE LILLA SNÖGRINDE 1:50', '090026339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3709, 'KLINTE LILLA SNÖGRINDE 1:46', '090026335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3708, 'KLINTE LILLA SNÖGRINDE 1:45', '090026334');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3707, 'KLINTE LILLA SNÖGRINDE 1:44', '090026333');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3705, 'KLINTE LILLA SNÖGRINDE 1:39', '090026328');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3701, 'KLINTE LILLA SNÖGRINDE 1:38', '090026327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4061, 'KLINTE KLINTEBYS 1:4', '090026275');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3698, 'KLINTE KLINTEBYS 1:3', '090026274');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3696, 'KLINTE KLINTEBYS 1:2', '090026273');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3690, 'KLINTE HUNNINGE 1:14', '090026203');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3687, 'KLINTE HUNNINGE 1:12', '090026201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3694, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3695, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3859, 'HALLA UNSARVE 1:22', '090019806');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3858, 'HALLA UNSARVE 1:21', '090019805');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3857, 'HALLA UNSARVE 1:20', '090019804');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3856, 'HALLA UNSARVE 1:19', '090019803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3855, 'HALLA UNSARVE 1:17', '090019801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3854, 'HALLA UNSARVE 1:16', '090019800');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3853, 'HALLA UNSARVE 1:15', '090019799');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3861, 'HALLA UNSARVE 1:8', '090019792');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3860, 'HALLA UNSARVE 1:6', '090019790');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3849, 'HALLA TULE 1:11', '090019780');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3852, 'HALLA TULE 1:9', '090019778');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3851, 'HALLA TULE 1:8', '090019777');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3850, 'HALLA TULE 1:2', '090019771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3847, 'HALLA TOMTE 1:27', '090019769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3846, 'HALLA TOMTE 1:23', '090019765');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3845, 'HALLA TOMTE 1:16', '090019758');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3844, 'HALLA TOMTE 1:14', '090019756');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3843, 'HALLA TOMTE 1:13', '090019755');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3848, 'HALLA TOMTE 1:9', '090019751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3842, 'HALLA RANTARVE 1:18', '090019740');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3841, 'HALLA RANTARVE 1:17', '090019739');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3840, 'HALLA RANTARVE 1:16', '090019738');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3839, 'HALLA RANTARVE 1:15', '090019737');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3838, 'HALLA RANTARVE 1:14', '090019736');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3837, 'HALLA RANTARVE 1:13', '090019735');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3836, 'HALLA RANTARVE 1:12', '090019734');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3835, 'HALLA NYGRANNE 1:16', '090019722');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3834, 'HALLA NYGRANNE 1:15', '090019721');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3833, 'HALLA NYGRANNE 1:14', '090019720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3832, 'HALLA NYGRANNE 1:13', '090019719');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3831, 'HALLA NYGRANNE 1:11', '090019717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3830, 'HALLA MÖLLEBOS 1:16', '090019698');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3829, 'HALLA KYRKOGÅRDEN 1:1', '090019682');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3828, 'HALLA KAMBS 1:3', '090019679');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3825, 'HALLA HALLEGÅRDE 1:48', '090019676');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3824, 'HALLA HALLEGÅRDE 1:47', '090019675');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3823, 'HALLA HALLEGÅRDE 1:46', '090019674');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3822, 'HALLA HALLEGÅRDE 1:45', '090019673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3821, 'HALLA HALLEGÅRDE 1:44', '090019672');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3820, 'HALLA HALLEGÅRDE 1:42', '090019670');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3819, 'HALLA HALLEGÅRDE 1:40', '090019668');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3818, 'HALLA HALLEGÅRDE 1:39', '090019667');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3817, 'HALLA HALLEGÅRDE 1:36', '090019664');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3816, 'HALLA HALLEGÅRDE 1:33', '090019661');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3539, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3668, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3815, 'HALLA HALLEGÅRDE 1:28', '090019656');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3629, 'HALLA HALLEGÅRDE 1:22', '090019650');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3627, 'HALLA HALLEGÅRDE 1:12', '090019640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3625, 'HALLA HALLEGÅRDE 1:10', '090019638');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3827, 'HALLA HALLEGÅRDE 1:5', '090019633');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3623, 'HALLA DALBO 2:1', '090019628');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3619, 'HALLA DALBO 1:4', '090019626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3613, 'HALLA BROE 1:85', '090019621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3611, 'HALLA BROE 1:80', '090019616');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3609, 'HALLA BROE 1:78', '090019614');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3608, 'HALLA BROE 1:74', '090019610');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3605, 'HALLA BROE 1:72', '090019608');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3603, 'HALLA BROE 1:70', '090019606');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3601, 'HALLA BROE 1:69', '090019605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3597, 'HALLA BROE 1:66', '090019602');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3594, 'HALLA BROE 1:65', '090019601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3591, 'HALLA BROE 1:59', '090019595');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3590, 'HALLA BROE 1:50', '090019586');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3589, 'HALLA BROE 1:45', '090019581');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3588, 'HALLA BROE 1:37', '090019573');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3602, 'HALLA BROE 1:7', '090019543');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3576, 'HALLA ANNEX 1:2', '090019535');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3586, 'GANTHEM TULE 1:35', '090016108');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3585, 'GANTHEM TULE 1:31', '090016104');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3582, 'GANTHEM TOMASE 1:25', '090016075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3862, 'HALLA VIBY 1:1', '090016060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3581, 'GANTHEM SMISS 1:28', '090016050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3580, 'GANTHEM SMISS 1:27', '090016049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3579, 'GANTHEM SMISS 1:23', '090016046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3578, 'GANTHEM SMISS 1:21', '090016044');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3577, 'GANTHEM SMISS 1:14', '090016037');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3575, 'GANTHEM SMIDGÅRDE 1:5', '090016023');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3574, 'GANTHEM NORRBYS 1:18', '090016011');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4060, 'GANTHEM NORRBYS 1:16', '090016009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3572, 'GANTHEM NORRBYS 1:11', '090016004');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3567, 'GANTHEM KUMBLE 2:5', '090015978');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3566, 'GANTHEM HARTVIKS 2:1', '090015960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3563, 'GANTHEM HARTVIKS 1:40', '090015959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3560, 'GANTHEM GODRINGS 3:1', '090015911');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3559, 'GANTHEM GODRINGS 1:25', '090015909');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3557, 'GANTHEM GODRINGS 1:20', '090015904');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3556, 'GANTHEM GODRINGS 1:19', '090015903');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3555, 'GANTHEM GODRINGS 1:15', '090015899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3553, 'GANTHEM GARDESE 4:1', '090015883');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3552, 'GANTHEM GARDESE 3:1', '090015882');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3550, 'GANTHEM GARDESE 1:29', '090015880');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3549, 'GANTHEM GARDESE 1:28', '090015879');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3543, 'GANTHEM EKEBYS 1:34', '090015850');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3541, 'GANTHEM EKEBYS 1:33', '090015849');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3540, 'GANTHEM EKEBYS 1:31', '090015847');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4058, 'GANTHEM BÅTELS 5:1', '090015814');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3537, 'GANTHEM BÅTELS 1:15', '090015803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3536, 'GANTHEM BÅTELS 1:14', '090015802');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3534, 'GANTHEM BÅTELS 1:13', '090015801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4016, 'FRÖJELS ANNEX 1:3', '090013479');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4015, 'FRÖJELS ANNEX 1:2', '090013478');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4010, 'FRÖJEL SÄLLE 1:22', '090013472');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4009, 'FRÖJEL SÄLLE 1:21', '090013471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4008, 'FRÖJEL SÄLLE 1:20', '090013470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4007, 'FRÖJEL SÄLLE 1:16', '090013466');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4057, 'FRÖJEL SÄLLE 1:13', '090013463');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3986, 'FRÖJEL ROVIDE 1:29', '090013461');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4003, 'FRÖJEL STORA SOLBJÄRGE 4:1', '090013448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4002, 'FRÖJEL STORA SOLBJÄRGE 2:1', '090013446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4001, 'FRÖJEL STORA SOLBJÄRGE 1:20', '090013427');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3999, 'FRÖJEL STORA HAJDES 3:1', '090013407');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3996, 'FRÖJEL STENSTUGU 1:18', '090013396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3995, 'FRÖJEL STENSTUGU 1:17', '090013395');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3994, 'FRÖJEL STENSTUGU 1:15', '090013393');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3998, 'FRÖJEL STENSTUGU 1:8', '090013386');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3997, 'FRÖJEL STENSTUGU 1:3', '090013381');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3991, 'FRÖJEL SIGDARVE 1:10', '090013367');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3993, 'FRÖJEL SIGDARVE 1:8', '090013365');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3992, 'FRÖJEL SIGDARVE 1:7', '090013364');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3985, 'FRÖJEL ROVIDE 1:28', '090013357');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3984, 'FRÖJEL ROVIDE 1:23', '090013352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3983, 'FRÖJEL ROVIDE 1:12', '090013341');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3982, 'FRÖJEL ROVIDE 1:11', '090013340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3990, 'FRÖJEL ROVIDE 1:8', '090013337');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3981, 'FRÖJEL ROBSARVE 1:6', '090013327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3980, 'FRÖJEL ROBSARVE 1:4', '090013325');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3979, 'FRÖJEL PUSER 1:31', '090013318');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3975, 'FRÖJEL NYMANS 1:11', '090013285');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3978, 'FRÖJEL NYMANS 1:9', '090013283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3977, 'FRÖJEL NYMANS 1:8', '090013282');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3972, 'FRÖJEL MULDE 1:40', '090013270');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3971, 'FRÖJEL MULDE 1:39', '090013269');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3969, 'FRÖJEL MULDE 1:33', '090013263');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3968, 'FRÖJEL MULDE 1:32', '090013262');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3967, 'FRÖJEL MULDE 1:31', '090013261');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3966, 'FRÖJEL MULDE 1:30', '090013260');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3965, 'FRÖJEL MULDE 1:29', '090013259');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3964, 'FRÖJEL MULDE 1:25', '090013255');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3962, 'FRÖJEL MULDE 1:15', '090013249');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3961, 'FRÖJEL MULDE 1:12', '090013246');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3960, 'FRÖJEL MULDE 1:11', '090013245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3959, 'FRÖJEL LILLA SOLBJÄRGE 2:1', '090013235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3958, 'FRÖJEL LILLA SOLBJÄRGE 1:15', '090013234');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3957, 'FRÖJEL LILLA SOLBJÄRGE 1:14', '090013233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3954, 'FRÖJEL KYRKOGÅRDEN 1:1', '090013202');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3953, 'FRÖJEL KAUPE 2:1', '090013198');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3952, 'FRÖJEL KAUPE 1:14', '090013197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3951, 'FRÖJEL HÄGUR 1:7', '090013183');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3950, 'FRÖJEL HÄGUR 1:4', '090013180');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3949, 'FRÖJEL HÄGUR 1:3', '090013179');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3947, 'FRÖJEL HALLGÅRDS 1:22', '090013172');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3946, 'FRÖJEL HALLGÅRDS 1:21', '090013171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3945, 'FRÖJEL HALLGÅRDS 1:20', '090013170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3943, 'FRÖJEL HALLGÅRDS 1:19', '090013169');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3942, 'FRÖJEL HALLGÅRDS 1:18', '090013168');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3939, 'FRÖJEL HALLGÅRDS 1:16', '090013166');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3938, 'FRÖJEL HALLGÅRDS 1:15', '090013165');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3934, 'FRÖJEL HALLGÅRDS 1:14', '090013164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3932, 'FRÖJEL HALLGÅRDS 1:12', '090013162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3948, 'FRÖJEL HALLGÅRDS 1:9', '090013159');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3944, 'FRÖJEL HALLGÅRDS 1:2', '090013152');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3773, 'FRÖJEL GÖSTAVS 5:1', '090013150');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3767, 'FRÖJEL GÖSTAVS 1:49', '090013145');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3762, 'FRÖJEL GÖSTAVS 1:42', '090013138');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3757, 'FRÖJEL GÖSTAVS 1:38', '090013134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3754, 'FRÖJEL GÖSTAVS 1:36', '090013132');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3752, 'FRÖJEL GÖSTAVS 1:35', '090013131');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3750, 'FRÖJEL GÖSTAVS 1:29', '090013125');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3744, 'FRÖJEL GÖSTAVS 1:10', '090013106');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3742, 'FRÖJEL GANNARVE 1:9', '090013094');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3720, 'FRÖJEL GANNARVE 1:8', '090013093');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3716, 'FRÖJEL GANNARVE 1:7', '090013092');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3715, 'FRÖJEL GANNARVE 1:6', '090013091');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3713, 'FRÖJEL GANNARVE 1:4', '090013089');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3700, 'FRÖJEL BOTTARVE 1:50', '090013077');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3697, 'FRÖJEL BOTTARVE 1:48', '090013075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3693, 'FRÖJEL BOTTARVE 1:47', '090013074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3691, 'FRÖJEL BOTTARVE 1:44', '090013071');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3689, 'FRÖJEL BOTTARVE 1:43', '090013070');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3688, 'FRÖJEL BOTTARVE 1:35', '090013062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3682, 'FRÖJEL BOTTARVE 1:21', '090013048');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3681, 'FRÖJEL BOTTARVE 1:19', '090013046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3679, 'FRÖJEL BOTTARVE 1:11', '090013038');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3699, 'FRÖJEL BOTTARVE 1:5', '090013032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3678, 'FRÖJEL BOFRIDE 2:2', '090012999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3675, 'FRÖJEL ANSARVE 1:61', '090012963');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3674, 'FRÖJEL ANSARVE 1:59', '090012961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3673, 'FRÖJEL ANSARVE 1:58', '090012960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3672, 'FRÖJEL ANSARVE 1:57', '090012959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3671, 'FRÖJEL ANSARVE 1:56', '090012958');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3669, 'FRÖJEL ANSARVE 1:46', '090012948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3617, 'FRÖJEL ANSARVE 1:42', '090012944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3616, 'FRÖJEL ANSARVE 1:38', '090012940');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3614, 'FRÖJEL ANSARVE 1:16', '090012919');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3612, 'FRÖJEL ANSARVE 1:12', '090012915');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3610, 'FRÖJEL ALSTÄDE 1:41', '090012899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3596, 'FRÖJEL ALSTÄDE 1:38', '090012896');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3595, 'FRÖJEL ALSTÄDE 1:36', '090012894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3593, 'FRÖJEL ALSTÄDE 1:35', '090012893');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3592, 'FRÖJEL ALSTÄDE 1:15', '090012873');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3914, 'DALHEM VIDUNGE-STENSTUGU 1:22', '090007446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3913, 'DALHEM VIDUNGE-STENSTUGU 1:13', '090007438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3912, 'DALHEM VIDUNGE-STENSTUGU 1:11', '090007436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3908, 'DALHEM VIDUNGE 1:19', '090007420');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3906, 'DALHEM VIDUNGE 1:15', '090007416');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3904, 'DALHEM SUDERBYS 1:7', '090007385');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3900, 'DALHEM SLITEGÅRDS 1:18', '090007374');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3899, 'DALHEM SLITEGÅRDS 1:13', '090007370');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3902, 'DALHEM SLITEGÅRDS 1:6', '090007363');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3897, 'DALHEM SIGGUR 1:51', '090007352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3895, 'DALHEM SIGGUR 1:48', '090007349');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3893, 'DALHEM SIGGUR 1:38', '090007339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3892, 'DALHEM SIGGUR 1:30', '090007332');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3891, 'DALHEM SIGGUR 1:21', '090007323');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3890, 'DALHEM SIGGUR 1:20', '090007322');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3889, 'DALHEM SIGGUR 1:18', '090007320');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3888, 'DALHEM SIGGUR 1:13', '090007315');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3886, 'DALHEM RÄKARVE 1:24', '090007299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3883, 'DALHEM PRÄSTGÅRDEN 1:7', '090007265');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3882, 'DALHEM PRÄSTGÅRDEN 1:6', '090007264');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3880, 'DALHEM NÄSUNGS 3:1', '090007244');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3879, 'DALHEM NÄSUNGS 1:23', '090007242');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3878, 'DALHEM NÄSUNGS 1:22', '090007241');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3877, 'DALHEM NÄSUNGS 1:18', '090007238');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3876, 'DALHEM NÄSUNGS 1:15', '090007235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3875, 'DALHEM NÄSUNGS 1:13', '090007233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3874, 'DALHEM NÄSUNGS 1:12', '090007232');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3869, 'DALHEM MYRE 1:10', '090007205');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3870, 'DALHEM MYRE 1:9', '090007204');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3868, 'DALHEM MUNKEBOS 1:4', '090007195');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3867, 'DALHEM MUNKEBOS 1:1', '090007193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3866, 'DALHEM MALMS 1:3', '090007192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3797, 'DALHEM KAUNGS 1:16', '090007185');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3865, 'DALHEM KAUNGS 1:6', '090007176');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3792, 'DALHEM HÄSSELBY 1:11', '090007167');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3796, 'DALHEM HÄSSELBY 1:8', '090007164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3795, 'DALHEM HÄSSELBY 1:6', '090007162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3791, 'DALHEM HARSTÄDE 1:3', '090007157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3789, 'DALHEM HALLVIDE 6:1', '090007154');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3788, 'DALHEM HALLVIDE 4:5', '090007151');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3778, 'DALHEM HALLVIDE 1:47', '090007136');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4055, 'DALHEM HALLVIDE 1:45', '090007134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3772, 'DALHEM HALLVIDE 1:44', '090007133');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3686, 'DALHEM HALLFOSE 1:2', '090007086');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3684, 'DALHEM GRINDER 1:2', '090007082');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3683, 'DALHEM GRANSKOGS 1:8', '090007075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3680, 'DALHEM GRANSKOGS 1:7', '090007074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3676, 'DALHEM GANDARVE 1:17', '090007050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3665, 'DALHEM GANDARVE 1:14', '090007047');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3664, 'DALHEM DUNGÅRDE 1:24', '090007032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3662, 'DALHEM DUNGÅRDE 1:17', '090007025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3621, 'DALHEM DUNGÅRDE 1:16', '090007024');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3636, 'DALHEM BUSARVE 1:19', '090006983');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3633, 'DALHEM BUSARVE 1:17', '090006981');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3631, 'DALHEM BUSARVE 1:15', '090006979');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3630, 'DALHEM BURGE 1:6', '090006964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3622, 'DALHEM BINGE 1:14', '090006951');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3628, 'DALHEM BINGE 1:6', '090006944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3606, 'DALHEM ANDERBÅTELS 1:20', '090006937');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3600, 'DALHEM ANDERBÅTELS 1:18', '090006935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3571, 'DALHEM ANDERBÅTELS 1:17', '090006934');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3618, 'DALHEM ANDERBÅTELS 1:6', '090006924');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3941, 'BJÖRKE VARPLÖSE 1:20', '090003795');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3940, 'BJÖRKE VARPLÖSE 1:19', '090003794');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3937, 'BJÖRKE VARPLÖSE 1:18', '090003793');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3936, 'BJÖRKE TYNNE 1:8', '090003768');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3935, 'BJÖRKE TYNNE 1:6', '090003766');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3930, 'BJÖRKE STENSTUGU 1:17', '090003760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3929, 'BJÖRKE STENSTUGU 1:16', '090003759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3927, 'BJÖRKE SMIDGÅRDE 1:18', '090003742');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4053, 'BJÖRKE ODVALDS 1:11', '090003713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3924, 'BJÖRKE NORRGÅRDE 1:78', '090003700');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3923, 'BJÖRKE NORRGÅRDE 1:13', '090003635');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3922, 'BJÖRKE LIKMIDE 1:18', '090003621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3921, 'BJÖRKE LIKMIDE 1:17', '090003620');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3920, 'BJÖRKE LIKMIDE 1:10', '090003615');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3919, 'BJÖRKE KYRKOGÅRDEN 2:1', '090003607');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3917, 'BJÖRKE HAKUSE 2:2', '090003603');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3916, 'BJÖRKE HAKUSE 1:41', '090003601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3814, 'BJÖRKE HAKUSE 1:39', '090003599');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3813, 'BJÖRKE HAKUSE 1:17', '090003577');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3535, 'BJÖRKE HAKUSE 1:16', '090003576');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3808, 'BJÖRKE BJÖRKSARVE 1:19', '090003556');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3805, 'BJÖRKE BJÖRKSARVE 1:17', '090003554');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3804, 'BJÖRKE BJÖRKSARVE 1:15', '090003552');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3802, 'BJÖRKE BJÖRKSARVE 1:14', '090003551');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3812, 'BJÖRKE BJÖRKSARVE 1:8', '090003545');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3809, 'BJÖRKE BJÖRKSARVE 1:2', '090003539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3533, 'BJÖRKE ANNEX 1:4', '090003504');



select x.INTDIARIENUMMERLOEPNUMMER,q.* from (select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

WHERE left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma'

    ) q INNER JOIN #tempTable x on FASTIGHET = x.STRFASTIGHETSBETECKNING
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE #tempTable
(
                            INTDIARIENUMMERLOEPNUMMER int,
                            STRFASTIGHETSBETECKNING nvarchar(250),
                            STRFNRID int
)
CREATE INDEX tempBet on #tempTable (STRFASTIGHETSBETECKNING);


INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3620, 'DALHEM ANDERBÅTELS 1:8', '984');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3974, 'FRÖJEL MULDE 1:48', '949');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3747, 'FRÖJEL GÖSTAVS 1:26', '948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3721, 'KLINTE MÖLNER 1:2', '910');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3718, 'KLINTE LOGGARVE 1:50', '908');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3692, 'KLINTE HUNNINGE 1:16', '90068752');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3911, 'DALHEM VIDUNGE 1:25', '90066935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (713, 'FOLLINGBO ROSENDAL 1:39', '90063123');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (712, 'FOLLINGBO ROSENDAL 1:38', '90063122');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (711, 'FOLLINGBO ROSENDAL 1:37', '90063121');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (710, 'FOLLINGBO ROSENDAL 1:36', '90063120');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (709, 'FOLLINGBO ROSENDAL 1:35', '90063119');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3542, 'ROMA AJMUNDS 1:10', '90037623');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3781, 'KLINTE VALLE 1:196', '90027227');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3765, 'KLINTE TYRVALDS 1:42', '90027013');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3746, 'KLINTE SVARVARE 1:13', '90026962');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3734, 'KLINTE ROBBJÄNS 1:34', '90026546');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3733, 'KLINTE ROBBJÄNS 1:27', '90026539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3727, 'KLINTE PRÄSTGÅRDEN 1:13', '90026477');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3725, 'KLINTE PRÄSTGÅRDEN 1:10', '90026474');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3730, 'KLINTE PRÄSTGÅRDEN 1:7', '90026471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3729, 'KLINTE PRÄSTGÅRDEN 1:6', '90026470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3728, 'KLINTE PRÄSTGÅRDEN 1:3', '90026467');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3905, 'DALHEM VIDUNGE 1:10', '90007412');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3894, 'DALHEM SIGGUR 1:46', '90007347');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3885, 'DALHEM RÄKARVE 1:23', '90007298');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3871, 'DALHEM NYGÅRDS 1:2', '90007208');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3786, 'DALHEM HALLVIDE 1:52', '90007141');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4005, 'FRÖJEL STORA SOLBJÄRGE 5:2', '878');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3637, 'DALHEM BUSARVE 1:20', '771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3626, 'DALHEM BINGE 1:3', '770');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3604, 'DALHEM ANDERBÅTELS 1:19', '769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3909, 'DALHEM VIDUNGE 1:20', '745');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3933, 'BJÖRKE TYNNE 1:4', '673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3584, 'GANTHEM TULE 1:27', '641');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3568, 'GANTHEM KUMBLE 2:6', '640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3562, 'GANTHEM HARTVIKS 1:31', '639');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3598, 'FRÖJEL ALSTÄDE 1:39', '618');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3719, 'KLINTE MÖLNER 1:18', '605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4054, 'BJÖRKE TYNNE 1:12', '524');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3570, 'GANTHEM KUMBLE 4:2', '438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3558, 'GANTHEM GODRINGS 1:22', '437');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3546, 'GANTHEM GARDESE 1:11', '436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3976, 'FRÖJEL NYMANS 1:7', '423');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3599, 'FRÖJEL ALSTÄDE 1:40', '422');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3545, 'GANTHEM EKEBYS 2:1', '391');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3749, 'KLINTE SVARVARE 1:21', '3575');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3723, 'KLINTE MÖLNER 1:5', '3570');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3956, 'FRÖJEL LILLA HAJDES 2:2', '3488');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3910, 'DALHEM VIDUNGE 1:23', '3455');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3901, 'DALHEM SLITEGÅRDS 1:19', '3453');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3887, 'DALHEM RÄKARVE 3:1', '3452');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3884, 'DALHEM RÄKARVE 1:18', '3451');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3863, 'DALHEM KAUNGS 1:18', '3450');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3632, 'DALHEM BUSARVE 1:16', '3448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3907, 'DALHEM VIDUNGE 1:17', '340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3763, 'DALHEM HALLFOSE 1:5', '338');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3759, 'DALHEM HALLFOSE 1:3', '301');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3634, 'DALHEM BUSARVE 1:18', '296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3711, 'FRÖJEL DÄPPS 2:1', '280');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3677, 'FRÖJEL ANSARVE 1:63', '278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3807, 'ROMA TIMANS 2:1', '2626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3806, 'ROMA TIMANS 1:20', '2336');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3663, 'ROMA SNAUVALDS 1:14', '2335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3963, 'FRÖJEL MULDE 1:16', '224');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3955, 'FRÖJEL LILLA HAJDES 1:4', '223');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3262, 'VÄSKINDE KNUTS 1:7', '2222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4056, 'FRÖJEL KAUPE 1:3', '222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3873, 'DALHEM NYGÅRDS 1:9', '212');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3656, 'ROMA LILLA VÄLLER 1:12', '2115');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3790, 'DALHEM HARSTÄDE 1:1', '209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3722, 'KLINTE MÖLNER 1:21', '1974');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3896, 'DALHEM SIGGUR 1:49', '158');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3872, 'DALHEM NYGÅRDS 1:8', '157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3661, 'ROMA SNAUVALDS 1:13', '1143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3650, 'ROMA KLOSTER 1:142', '1134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3548, 'GANTHEM GARDESE 1:20', '1095');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3970, 'FRÖJEL MULDE 1:36', '1088');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3881, 'DALHEM PRÄSTGÅRDEN 1:12', '1062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3864, 'DALHEM KAUNGS 1:3', '1061');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3794, 'DALHEM HÄSSELBY 1:5', '1060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3768, 'DALHEM HALLVIDE 1:11', '1057');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3685, 'DALHEM GRINDER 1:4', '1056');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3931, 'BJÖRKE TYNNE 1:16', '090071889');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3811, 'BJÖRKE BJÖRKSARVE 1:21', '090071808');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3903, 'DALHEM SLITEGÅRDS 2:2', '090071593');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3704, 'FRÖJEL BOTTARVE 1:55', '090071542');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3703, 'FRÖJEL BOTTARVE 1:54', '090071541');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3615, 'HALLA BROE 1:86', '090071531');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3928, 'BJÖRKE SMIDGÅRDE 1:21', '090071171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3918, 'BJÖRKE HARKVIE 1:4', '090071170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4014, 'FRÖJEL SÄLLE 1:30', '090070823');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3753, 'KLINTE SVARVARE 1:24', '090069514');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3925, 'BJÖRKE NORRGÅRDE 1:82', '090069316');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3538, 'GANTHEM BÅTELS 1:21', '090068942');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3624, 'HALLA DALBO 2:2', '090068020');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3771, 'FRÖJEL GÖSTAVS 3:5', '090067503');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3784, 'KLINTE VALLE 1:229', '090067278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3783, 'FRÖJEL GÖSTAVS 5:4', '090067193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3780, 'FRÖJEL GÖSTAVS 5:3', '090067192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3777, 'FRÖJEL GÖSTAVS 5:2', '090067191');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3751, 'KLINTE SVARVARE 1:23', '090066905');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4059, 'GANTHEM HARTVIKS 1:47', '090066834');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3565, 'GANTHEM HARTVIKS 1:45', '090066832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3587, 'GANTHEMS ANNEX 1:3', '090066811');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3737, 'KLINTE ROBBJÄNS 1:76', '090066069');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3659, 'ROMA LILLA VÄLLER 1:15', '090065759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3973, 'FRÖJEL MULDE 1:47', '090065283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3564, 'GANTHEM HARTVIKS 1:44', '090064706');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3800, 'ROMA SNAUVALDS 1:20', '090064501');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3810, 'BJÖRKE BJÖRKSARVE 1:20', '090063894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3551, 'GANTHEM GARDESE 1:30', '090063387');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3736, 'KLINTE ROBBJÄNS 1:75', '090063299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3898, 'DALHEM SIGGUR 1:52', '090063049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3826, 'HALLA HALLEGÅRDE 1:49', '090062832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3640, 'DALHEM DUNE 2:3', '090062711');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3989, 'FRÖJEL ROVIDE 1:32', '090062398');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3988, 'FRÖJEL ROVIDE 1:31', '090062397');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3987, 'FRÖJEL ROVIDE 1:30', '090062396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3583, 'GANTHEM TOMASE 1:26', '090062147');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3638, 'DALHEM DUNE 2:2', '090061877');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3569, 'GANTHEM KUMBLE 2:7', '090061852');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3782, 'KLINTE VALLE 1:224', '090061704');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3702, 'FRÖJEL BOTTARVE 1:51', '090061569');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4013, 'FRÖJEL SÄLLE 1:26', '090061530');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4012, 'FRÖJEL SÄLLE 1:25', '090061529');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4011, 'FRÖJEL SÄLLE 1:24', '090061528');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3803, 'ROMA STORA VÄLLER 2:1', '090038245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3801, 'ROMA STORA VÄLLER 1:31', '090038239');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3799, 'ROMA SNAUVALDS 1:19', '090038209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3660, 'ROMA SNAUVALDS 1:11', '090038201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3658, 'ROMA LILLA VÄLLER 1:14', '090038144');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3657, 'ROMA LILLA VÄLLER 1:13', '090038143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3654, 'ROMA LARSARVE 1:45', '090038111');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3653, 'ROMA KLOSTER 1:186', '090038019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3651, 'ROMA KLOSTER 1:170', '090038003');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3649, 'ROMA KLOSTER 1:134', '090037967');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3647, 'ROMA KLOSTER 1:128', '090037961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3646, 'ROMA KARBY 1:29', '090037830');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3645, 'ROMA DISKARVE 1:13', '090037784');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3644, 'ROMA BUSARVE 1:32', '090037751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3639, 'ROMA BOTTÄNGEN 10:3', '090037720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3643, 'ROMA BOTTÄNGEN 9:2', '090037717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3642, 'ROMA BOTTÄNGEN 9:1', '090037716');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3641, 'ROMA BOTTÄNGEN 6:1', '090037713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3554, 'ROMA BJÄRS 1:31', '090037709');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3547, 'ROMA BJÄRS 1:17', '090037696');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3544, 'ROMA AJMUNDS 1:17', '090037629');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3787, 'KLINTE VÄRSÄNDE 1:12', '090027296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3785, 'KLINTE VALLE 1:53', '090027084');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3779, 'KLINTE TYRVALDS 1:55', '090027026');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3776, 'KLINTE TYRVALDS 1:54', '090027025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3774, 'KLINTE TYRVALDS 1:51', '090027022');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3770, 'KLINTE TYRVALDS 1:50', '090027021');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3769, 'KLINTE TYRVALDS 1:48', '090027019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3766, 'KLINTE TYRVALDS 1:46', '090027017');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3764, 'KLINTE TYRVALDS 1:38', '090027009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3761, 'KLINTE TYRVALDS 1:35', '090027006');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3760, 'KLINTE TYRVALDS 1:28', '090026999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3758, 'KLINTE SVARVARE 2:1', '090026972');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3748, 'KLINTE SVARVARE 1:15', '090026964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3745, 'KLINTE SVARVARE 1:11', '090026960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3743, 'KLINTE SVARVARE 1:10', '090026959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3756, 'KLINTE SVARVARE 1:8', '090026957');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3755, 'KLINTE SVARVARE 1:3', '090026952');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3741, 'KLINTE STORA SNÖGRINDE 1:7', '090026760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3740, 'KLINTE SICKLINGS 1:99', '090026695');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3739, 'KLINTE SICKLINGS 1:64', '090026660');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3738, 'KLINTE SICKLINGS 1:4', '090026600');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3735, 'KLINTE ROBBJÄNS 1:52', '090026564');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3732, 'KLINTE RANNARVE 1:34', '090026512');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3731, 'KLINTE RANNARVE 1:14', '090026492');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3726, 'KLINTE PRÄSTGÅRDEN 1:11', '090026475');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3724, 'KLINTE ODVALDS 1:18', '090026446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3717, 'KLINTE LOGGARVE 1:48', '090026392');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3714, 'KLINTE LOGGARVE 1:35', '090026379');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3712, 'KLINTE LOGGARVE 1:34', '090026378');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3710, 'KLINTE LILLA SNÖGRINDE 1:50', '090026339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3709, 'KLINTE LILLA SNÖGRINDE 1:46', '090026335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3708, 'KLINTE LILLA SNÖGRINDE 1:45', '090026334');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3707, 'KLINTE LILLA SNÖGRINDE 1:44', '090026333');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3705, 'KLINTE LILLA SNÖGRINDE 1:39', '090026328');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3701, 'KLINTE LILLA SNÖGRINDE 1:38', '090026327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4061, 'KLINTE KLINTEBYS 1:4', '090026275');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3698, 'KLINTE KLINTEBYS 1:3', '090026274');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3696, 'KLINTE KLINTEBYS 1:2', '090026273');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3690, 'KLINTE HUNNINGE 1:14', '090026203');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3687, 'KLINTE HUNNINGE 1:12', '090026201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3694, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3695, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3859, 'HALLA UNSARVE 1:22', '090019806');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3858, 'HALLA UNSARVE 1:21', '090019805');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3857, 'HALLA UNSARVE 1:20', '090019804');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3856, 'HALLA UNSARVE 1:19', '090019803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3855, 'HALLA UNSARVE 1:17', '090019801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3854, 'HALLA UNSARVE 1:16', '090019800');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3853, 'HALLA UNSARVE 1:15', '090019799');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3861, 'HALLA UNSARVE 1:8', '090019792');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3860, 'HALLA UNSARVE 1:6', '090019790');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3849, 'HALLA TULE 1:11', '090019780');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3852, 'HALLA TULE 1:9', '090019778');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3851, 'HALLA TULE 1:8', '090019777');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3850, 'HALLA TULE 1:2', '090019771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3847, 'HALLA TOMTE 1:27', '090019769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3846, 'HALLA TOMTE 1:23', '090019765');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3845, 'HALLA TOMTE 1:16', '090019758');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3844, 'HALLA TOMTE 1:14', '090019756');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3843, 'HALLA TOMTE 1:13', '090019755');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3848, 'HALLA TOMTE 1:9', '090019751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3842, 'HALLA RANTARVE 1:18', '090019740');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3841, 'HALLA RANTARVE 1:17', '090019739');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3840, 'HALLA RANTARVE 1:16', '090019738');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3839, 'HALLA RANTARVE 1:15', '090019737');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3838, 'HALLA RANTARVE 1:14', '090019736');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3837, 'HALLA RANTARVE 1:13', '090019735');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3836, 'HALLA RANTARVE 1:12', '090019734');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3835, 'HALLA NYGRANNE 1:16', '090019722');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3834, 'HALLA NYGRANNE 1:15', '090019721');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3833, 'HALLA NYGRANNE 1:14', '090019720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3832, 'HALLA NYGRANNE 1:13', '090019719');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3831, 'HALLA NYGRANNE 1:11', '090019717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3830, 'HALLA MÖLLEBOS 1:16', '090019698');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3829, 'HALLA KYRKOGÅRDEN 1:1', '090019682');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3828, 'HALLA KAMBS 1:3', '090019679');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3825, 'HALLA HALLEGÅRDE 1:48', '090019676');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3824, 'HALLA HALLEGÅRDE 1:47', '090019675');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3823, 'HALLA HALLEGÅRDE 1:46', '090019674');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3822, 'HALLA HALLEGÅRDE 1:45', '090019673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3821, 'HALLA HALLEGÅRDE 1:44', '090019672');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3820, 'HALLA HALLEGÅRDE 1:42', '090019670');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3819, 'HALLA HALLEGÅRDE 1:40', '090019668');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3818, 'HALLA HALLEGÅRDE 1:39', '090019667');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3817, 'HALLA HALLEGÅRDE 1:36', '090019664');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3816, 'HALLA HALLEGÅRDE 1:33', '090019661');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3539, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3668, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3815, 'HALLA HALLEGÅRDE 1:28', '090019656');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3629, 'HALLA HALLEGÅRDE 1:22', '090019650');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3627, 'HALLA HALLEGÅRDE 1:12', '090019640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3625, 'HALLA HALLEGÅRDE 1:10', '090019638');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3827, 'HALLA HALLEGÅRDE 1:5', '090019633');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3623, 'HALLA DALBO 2:1', '090019628');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3619, 'HALLA DALBO 1:4', '090019626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3613, 'HALLA BROE 1:85', '090019621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3611, 'HALLA BROE 1:80', '090019616');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3609, 'HALLA BROE 1:78', '090019614');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3608, 'HALLA BROE 1:74', '090019610');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3605, 'HALLA BROE 1:72', '090019608');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3603, 'HALLA BROE 1:70', '090019606');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3601, 'HALLA BROE 1:69', '090019605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3597, 'HALLA BROE 1:66', '090019602');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3594, 'HALLA BROE 1:65', '090019601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3591, 'HALLA BROE 1:59', '090019595');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3590, 'HALLA BROE 1:50', '090019586');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3589, 'HALLA BROE 1:45', '090019581');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3588, 'HALLA BROE 1:37', '090019573');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3602, 'HALLA BROE 1:7', '090019543');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3576, 'HALLA ANNEX 1:2', '090019535');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3586, 'GANTHEM TULE 1:35', '090016108');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3585, 'GANTHEM TULE 1:31', '090016104');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3582, 'GANTHEM TOMASE 1:25', '090016075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3862, 'HALLA VIBY 1:1', '090016060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3581, 'GANTHEM SMISS 1:28', '090016050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3580, 'GANTHEM SMISS 1:27', '090016049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3579, 'GANTHEM SMISS 1:23', '090016046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3578, 'GANTHEM SMISS 1:21', '090016044');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3577, 'GANTHEM SMISS 1:14', '090016037');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3575, 'GANTHEM SMIDGÅRDE 1:5', '090016023');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3574, 'GANTHEM NORRBYS 1:18', '090016011');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4060, 'GANTHEM NORRBYS 1:16', '090016009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3572, 'GANTHEM NORRBYS 1:11', '090016004');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3567, 'GANTHEM KUMBLE 2:5', '090015978');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3566, 'GANTHEM HARTVIKS 2:1', '090015960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3563, 'GANTHEM HARTVIKS 1:40', '090015959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3560, 'GANTHEM GODRINGS 3:1', '090015911');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3559, 'GANTHEM GODRINGS 1:25', '090015909');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3557, 'GANTHEM GODRINGS 1:20', '090015904');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3556, 'GANTHEM GODRINGS 1:19', '090015903');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3555, 'GANTHEM GODRINGS 1:15', '090015899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3553, 'GANTHEM GARDESE 4:1', '090015883');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3552, 'GANTHEM GARDESE 3:1', '090015882');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3550, 'GANTHEM GARDESE 1:29', '090015880');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3549, 'GANTHEM GARDESE 1:28', '090015879');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3543, 'GANTHEM EKEBYS 1:34', '090015850');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3541, 'GANTHEM EKEBYS 1:33', '090015849');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3540, 'GANTHEM EKEBYS 1:31', '090015847');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4058, 'GANTHEM BÅTELS 5:1', '090015814');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3537, 'GANTHEM BÅTELS 1:15', '090015803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3536, 'GANTHEM BÅTELS 1:14', '090015802');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3534, 'GANTHEM BÅTELS 1:13', '090015801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4016, 'FRÖJELS ANNEX 1:3', '090013479');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4015, 'FRÖJELS ANNEX 1:2', '090013478');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4010, 'FRÖJEL SÄLLE 1:22', '090013472');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4009, 'FRÖJEL SÄLLE 1:21', '090013471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4008, 'FRÖJEL SÄLLE 1:20', '090013470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4007, 'FRÖJEL SÄLLE 1:16', '090013466');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4057, 'FRÖJEL SÄLLE 1:13', '090013463');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3986, 'FRÖJEL ROVIDE 1:29', '090013461');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4003, 'FRÖJEL STORA SOLBJÄRGE 4:1', '090013448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4002, 'FRÖJEL STORA SOLBJÄRGE 2:1', '090013446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4001, 'FRÖJEL STORA SOLBJÄRGE 1:20', '090013427');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3999, 'FRÖJEL STORA HAJDES 3:1', '090013407');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3996, 'FRÖJEL STENSTUGU 1:18', '090013396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3995, 'FRÖJEL STENSTUGU 1:17', '090013395');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3994, 'FRÖJEL STENSTUGU 1:15', '090013393');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3998, 'FRÖJEL STENSTUGU 1:8', '090013386');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3997, 'FRÖJEL STENSTUGU 1:3', '090013381');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3991, 'FRÖJEL SIGDARVE 1:10', '090013367');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3993, 'FRÖJEL SIGDARVE 1:8', '090013365');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3992, 'FRÖJEL SIGDARVE 1:7', '090013364');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3985, 'FRÖJEL ROVIDE 1:28', '090013357');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3984, 'FRÖJEL ROVIDE 1:23', '090013352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3983, 'FRÖJEL ROVIDE 1:12', '090013341');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3982, 'FRÖJEL ROVIDE 1:11', '090013340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3990, 'FRÖJEL ROVIDE 1:8', '090013337');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3981, 'FRÖJEL ROBSARVE 1:6', '090013327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3980, 'FRÖJEL ROBSARVE 1:4', '090013325');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3979, 'FRÖJEL PUSER 1:31', '090013318');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3975, 'FRÖJEL NYMANS 1:11', '090013285');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3978, 'FRÖJEL NYMANS 1:9', '090013283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3977, 'FRÖJEL NYMANS 1:8', '090013282');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3972, 'FRÖJEL MULDE 1:40', '090013270');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3971, 'FRÖJEL MULDE 1:39', '090013269');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3969, 'FRÖJEL MULDE 1:33', '090013263');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3968, 'FRÖJEL MULDE 1:32', '090013262');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3967, 'FRÖJEL MULDE 1:31', '090013261');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3966, 'FRÖJEL MULDE 1:30', '090013260');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3965, 'FRÖJEL MULDE 1:29', '090013259');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3964, 'FRÖJEL MULDE 1:25', '090013255');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3962, 'FRÖJEL MULDE 1:15', '090013249');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3961, 'FRÖJEL MULDE 1:12', '090013246');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3960, 'FRÖJEL MULDE 1:11', '090013245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3959, 'FRÖJEL LILLA SOLBJÄRGE 2:1', '090013235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3958, 'FRÖJEL LILLA SOLBJÄRGE 1:15', '090013234');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3957, 'FRÖJEL LILLA SOLBJÄRGE 1:14', '090013233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3954, 'FRÖJEL KYRKOGÅRDEN 1:1', '090013202');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3953, 'FRÖJEL KAUPE 2:1', '090013198');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3952, 'FRÖJEL KAUPE 1:14', '090013197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3951, 'FRÖJEL HÄGUR 1:7', '090013183');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3950, 'FRÖJEL HÄGUR 1:4', '090013180');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3949, 'FRÖJEL HÄGUR 1:3', '090013179');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3947, 'FRÖJEL HALLGÅRDS 1:22', '090013172');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3946, 'FRÖJEL HALLGÅRDS 1:21', '090013171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3945, 'FRÖJEL HALLGÅRDS 1:20', '090013170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3943, 'FRÖJEL HALLGÅRDS 1:19', '090013169');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3942, 'FRÖJEL HALLGÅRDS 1:18', '090013168');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3939, 'FRÖJEL HALLGÅRDS 1:16', '090013166');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3938, 'FRÖJEL HALLGÅRDS 1:15', '090013165');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3934, 'FRÖJEL HALLGÅRDS 1:14', '090013164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3932, 'FRÖJEL HALLGÅRDS 1:12', '090013162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3948, 'FRÖJEL HALLGÅRDS 1:9', '090013159');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3944, 'FRÖJEL HALLGÅRDS 1:2', '090013152');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3773, 'FRÖJEL GÖSTAVS 5:1', '090013150');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3767, 'FRÖJEL GÖSTAVS 1:49', '090013145');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3762, 'FRÖJEL GÖSTAVS 1:42', '090013138');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3757, 'FRÖJEL GÖSTAVS 1:38', '090013134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3754, 'FRÖJEL GÖSTAVS 1:36', '090013132');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3752, 'FRÖJEL GÖSTAVS 1:35', '090013131');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3750, 'FRÖJEL GÖSTAVS 1:29', '090013125');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3744, 'FRÖJEL GÖSTAVS 1:10', '090013106');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3742, 'FRÖJEL GANNARVE 1:9', '090013094');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3720, 'FRÖJEL GANNARVE 1:8', '090013093');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3716, 'FRÖJEL GANNARVE 1:7', '090013092');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3715, 'FRÖJEL GANNARVE 1:6', '090013091');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3713, 'FRÖJEL GANNARVE 1:4', '090013089');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3700, 'FRÖJEL BOTTARVE 1:50', '090013077');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3697, 'FRÖJEL BOTTARVE 1:48', '090013075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3693, 'FRÖJEL BOTTARVE 1:47', '090013074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3691, 'FRÖJEL BOTTARVE 1:44', '090013071');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3689, 'FRÖJEL BOTTARVE 1:43', '090013070');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3688, 'FRÖJEL BOTTARVE 1:35', '090013062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3682, 'FRÖJEL BOTTARVE 1:21', '090013048');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3681, 'FRÖJEL BOTTARVE 1:19', '090013046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3679, 'FRÖJEL BOTTARVE 1:11', '090013038');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3699, 'FRÖJEL BOTTARVE 1:5', '090013032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3678, 'FRÖJEL BOFRIDE 2:2', '090012999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3675, 'FRÖJEL ANSARVE 1:61', '090012963');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3674, 'FRÖJEL ANSARVE 1:59', '090012961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3673, 'FRÖJEL ANSARVE 1:58', '090012960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3672, 'FRÖJEL ANSARVE 1:57', '090012959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3671, 'FRÖJEL ANSARVE 1:56', '090012958');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3669, 'FRÖJEL ANSARVE 1:46', '090012948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3617, 'FRÖJEL ANSARVE 1:42', '090012944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3616, 'FRÖJEL ANSARVE 1:38', '090012940');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3614, 'FRÖJEL ANSARVE 1:16', '090012919');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3612, 'FRÖJEL ANSARVE 1:12', '090012915');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3610, 'FRÖJEL ALSTÄDE 1:41', '090012899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3596, 'FRÖJEL ALSTÄDE 1:38', '090012896');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3595, 'FRÖJEL ALSTÄDE 1:36', '090012894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3593, 'FRÖJEL ALSTÄDE 1:35', '090012893');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3592, 'FRÖJEL ALSTÄDE 1:15', '090012873');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3914, 'DALHEM VIDUNGE-STENSTUGU 1:22', '090007446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3913, 'DALHEM VIDUNGE-STENSTUGU 1:13', '090007438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3912, 'DALHEM VIDUNGE-STENSTUGU 1:11', '090007436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3908, 'DALHEM VIDUNGE 1:19', '090007420');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3906, 'DALHEM VIDUNGE 1:15', '090007416');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3904, 'DALHEM SUDERBYS 1:7', '090007385');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3900, 'DALHEM SLITEGÅRDS 1:18', '090007374');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3899, 'DALHEM SLITEGÅRDS 1:13', '090007370');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3902, 'DALHEM SLITEGÅRDS 1:6', '090007363');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3897, 'DALHEM SIGGUR 1:51', '090007352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3895, 'DALHEM SIGGUR 1:48', '090007349');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3893, 'DALHEM SIGGUR 1:38', '090007339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3892, 'DALHEM SIGGUR 1:30', '090007332');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3891, 'DALHEM SIGGUR 1:21', '090007323');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3890, 'DALHEM SIGGUR 1:20', '090007322');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3889, 'DALHEM SIGGUR 1:18', '090007320');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3888, 'DALHEM SIGGUR 1:13', '090007315');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3886, 'DALHEM RÄKARVE 1:24', '090007299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3883, 'DALHEM PRÄSTGÅRDEN 1:7', '090007265');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3882, 'DALHEM PRÄSTGÅRDEN 1:6', '090007264');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3880, 'DALHEM NÄSUNGS 3:1', '090007244');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3879, 'DALHEM NÄSUNGS 1:23', '090007242');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3878, 'DALHEM NÄSUNGS 1:22', '090007241');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3877, 'DALHEM NÄSUNGS 1:18', '090007238');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3876, 'DALHEM NÄSUNGS 1:15', '090007235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3875, 'DALHEM NÄSUNGS 1:13', '090007233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3874, 'DALHEM NÄSUNGS 1:12', '090007232');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3869, 'DALHEM MYRE 1:10', '090007205');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3870, 'DALHEM MYRE 1:9', '090007204');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3868, 'DALHEM MUNKEBOS 1:4', '090007195');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3867, 'DALHEM MUNKEBOS 1:1', '090007193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3866, 'DALHEM MALMS 1:3', '090007192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3797, 'DALHEM KAUNGS 1:16', '090007185');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3865, 'DALHEM KAUNGS 1:6', '090007176');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3792, 'DALHEM HÄSSELBY 1:11', '090007167');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3796, 'DALHEM HÄSSELBY 1:8', '090007164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3795, 'DALHEM HÄSSELBY 1:6', '090007162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3791, 'DALHEM HARSTÄDE 1:3', '090007157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3789, 'DALHEM HALLVIDE 6:1', '090007154');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3788, 'DALHEM HALLVIDE 4:5', '090007151');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3778, 'DALHEM HALLVIDE 1:47', '090007136');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4055, 'DALHEM HALLVIDE 1:45', '090007134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3772, 'DALHEM HALLVIDE 1:44', '090007133');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3686, 'DALHEM HALLFOSE 1:2', '090007086');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3684, 'DALHEM GRINDER 1:2', '090007082');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3683, 'DALHEM GRANSKOGS 1:8', '090007075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3680, 'DALHEM GRANSKOGS 1:7', '090007074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3676, 'DALHEM GANDARVE 1:17', '090007050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3665, 'DALHEM GANDARVE 1:14', '090007047');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3664, 'DALHEM DUNGÅRDE 1:24', '090007032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3662, 'DALHEM DUNGÅRDE 1:17', '090007025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3621, 'DALHEM DUNGÅRDE 1:16', '090007024');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3636, 'DALHEM BUSARVE 1:19', '090006983');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3633, 'DALHEM BUSARVE 1:17', '090006981');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3631, 'DALHEM BUSARVE 1:15', '090006979');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3630, 'DALHEM BURGE 1:6', '090006964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3622, 'DALHEM BINGE 1:14', '090006951');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3628, 'DALHEM BINGE 1:6', '090006944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3606, 'DALHEM ANDERBÅTELS 1:20', '090006937');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3600, 'DALHEM ANDERBÅTELS 1:18', '090006935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3571, 'DALHEM ANDERBÅTELS 1:17', '090006934');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3618, 'DALHEM ANDERBÅTELS 1:6', '090006924');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3941, 'BJÖRKE VARPLÖSE 1:20', '090003795');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3940, 'BJÖRKE VARPLÖSE 1:19', '090003794');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3937, 'BJÖRKE VARPLÖSE 1:18', '090003793');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3936, 'BJÖRKE TYNNE 1:8', '090003768');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3935, 'BJÖRKE TYNNE 1:6', '090003766');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3930, 'BJÖRKE STENSTUGU 1:17', '090003760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3929, 'BJÖRKE STENSTUGU 1:16', '090003759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3927, 'BJÖRKE SMIDGÅRDE 1:18', '090003742');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4053, 'BJÖRKE ODVALDS 1:11', '090003713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3924, 'BJÖRKE NORRGÅRDE 1:78', '090003700');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3923, 'BJÖRKE NORRGÅRDE 1:13', '090003635');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3922, 'BJÖRKE LIKMIDE 1:18', '090003621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3921, 'BJÖRKE LIKMIDE 1:17', '090003620');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3920, 'BJÖRKE LIKMIDE 1:10', '090003615');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3919, 'BJÖRKE KYRKOGÅRDEN 2:1', '090003607');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3917, 'BJÖRKE HAKUSE 2:2', '090003603');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3916, 'BJÖRKE HAKUSE 1:41', '090003601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3814, 'BJÖRKE HAKUSE 1:39', '090003599');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3813, 'BJÖRKE HAKUSE 1:17', '090003577');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3535, 'BJÖRKE HAKUSE 1:16', '090003576');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3808, 'BJÖRKE BJÖRKSARVE 1:19', '090003556');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3805, 'BJÖRKE BJÖRKSARVE 1:17', '090003554');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3804, 'BJÖRKE BJÖRKSARVE 1:15', '090003552');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3802, 'BJÖRKE BJÖRKSARVE 1:14', '090003551');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3812, 'BJÖRKE BJÖRKSARVE 1:8', '090003545');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3809, 'BJÖRKE BJÖRKSARVE 1:2', '090003539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3533, 'BJÖRKE ANNEX 1:4', '090003504');



select x.INTDIARIENUMMERLOEPNUMMER,q.* from (select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

WHERE left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma'

    ) q INNER JOIN #tempTable x on FASTIGHET = x.STRFASTIGHETSBETECKNING
;-- -. . -..- - / . -. - .-. -.--
drop table #tempTable
CREATE TABLE #tempTable
(
                            INTDIARIENUMMERLOEPNUMMER int,
                            STRFASTIGHETSBETECKNING nvarchar(250),
                            STRFNRID int
)
CREATE INDEX tempBet on #tempTable (STRFASTIGHETSBETECKNING);


INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3620, 'DALHEM ANDERBÅTELS 1:8', '984');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3974, 'FRÖJEL MULDE 1:48', '949');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3747, 'FRÖJEL GÖSTAVS 1:26', '948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3721, 'KLINTE MÖLNER 1:2', '910');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3718, 'KLINTE LOGGARVE 1:50', '908');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3692, 'KLINTE HUNNINGE 1:16', '90068752');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3911, 'DALHEM VIDUNGE 1:25', '90066935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (713, 'FOLLINGBO ROSENDAL 1:39', '90063123');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (712, 'FOLLINGBO ROSENDAL 1:38', '90063122');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (711, 'FOLLINGBO ROSENDAL 1:37', '90063121');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (710, 'FOLLINGBO ROSENDAL 1:36', '90063120');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (709, 'FOLLINGBO ROSENDAL 1:35', '90063119');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3542, 'ROMA AJMUNDS 1:10', '90037623');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3781, 'KLINTE VALLE 1:196', '90027227');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3765, 'KLINTE TYRVALDS 1:42', '90027013');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3746, 'KLINTE SVARVARE 1:13', '90026962');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3734, 'KLINTE ROBBJÄNS 1:34', '90026546');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3733, 'KLINTE ROBBJÄNS 1:27', '90026539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3727, 'KLINTE PRÄSTGÅRDEN 1:13', '90026477');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3725, 'KLINTE PRÄSTGÅRDEN 1:10', '90026474');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3730, 'KLINTE PRÄSTGÅRDEN 1:7', '90026471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3729, 'KLINTE PRÄSTGÅRDEN 1:6', '90026470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3728, 'KLINTE PRÄSTGÅRDEN 1:3', '90026467');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3905, 'DALHEM VIDUNGE 1:10', '90007412');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3894, 'DALHEM SIGGUR 1:46', '90007347');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3885, 'DALHEM RÄKARVE 1:23', '90007298');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3871, 'DALHEM NYGÅRDS 1:2', '90007208');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3786, 'DALHEM HALLVIDE 1:52', '90007141');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4005, 'FRÖJEL STORA SOLBJÄRGE 5:2', '878');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3637, 'DALHEM BUSARVE 1:20', '771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3626, 'DALHEM BINGE 1:3', '770');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3604, 'DALHEM ANDERBÅTELS 1:19', '769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3909, 'DALHEM VIDUNGE 1:20', '745');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3933, 'BJÖRKE TYNNE 1:4', '673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3584, 'GANTHEM TULE 1:27', '641');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3568, 'GANTHEM KUMBLE 2:6', '640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3562, 'GANTHEM HARTVIKS 1:31', '639');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3598, 'FRÖJEL ALSTÄDE 1:39', '618');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3719, 'KLINTE MÖLNER 1:18', '605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4054, 'BJÖRKE TYNNE 1:12', '524');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3570, 'GANTHEM KUMBLE 4:2', '438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3558, 'GANTHEM GODRINGS 1:22', '437');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3546, 'GANTHEM GARDESE 1:11', '436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3976, 'FRÖJEL NYMANS 1:7', '423');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3599, 'FRÖJEL ALSTÄDE 1:40', '422');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3545, 'GANTHEM EKEBYS 2:1', '391');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3749, 'KLINTE SVARVARE 1:21', '3575');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3723, 'KLINTE MÖLNER 1:5', '3570');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3956, 'FRÖJEL LILLA HAJDES 2:2', '3488');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3910, 'DALHEM VIDUNGE 1:23', '3455');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3901, 'DALHEM SLITEGÅRDS 1:19', '3453');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3887, 'DALHEM RÄKARVE 3:1', '3452');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3884, 'DALHEM RÄKARVE 1:18', '3451');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3863, 'DALHEM KAUNGS 1:18', '3450');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3632, 'DALHEM BUSARVE 1:16', '3448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3907, 'DALHEM VIDUNGE 1:17', '340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3763, 'DALHEM HALLFOSE 1:5', '338');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3759, 'DALHEM HALLFOSE 1:3', '301');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3634, 'DALHEM BUSARVE 1:18', '296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3711, 'FRÖJEL DÄPPS 2:1', '280');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3677, 'FRÖJEL ANSARVE 1:63', '278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3807, 'ROMA TIMANS 2:1', '2626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3806, 'ROMA TIMANS 1:20', '2336');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3663, 'ROMA SNAUVALDS 1:14', '2335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3963, 'FRÖJEL MULDE 1:16', '224');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3955, 'FRÖJEL LILLA HAJDES 1:4', '223');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3262, 'VÄSKINDE KNUTS 1:7', '2222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4056, 'FRÖJEL KAUPE 1:3', '222');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3873, 'DALHEM NYGÅRDS 1:9', '212');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3656, 'ROMA LILLA VÄLLER 1:12', '2115');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3790, 'DALHEM HARSTÄDE 1:1', '209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3722, 'KLINTE MÖLNER 1:21', '1974');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3896, 'DALHEM SIGGUR 1:49', '158');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3872, 'DALHEM NYGÅRDS 1:8', '157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3661, 'ROMA SNAUVALDS 1:13', '1143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3650, 'ROMA KLOSTER 1:142', '1134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3548, 'GANTHEM GARDESE 1:20', '1095');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3970, 'FRÖJEL MULDE 1:36', '1088');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3881, 'DALHEM PRÄSTGÅRDEN 1:12', '1062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3864, 'DALHEM KAUNGS 1:3', '1061');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3794, 'DALHEM HÄSSELBY 1:5', '1060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3768, 'DALHEM HALLVIDE 1:11', '1057');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3685, 'DALHEM GRINDER 1:4', '1056');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3931, 'BJÖRKE TYNNE 1:16', '090071889');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3811, 'BJÖRKE BJÖRKSARVE 1:21', '090071808');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3903, 'DALHEM SLITEGÅRDS 2:2', '090071593');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3704, 'FRÖJEL BOTTARVE 1:55', '090071542');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3703, 'FRÖJEL BOTTARVE 1:54', '090071541');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3615, 'HALLA BROE 1:86', '090071531');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3928, 'BJÖRKE SMIDGÅRDE 1:21', '090071171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3918, 'BJÖRKE HARKVIE 1:4', '090071170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4014, 'FRÖJEL SÄLLE 1:30', '090070823');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3753, 'KLINTE SVARVARE 1:24', '090069514');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3925, 'BJÖRKE NORRGÅRDE 1:82', '090069316');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3538, 'GANTHEM BÅTELS 1:21', '090068942');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3624, 'HALLA DALBO 2:2', '090068020');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3771, 'FRÖJEL GÖSTAVS 3:5', '090067503');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3784, 'KLINTE VALLE 1:229', '090067278');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3783, 'FRÖJEL GÖSTAVS 5:4', '090067193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3780, 'FRÖJEL GÖSTAVS 5:3', '090067192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3777, 'FRÖJEL GÖSTAVS 5:2', '090067191');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3751, 'KLINTE SVARVARE 1:23', '090066905');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4059, 'GANTHEM HARTVIKS 1:47', '090066834');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3565, 'GANTHEM HARTVIKS 1:45', '090066832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3587, 'GANTHEMS ANNEX 1:3', '090066811');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3737, 'KLINTE ROBBJÄNS 1:76', '090066069');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3659, 'ROMA LILLA VÄLLER 1:15', '090065759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3973, 'FRÖJEL MULDE 1:47', '090065283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3564, 'GANTHEM HARTVIKS 1:44', '090064706');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3800, 'ROMA SNAUVALDS 1:20', '090064501');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3810, 'BJÖRKE BJÖRKSARVE 1:20', '090063894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3551, 'GANTHEM GARDESE 1:30', '090063387');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3736, 'KLINTE ROBBJÄNS 1:75', '090063299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3898, 'DALHEM SIGGUR 1:52', '090063049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3826, 'HALLA HALLEGÅRDE 1:49', '090062832');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3640, 'DALHEM DUNE 2:3', '090062711');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3989, 'FRÖJEL ROVIDE 1:32', '090062398');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3988, 'FRÖJEL ROVIDE 1:31', '090062397');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3987, 'FRÖJEL ROVIDE 1:30', '090062396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3583, 'GANTHEM TOMASE 1:26', '090062147');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3638, 'DALHEM DUNE 2:2', '090061877');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3569, 'GANTHEM KUMBLE 2:7', '090061852');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3782, 'KLINTE VALLE 1:224', '090061704');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3702, 'FRÖJEL BOTTARVE 1:51', '090061569');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4013, 'FRÖJEL SÄLLE 1:26', '090061530');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4012, 'FRÖJEL SÄLLE 1:25', '090061529');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4011, 'FRÖJEL SÄLLE 1:24', '090061528');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3803, 'ROMA STORA VÄLLER 2:1', '090038245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3801, 'ROMA STORA VÄLLER 1:31', '090038239');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3799, 'ROMA SNAUVALDS 1:19', '090038209');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3660, 'ROMA SNAUVALDS 1:11', '090038201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3658, 'ROMA LILLA VÄLLER 1:14', '090038144');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3657, 'ROMA LILLA VÄLLER 1:13', '090038143');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3654, 'ROMA LARSARVE 1:45', '090038111');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3653, 'ROMA KLOSTER 1:186', '090038019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3651, 'ROMA KLOSTER 1:170', '090038003');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3649, 'ROMA KLOSTER 1:134', '090037967');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3647, 'ROMA KLOSTER 1:128', '090037961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3646, 'ROMA KARBY 1:29', '090037830');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3645, 'ROMA DISKARVE 1:13', '090037784');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3644, 'ROMA BUSARVE 1:32', '090037751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3639, 'ROMA BOTTÄNGEN 10:3', '090037720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3643, 'ROMA BOTTÄNGEN 9:2', '090037717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3642, 'ROMA BOTTÄNGEN 9:1', '090037716');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3641, 'ROMA BOTTÄNGEN 6:1', '090037713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3554, 'ROMA BJÄRS 1:31', '090037709');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3547, 'ROMA BJÄRS 1:17', '090037696');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3544, 'ROMA AJMUNDS 1:17', '090037629');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3787, 'KLINTE VÄRSÄNDE 1:12', '090027296');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3785, 'KLINTE VALLE 1:53', '090027084');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3779, 'KLINTE TYRVALDS 1:55', '090027026');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3776, 'KLINTE TYRVALDS 1:54', '090027025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3774, 'KLINTE TYRVALDS 1:51', '090027022');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3770, 'KLINTE TYRVALDS 1:50', '090027021');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3769, 'KLINTE TYRVALDS 1:48', '090027019');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3766, 'KLINTE TYRVALDS 1:46', '090027017');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3764, 'KLINTE TYRVALDS 1:38', '090027009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3761, 'KLINTE TYRVALDS 1:35', '090027006');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3760, 'KLINTE TYRVALDS 1:28', '090026999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3758, 'KLINTE SVARVARE 2:1', '090026972');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3748, 'KLINTE SVARVARE 1:15', '090026964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3745, 'KLINTE SVARVARE 1:11', '090026960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3743, 'KLINTE SVARVARE 1:10', '090026959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3756, 'KLINTE SVARVARE 1:8', '090026957');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3755, 'KLINTE SVARVARE 1:3', '090026952');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3741, 'KLINTE STORA SNÖGRINDE 1:7', '090026760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3740, 'KLINTE SICKLINGS 1:99', '090026695');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3739, 'KLINTE SICKLINGS 1:64', '090026660');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3738, 'KLINTE SICKLINGS 1:4', '090026600');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3735, 'KLINTE ROBBJÄNS 1:52', '090026564');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3732, 'KLINTE RANNARVE 1:34', '090026512');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3731, 'KLINTE RANNARVE 1:14', '090026492');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3726, 'KLINTE PRÄSTGÅRDEN 1:11', '090026475');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3724, 'KLINTE ODVALDS 1:18', '090026446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3717, 'KLINTE LOGGARVE 1:48', '090026392');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3714, 'KLINTE LOGGARVE 1:35', '090026379');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3712, 'KLINTE LOGGARVE 1:34', '090026378');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3710, 'KLINTE LILLA SNÖGRINDE 1:50', '090026339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3709, 'KLINTE LILLA SNÖGRINDE 1:46', '090026335');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3708, 'KLINTE LILLA SNÖGRINDE 1:45', '090026334');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3707, 'KLINTE LILLA SNÖGRINDE 1:44', '090026333');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3705, 'KLINTE LILLA SNÖGRINDE 1:39', '090026328');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3701, 'KLINTE LILLA SNÖGRINDE 1:38', '090026327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4061, 'KLINTE KLINTEBYS 1:4', '090026275');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3698, 'KLINTE KLINTEBYS 1:3', '090026274');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3696, 'KLINTE KLINTEBYS 1:2', '090026273');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3690, 'KLINTE HUNNINGE 1:14', '090026203');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3687, 'KLINTE HUNNINGE 1:12', '090026201');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3694, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3695, 'KLINTE HUNNINGE 1:8', '090026197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3859, 'HALLA UNSARVE 1:22', '090019806');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3858, 'HALLA UNSARVE 1:21', '090019805');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3857, 'HALLA UNSARVE 1:20', '090019804');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3856, 'HALLA UNSARVE 1:19', '090019803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3855, 'HALLA UNSARVE 1:17', '090019801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3854, 'HALLA UNSARVE 1:16', '090019800');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3853, 'HALLA UNSARVE 1:15', '090019799');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3861, 'HALLA UNSARVE 1:8', '090019792');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3860, 'HALLA UNSARVE 1:6', '090019790');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3849, 'HALLA TULE 1:11', '090019780');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3852, 'HALLA TULE 1:9', '090019778');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3851, 'HALLA TULE 1:8', '090019777');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3850, 'HALLA TULE 1:2', '090019771');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3847, 'HALLA TOMTE 1:27', '090019769');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3846, 'HALLA TOMTE 1:23', '090019765');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3845, 'HALLA TOMTE 1:16', '090019758');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3844, 'HALLA TOMTE 1:14', '090019756');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3843, 'HALLA TOMTE 1:13', '090019755');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3848, 'HALLA TOMTE 1:9', '090019751');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3842, 'HALLA RANTARVE 1:18', '090019740');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3841, 'HALLA RANTARVE 1:17', '090019739');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3840, 'HALLA RANTARVE 1:16', '090019738');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3839, 'HALLA RANTARVE 1:15', '090019737');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3838, 'HALLA RANTARVE 1:14', '090019736');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3837, 'HALLA RANTARVE 1:13', '090019735');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3836, 'HALLA RANTARVE 1:12', '090019734');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3835, 'HALLA NYGRANNE 1:16', '090019722');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3834, 'HALLA NYGRANNE 1:15', '090019721');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3833, 'HALLA NYGRANNE 1:14', '090019720');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3832, 'HALLA NYGRANNE 1:13', '090019719');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3831, 'HALLA NYGRANNE 1:11', '090019717');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3830, 'HALLA MÖLLEBOS 1:16', '090019698');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3829, 'HALLA KYRKOGÅRDEN 1:1', '090019682');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3828, 'HALLA KAMBS 1:3', '090019679');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3825, 'HALLA HALLEGÅRDE 1:48', '090019676');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3824, 'HALLA HALLEGÅRDE 1:47', '090019675');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3823, 'HALLA HALLEGÅRDE 1:46', '090019674');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3822, 'HALLA HALLEGÅRDE 1:45', '090019673');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3821, 'HALLA HALLEGÅRDE 1:44', '090019672');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3820, 'HALLA HALLEGÅRDE 1:42', '090019670');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3819, 'HALLA HALLEGÅRDE 1:40', '090019668');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3818, 'HALLA HALLEGÅRDE 1:39', '090019667');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3817, 'HALLA HALLEGÅRDE 1:36', '090019664');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3816, 'HALLA HALLEGÅRDE 1:33', '090019661');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3539, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3668, 'HALLA HALLEGÅRDE 1:30', '090019658');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3815, 'HALLA HALLEGÅRDE 1:28', '090019656');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3629, 'HALLA HALLEGÅRDE 1:22', '090019650');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3627, 'HALLA HALLEGÅRDE 1:12', '090019640');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3625, 'HALLA HALLEGÅRDE 1:10', '090019638');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3827, 'HALLA HALLEGÅRDE 1:5', '090019633');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3623, 'HALLA DALBO 2:1', '090019628');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3619, 'HALLA DALBO 1:4', '090019626');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3613, 'HALLA BROE 1:85', '090019621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3611, 'HALLA BROE 1:80', '090019616');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3609, 'HALLA BROE 1:78', '090019614');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3608, 'HALLA BROE 1:74', '090019610');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3605, 'HALLA BROE 1:72', '090019608');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3603, 'HALLA BROE 1:70', '090019606');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3601, 'HALLA BROE 1:69', '090019605');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3597, 'HALLA BROE 1:66', '090019602');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3594, 'HALLA BROE 1:65', '090019601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3591, 'HALLA BROE 1:59', '090019595');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3590, 'HALLA BROE 1:50', '090019586');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3589, 'HALLA BROE 1:45', '090019581');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3588, 'HALLA BROE 1:37', '090019573');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3602, 'HALLA BROE 1:7', '090019543');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3576, 'HALLA ANNEX 1:2', '090019535');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3586, 'GANTHEM TULE 1:35', '090016108');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3585, 'GANTHEM TULE 1:31', '090016104');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3582, 'GANTHEM TOMASE 1:25', '090016075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3862, 'HALLA VIBY 1:1', '090016060');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3581, 'GANTHEM SMISS 1:28', '090016050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3580, 'GANTHEM SMISS 1:27', '090016049');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3579, 'GANTHEM SMISS 1:23', '090016046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3578, 'GANTHEM SMISS 1:21', '090016044');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3577, 'GANTHEM SMISS 1:14', '090016037');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3575, 'GANTHEM SMIDGÅRDE 1:5', '090016023');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3574, 'GANTHEM NORRBYS 1:18', '090016011');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4060, 'GANTHEM NORRBYS 1:16', '090016009');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3572, 'GANTHEM NORRBYS 1:11', '090016004');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3567, 'GANTHEM KUMBLE 2:5', '090015978');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3566, 'GANTHEM HARTVIKS 2:1', '090015960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3563, 'GANTHEM HARTVIKS 1:40', '090015959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3560, 'GANTHEM GODRINGS 3:1', '090015911');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3559, 'GANTHEM GODRINGS 1:25', '090015909');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3557, 'GANTHEM GODRINGS 1:20', '090015904');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3556, 'GANTHEM GODRINGS 1:19', '090015903');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3555, 'GANTHEM GODRINGS 1:15', '090015899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3553, 'GANTHEM GARDESE 4:1', '090015883');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3552, 'GANTHEM GARDESE 3:1', '090015882');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3550, 'GANTHEM GARDESE 1:29', '090015880');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3549, 'GANTHEM GARDESE 1:28', '090015879');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3543, 'GANTHEM EKEBYS 1:34', '090015850');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3541, 'GANTHEM EKEBYS 1:33', '090015849');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3540, 'GANTHEM EKEBYS 1:31', '090015847');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4058, 'GANTHEM BÅTELS 5:1', '090015814');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3537, 'GANTHEM BÅTELS 1:15', '090015803');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3536, 'GANTHEM BÅTELS 1:14', '090015802');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3534, 'GANTHEM BÅTELS 1:13', '090015801');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4016, 'FRÖJELS ANNEX 1:3', '090013479');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4015, 'FRÖJELS ANNEX 1:2', '090013478');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4010, 'FRÖJEL SÄLLE 1:22', '090013472');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4009, 'FRÖJEL SÄLLE 1:21', '090013471');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4008, 'FRÖJEL SÄLLE 1:20', '090013470');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4007, 'FRÖJEL SÄLLE 1:16', '090013466');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4057, 'FRÖJEL SÄLLE 1:13', '090013463');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3986, 'FRÖJEL ROVIDE 1:29', '090013461');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4003, 'FRÖJEL STORA SOLBJÄRGE 4:1', '090013448');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4002, 'FRÖJEL STORA SOLBJÄRGE 2:1', '090013446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4001, 'FRÖJEL STORA SOLBJÄRGE 1:20', '090013427');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3999, 'FRÖJEL STORA HAJDES 3:1', '090013407');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3996, 'FRÖJEL STENSTUGU 1:18', '090013396');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3995, 'FRÖJEL STENSTUGU 1:17', '090013395');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3994, 'FRÖJEL STENSTUGU 1:15', '090013393');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3998, 'FRÖJEL STENSTUGU 1:8', '090013386');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3997, 'FRÖJEL STENSTUGU 1:3', '090013381');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3991, 'FRÖJEL SIGDARVE 1:10', '090013367');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3993, 'FRÖJEL SIGDARVE 1:8', '090013365');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3992, 'FRÖJEL SIGDARVE 1:7', '090013364');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3985, 'FRÖJEL ROVIDE 1:28', '090013357');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3984, 'FRÖJEL ROVIDE 1:23', '090013352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3983, 'FRÖJEL ROVIDE 1:12', '090013341');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3982, 'FRÖJEL ROVIDE 1:11', '090013340');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3990, 'FRÖJEL ROVIDE 1:8', '090013337');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3981, 'FRÖJEL ROBSARVE 1:6', '090013327');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3980, 'FRÖJEL ROBSARVE 1:4', '090013325');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3979, 'FRÖJEL PUSER 1:31', '090013318');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3975, 'FRÖJEL NYMANS 1:11', '090013285');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3978, 'FRÖJEL NYMANS 1:9', '090013283');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3977, 'FRÖJEL NYMANS 1:8', '090013282');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3972, 'FRÖJEL MULDE 1:40', '090013270');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3971, 'FRÖJEL MULDE 1:39', '090013269');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3969, 'FRÖJEL MULDE 1:33', '090013263');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3968, 'FRÖJEL MULDE 1:32', '090013262');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3967, 'FRÖJEL MULDE 1:31', '090013261');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3966, 'FRÖJEL MULDE 1:30', '090013260');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3965, 'FRÖJEL MULDE 1:29', '090013259');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3964, 'FRÖJEL MULDE 1:25', '090013255');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3962, 'FRÖJEL MULDE 1:15', '090013249');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3961, 'FRÖJEL MULDE 1:12', '090013246');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3960, 'FRÖJEL MULDE 1:11', '090013245');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3959, 'FRÖJEL LILLA SOLBJÄRGE 2:1', '090013235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3958, 'FRÖJEL LILLA SOLBJÄRGE 1:15', '090013234');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3957, 'FRÖJEL LILLA SOLBJÄRGE 1:14', '090013233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3954, 'FRÖJEL KYRKOGÅRDEN 1:1', '090013202');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3953, 'FRÖJEL KAUPE 2:1', '090013198');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3952, 'FRÖJEL KAUPE 1:14', '090013197');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3951, 'FRÖJEL HÄGUR 1:7', '090013183');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3950, 'FRÖJEL HÄGUR 1:4', '090013180');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3949, 'FRÖJEL HÄGUR 1:3', '090013179');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3947, 'FRÖJEL HALLGÅRDS 1:22', '090013172');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3946, 'FRÖJEL HALLGÅRDS 1:21', '090013171');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3945, 'FRÖJEL HALLGÅRDS 1:20', '090013170');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3943, 'FRÖJEL HALLGÅRDS 1:19', '090013169');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3942, 'FRÖJEL HALLGÅRDS 1:18', '090013168');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3939, 'FRÖJEL HALLGÅRDS 1:16', '090013166');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3938, 'FRÖJEL HALLGÅRDS 1:15', '090013165');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3934, 'FRÖJEL HALLGÅRDS 1:14', '090013164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3932, 'FRÖJEL HALLGÅRDS 1:12', '090013162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3948, 'FRÖJEL HALLGÅRDS 1:9', '090013159');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3944, 'FRÖJEL HALLGÅRDS 1:2', '090013152');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3773, 'FRÖJEL GÖSTAVS 5:1', '090013150');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3767, 'FRÖJEL GÖSTAVS 1:49', '090013145');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3762, 'FRÖJEL GÖSTAVS 1:42', '090013138');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3757, 'FRÖJEL GÖSTAVS 1:38', '090013134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3754, 'FRÖJEL GÖSTAVS 1:36', '090013132');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3752, 'FRÖJEL GÖSTAVS 1:35', '090013131');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3750, 'FRÖJEL GÖSTAVS 1:29', '090013125');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3744, 'FRÖJEL GÖSTAVS 1:10', '090013106');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3742, 'FRÖJEL GANNARVE 1:9', '090013094');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3720, 'FRÖJEL GANNARVE 1:8', '090013093');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3716, 'FRÖJEL GANNARVE 1:7', '090013092');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3715, 'FRÖJEL GANNARVE 1:6', '090013091');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3713, 'FRÖJEL GANNARVE 1:4', '090013089');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3700, 'FRÖJEL BOTTARVE 1:50', '090013077');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3697, 'FRÖJEL BOTTARVE 1:48', '090013075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3693, 'FRÖJEL BOTTARVE 1:47', '090013074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3691, 'FRÖJEL BOTTARVE 1:44', '090013071');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3689, 'FRÖJEL BOTTARVE 1:43', '090013070');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3688, 'FRÖJEL BOTTARVE 1:35', '090013062');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3682, 'FRÖJEL BOTTARVE 1:21', '090013048');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3681, 'FRÖJEL BOTTARVE 1:19', '090013046');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3679, 'FRÖJEL BOTTARVE 1:11', '090013038');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3699, 'FRÖJEL BOTTARVE 1:5', '090013032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3678, 'FRÖJEL BOFRIDE 2:2', '090012999');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3675, 'FRÖJEL ANSARVE 1:61', '090012963');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3674, 'FRÖJEL ANSARVE 1:59', '090012961');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3673, 'FRÖJEL ANSARVE 1:58', '090012960');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3672, 'FRÖJEL ANSARVE 1:57', '090012959');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3671, 'FRÖJEL ANSARVE 1:56', '090012958');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3669, 'FRÖJEL ANSARVE 1:46', '090012948');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3617, 'FRÖJEL ANSARVE 1:42', '090012944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3616, 'FRÖJEL ANSARVE 1:38', '090012940');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3614, 'FRÖJEL ANSARVE 1:16', '090012919');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3612, 'FRÖJEL ANSARVE 1:12', '090012915');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3610, 'FRÖJEL ALSTÄDE 1:41', '090012899');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3596, 'FRÖJEL ALSTÄDE 1:38', '090012896');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3595, 'FRÖJEL ALSTÄDE 1:36', '090012894');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3593, 'FRÖJEL ALSTÄDE 1:35', '090012893');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3592, 'FRÖJEL ALSTÄDE 1:15', '090012873');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3914, 'DALHEM VIDUNGE-STENSTUGU 1:22', '090007446');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3913, 'DALHEM VIDUNGE-STENSTUGU 1:13', '090007438');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3912, 'DALHEM VIDUNGE-STENSTUGU 1:11', '090007436');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3908, 'DALHEM VIDUNGE 1:19', '090007420');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3906, 'DALHEM VIDUNGE 1:15', '090007416');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3904, 'DALHEM SUDERBYS 1:7', '090007385');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3900, 'DALHEM SLITEGÅRDS 1:18', '090007374');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3899, 'DALHEM SLITEGÅRDS 1:13', '090007370');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3902, 'DALHEM SLITEGÅRDS 1:6', '090007363');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3897, 'DALHEM SIGGUR 1:51', '090007352');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3895, 'DALHEM SIGGUR 1:48', '090007349');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3893, 'DALHEM SIGGUR 1:38', '090007339');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3892, 'DALHEM SIGGUR 1:30', '090007332');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3891, 'DALHEM SIGGUR 1:21', '090007323');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3890, 'DALHEM SIGGUR 1:20', '090007322');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3889, 'DALHEM SIGGUR 1:18', '090007320');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3888, 'DALHEM SIGGUR 1:13', '090007315');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3886, 'DALHEM RÄKARVE 1:24', '090007299');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3883, 'DALHEM PRÄSTGÅRDEN 1:7', '090007265');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3882, 'DALHEM PRÄSTGÅRDEN 1:6', '090007264');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3880, 'DALHEM NÄSUNGS 3:1', '090007244');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3879, 'DALHEM NÄSUNGS 1:23', '090007242');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3878, 'DALHEM NÄSUNGS 1:22', '090007241');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3877, 'DALHEM NÄSUNGS 1:18', '090007238');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3876, 'DALHEM NÄSUNGS 1:15', '090007235');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3875, 'DALHEM NÄSUNGS 1:13', '090007233');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3874, 'DALHEM NÄSUNGS 1:12', '090007232');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3869, 'DALHEM MYRE 1:10', '090007205');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3870, 'DALHEM MYRE 1:9', '090007204');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3868, 'DALHEM MUNKEBOS 1:4', '090007195');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3867, 'DALHEM MUNKEBOS 1:1', '090007193');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3866, 'DALHEM MALMS 1:3', '090007192');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3797, 'DALHEM KAUNGS 1:16', '090007185');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3865, 'DALHEM KAUNGS 1:6', '090007176');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3792, 'DALHEM HÄSSELBY 1:11', '090007167');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3796, 'DALHEM HÄSSELBY 1:8', '090007164');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3795, 'DALHEM HÄSSELBY 1:6', '090007162');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3791, 'DALHEM HARSTÄDE 1:3', '090007157');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3789, 'DALHEM HALLVIDE 6:1', '090007154');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3788, 'DALHEM HALLVIDE 4:5', '090007151');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3778, 'DALHEM HALLVIDE 1:47', '090007136');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4055, 'DALHEM HALLVIDE 1:45', '090007134');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3772, 'DALHEM HALLVIDE 1:44', '090007133');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3686, 'DALHEM HALLFOSE 1:2', '090007086');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3684, 'DALHEM GRINDER 1:2', '090007082');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3683, 'DALHEM GRANSKOGS 1:8', '090007075');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3680, 'DALHEM GRANSKOGS 1:7', '090007074');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3676, 'DALHEM GANDARVE 1:17', '090007050');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3665, 'DALHEM GANDARVE 1:14', '090007047');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3664, 'DALHEM DUNGÅRDE 1:24', '090007032');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3662, 'DALHEM DUNGÅRDE 1:17', '090007025');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3621, 'DALHEM DUNGÅRDE 1:16', '090007024');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3636, 'DALHEM BUSARVE 1:19', '090006983');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3633, 'DALHEM BUSARVE 1:17', '090006981');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3631, 'DALHEM BUSARVE 1:15', '090006979');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3630, 'DALHEM BURGE 1:6', '090006964');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3622, 'DALHEM BINGE 1:14', '090006951');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3628, 'DALHEM BINGE 1:6', '090006944');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3606, 'DALHEM ANDERBÅTELS 1:20', '090006937');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3600, 'DALHEM ANDERBÅTELS 1:18', '090006935');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3571, 'DALHEM ANDERBÅTELS 1:17', '090006934');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3618, 'DALHEM ANDERBÅTELS 1:6', '090006924');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3941, 'BJÖRKE VARPLÖSE 1:20', '090003795');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3940, 'BJÖRKE VARPLÖSE 1:19', '090003794');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3937, 'BJÖRKE VARPLÖSE 1:18', '090003793');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3936, 'BJÖRKE TYNNE 1:8', '090003768');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3935, 'BJÖRKE TYNNE 1:6', '090003766');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3930, 'BJÖRKE STENSTUGU 1:17', '090003760');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3929, 'BJÖRKE STENSTUGU 1:16', '090003759');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3927, 'BJÖRKE SMIDGÅRDE 1:18', '090003742');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (4053, 'BJÖRKE ODVALDS 1:11', '090003713');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3924, 'BJÖRKE NORRGÅRDE 1:78', '090003700');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3923, 'BJÖRKE NORRGÅRDE 1:13', '090003635');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3922, 'BJÖRKE LIKMIDE 1:18', '090003621');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3921, 'BJÖRKE LIKMIDE 1:17', '090003620');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3920, 'BJÖRKE LIKMIDE 1:10', '090003615');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3919, 'BJÖRKE KYRKOGÅRDEN 2:1', '090003607');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3917, 'BJÖRKE HAKUSE 2:2', '090003603');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3916, 'BJÖRKE HAKUSE 1:41', '090003601');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3814, 'BJÖRKE HAKUSE 1:39', '090003599');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3813, 'BJÖRKE HAKUSE 1:17', '090003577');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3535, 'BJÖRKE HAKUSE 1:16', '090003576');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3808, 'BJÖRKE BJÖRKSARVE 1:19', '090003556');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3805, 'BJÖRKE BJÖRKSARVE 1:17', '090003554');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3804, 'BJÖRKE BJÖRKSARVE 1:15', '090003552');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3802, 'BJÖRKE BJÖRKSARVE 1:14', '090003551');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3812, 'BJÖRKE BJÖRKSARVE 1:8', '090003545');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3809, 'BJÖRKE BJÖRKSARVE 1:2', '090003539');
INSERT INTO #tempTable (INTDIARIENUMMERLOEPNUMMER, STRFASTIGHETSBETECKNING, STRFNRID) VALUES (3533, 'BJÖRKE ANNEX 1:4', '090003504');



select x.INTDIARIENUMMERLOEPNUMMER,q.* from (select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

WHERE left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma'

    ) q INNER JOIN #tempTable x on FASTIGHET = x.STRFASTIGHETSBETECKNING
;-- -. . -..- - / . -. - .-. -.--
select 'mbnv 2020/' & x.INTDIARIENUMMERLOEPNUMMER
from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P q inner join #tempTable x on FASTIGHET = x.STRFASTIGHETSBETECKNING
WHERE
    (left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma')
;-- -. . -..- - / . -. - .-. -.--
select concat('mbnv 2020/', x.INTDIARIENUMMERLOEPNUMMER)
from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P q inner join #tempTable x on FASTIGHET = x.STRFASTIGHETSBETECKNING
WHERE
    (left(fastighet, len('Björke')) = 'Björke' OR
left(fastighet, len('Dalhem')) = 'Dalhem' OR
left(fastighet, len('Fröjel')) = 'Fröjel' OR
left(fastighet, len('Ganthem')) = 'Ganthem' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Halla')) = 'Halla' OR
left(fastighet, len('Roma')) = 'Roma')
;-- -. . -..- - / . -. - .-. -.--
select * from flaggskiktet_P_evw order by beslutsdatum desc
;-- -. . -..- - / . -. - .-. -.--
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw order by beslutsdatum desc
;-- -. . -..- - / . -. - .-. -.--
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw order by Beslut_datum desc
;-- -. . -..- - / . -. - .-. -.--
select * from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw where Status = 'lila'
;-- -. . -..- - / . -. - .-. -.--
select status,count() antal from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw group by status
;-- -. . -..- - / . -. - .-. -.--
select status,count(*) antal from sde_miljo_halsoskydd.gng.Flaggskiktet_p_evw group by status
;-- -. . -..- - / . -. - .-. -.--
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where FASTIGHET like 'ardre mullvalds 1:10'
	or
      Fastighet_tillstand like 'ardre mullvalds 1:10'
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
@searchstring = 'ardre mullvalds 1:10'

select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where FASTIGHET like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
string @searchstring;
@searchstring = 'ardre mullvalds 1:10'

select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where FASTIGHET like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
@searchstring = 'ardre mullvalds 1:10'

select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where FASTIGHET like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where FASTIGHET like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
with
q (select FASTIGHET,Fastighet_tillstand x,* from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

    select * from q
where x like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
with
	q (select FASTIGHET,Fastighet_tillstand x from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)
	    
    select * from q
where x like @searchString
	or
      Fastighet_tillstand like @searchstring
	or
      Arendenummer = 'mhn 2012/1102'
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
select FASTIGHET,Fastighet_tillstand x from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where concat(Fastighet_tillstand,FASTIGHET) like concat(@searchSocken,'%')
	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchFastighetsNr,'%')
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where concat(Fastighet_tillstand,FASTIGHET) like concat(@searchSocken,'%')
	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchFastighetsNr,'%')
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where concat(Fastighet_tillstand,FASTIGHET) like concat(@searchSocken,'%')
	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchFastighetsNr,'%')
;

select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select * from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select * from sde_miljo_halsoskydd.gng.RENING_SODRA_P

where concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like concat(@searchSocken,'%')
	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
;
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where concat(Fastighet_tillstand,FASTIGHET) like concat(@searchSocken,'%')
	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchFastighetsNr,'%')
;

select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P

where concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like concat(@searchSocken,'%')
	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P

where concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like concat(@searchSocken,'%')
	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'
WITH QX  as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

select *,concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) q from qx

where Q
          like concat(@searchSocken,'%')
	and
      q
          like  concat('%',@searchSocken,'%')
      	and
      q
          like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;
WITH QX  as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

select *,concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) q from qx

where Q
          like concat(@searchSocken,'%')
	and
      q
          like  concat('%',@searchSocken,'%')
      	and
      q
          like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;
WITH QX  as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,qy as (select *,concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) q from qx)
select * from qy
where Q
          like concat(@searchSocken,'%')
	and
      q
          like  concat('%',@searchSocken,'%')
      	and
      q
          like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;
WITH QX  as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,qy as (select *,concat(Fastighet_rening,Anslutna_fastigheter_1,Anslutna_fastigheter_2,Anslutna_fastigheter_3,Anslutna_fastigheter_4,Anslutna_fastigheter_5,Anslutna_fastigheter_6,Anslutna_fastigheter_7,Anslutna_fastigheter_8,Anslutna_fastigheter_9,Anslutna_fastigheter_10) q from qx)
select * from qy
where Q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%')
;

;
select * from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P

where concat(Fastighet_tillstand,FASTIGHET) like concat(@searchSocken,'%')
	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchSocken,'%')
      	and
      concat(Fastighet_tillstand,FASTIGHET) like  concat('%',@searchFastighetsNr,'%')
;

select @searchFastighetsNr
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;
WITH reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
select * from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%')
;

;
with flaggSearchTerm as (
select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

select * from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)

select * from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'


with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)

select * from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;

;
WITH reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
select * from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%')
;

;
with flaggSearchTerm as (
select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

select * from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)

select * from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;

;
WITH reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
select * from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%')
;

;
with flaggSearchTerm as (
select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

select * from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)

select * from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%')
;
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, Arendenummer, Status, 	Slamhamtning  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q, Utskick_datum, null
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, Diarienummer, Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   Storlek_m2,  reningstyp, 		Beslut_datum, 		Utford_datum, Antal_hushall_rening	,Kommentarer, 	q, null
from rening
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, Arendenummer, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, Diarienummer, null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, Antal_hushall_rening	,Kommentarer, 	q, null
from rening
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, Arendenummer, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, Diarienummer, null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, Arendenummer, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, Arendenummer, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, Diarienummer, null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,"") dianr, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,"") , null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, Antal_hushall_rening	,Kommentarer, 	q, null
from rening
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, Status,	Utskick_datum,	null storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  Antal_byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, Antal_hushall_tillstand	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, Antal_hushall_rening	,Kommentarer, 	q, null
from rening
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
from rening
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))

select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
from flagg union
select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
from enskilt union
select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
from rening
order by FASTIGHET,Fastighet_tillstand,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )
select coalesce(Fastighet_tillstand,FASTIGHET) f, * from allR
order by f ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )
select k from allR
order by f ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )
select q from allR
order by f ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )
select q from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )

select iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concatenate(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as i
 from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )

select iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as i
 from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, concat(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, concat(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,  dianr, Status, Utskick_datum, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,  dianr, Status, Utskick_datum, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, FASTIGHET, 		Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,	Utskick_datum,	0 storlek,	Slamhamtning,  		Beslut_datum, 		Utforddatum,  concat(Antal_byggnader,'') byggnader		,Anteckning, 	q,  null other
	    from flagg union
    select 'enskilt' typ,	OBJECTID, Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		null,	null,		Storlek_m3,	Typ_slamavskiljare, 	Beslut_datum, 		Utford_datum, concat(Antal_hushall_tillstand,'')	,Anteckning, 	q, concat(Typ_byggnad,Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Avgift, Tillstand_giltigt_tom) s
	    from enskilt union
    select 'rening' typ,	OBJECTID, Fastighet_rening, 	null,		     null, 	   			null,	null, 		Storlek_m2,  	reningstyp, 		Beslut_datum, 		Utford_datum, concat(Antal_hushall_rening,'')	,Kommentarer, 	q, null
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,		Slamhamtning,  		Beslut_datum, 					Utforddatum,  concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening) 	Beslut_datum, 	Utford_datum, concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift) s
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  	reningstyp, 		Beslut_datum, 					Utford_datum, concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening) 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift),
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, Anteckning, q, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift),
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, storlek, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift),
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, Utskick_datum) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift),
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'') dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, concat(nullif(Arendenummer,''),'')  dianr, 	Status,							Utskick_datum utskGiltigtTom,	0 m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,	Tillstand_giltigt_tom,							concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 				Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,	'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(Storlek_m3,Storlek_m,Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(Storlek_m3,':',Storlek_m,':',Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		Storlek_m2,  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(Storlek_m3,':',Storlek_m,':',Storlek_m2)   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(round(Storlek_m3),':',round(Storlek_m),':',round(Storlek_m2))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'ardre mullvalds 1:10'

declare @searchSocken nvarchar(50);
set @searchSocken = 'ardre'

declare @searchFastighet nvarchar(50);
set @searchFastighet = 'mullvalds'

declare @searchFastighetsNr nvarchar(50);
set @searchFastighetsNr = '1:10'

;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,    unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@searchSocken,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%') and q like  concat('%',@searchSocken,'%') and q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':',round(Storlek_m,1),':',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
with fastighetsfilter as (Select 'björke' "socken"
                          Union
                          Select 'dalhem' "a"
                          Union
                          Select 'fröjel' "a"
                          Union
                          Select 'ganthem' "a"
                          Union
                          Select 'Halla' "a"
                          Union
                          Select 'Klinte' "a"
                          Union
                          Select 'Roma' "a"),
     socknarOfIntresse as (SELECT fastighetsFilter.socken SockenX, concat(Trakt, SPACE(1), Blockenhet) FAStighet, Shape from sde_gsd.gng.AY_0980 x inner join fastighetsFilter on left(x.TRAKT, len(fastighetsFilter.socken)) = fastighetsFilter.socken),

     byggnad_yta as (select andamal_1T Byggnadstyp, Shape from sde_gsd.gng.BY_0980),
     q as (Select Byggnadstyp, socknarOfIntresse.fastighet Fastighetsbeteckning, byggnad_yta.SHAPE
           from byggnad_yta
                    inner join socknarOfIntresse on byggnad_yta.Shape.STIntersects(socknarOfIntresse.shape) = 1)
select Fastighetsbeteckning, Byggnadstyp, shape ByggShape

from (select *, row_number() over (partition by Fastighetsbeteckning order by Byggnadstyp ) orderz from q) z
where
      --orderz = 1 and
       --socken =     'Fröjel' and
Fastighetsbeteckning like 'fröjel ansarve%' or
Fastighetsbeteckning in (           'Fröjel Hallgårds 1:2',

'Fröjel Göstavs 5:1',

'Fröjel Ansarve 1:16'
)
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

select top 10 * from reningarUNion
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'')
union select OBJECTID, nullif(Anslutna_fastigheter_1,'')
union select OBJECTID, nullif(Anslutna_fastigheter_2,'')
union select OBJECTID, nullif(Anslutna_fastigheter_3,'')
union select OBJECTID, nullif(Anslutna_fastigheter_4,'')
union select OBJECTID, nullif(Anslutna_fastigheter_5,'')
union select OBJECTID, nullif(Anslutna_fastigheter_6,'')
union select OBJECTID, nullif(Anslutna_fastigheter_7,'')
union select OBJECTID, nullif(Anslutna_fastigheter_8,'')
union select OBJECTID, nullif(Anslutna_fastigheter_9,'')
union select OBJECTID, nullif(Anslutna_fastigheter_10,'')
)

select top 100 * from fkopl
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'')
union select OBJECTID, nullif(Anslutna_fastigheter_1,'')
union select OBJECTID, nullif(Anslutna_fastigheter_2,'')
union select OBJECTID, nullif(Anslutna_fastigheter_3,'')
union select OBJECTID, nullif(Anslutna_fastigheter_4,'')
union select OBJECTID, nullif(Anslutna_fastigheter_5,'')
union select OBJECTID, nullif(Anslutna_fastigheter_6,'')
union select OBJECTID, nullif(Anslutna_fastigheter_7,'')
union select OBJECTID, nullif(Anslutna_fastigheter_8,'')
union select OBJECTID, nullif(Anslutna_fastigheter_9,'')
union select OBJECTID, nullif(Anslutna_fastigheter_10,'')
)

select top 100 * from fkopl
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion

    where fastighetsKoppling is not null
)

select top 100 * from fkopl
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion


)

select top 100 * from fkopl where fastighetsKoppling is not null
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select concat('M',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select concat('N',OBJECTID) OBJECTID , Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select concat('S',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion


)

select top 100 * from fkopl where fastighetsKoppling is not null
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select concat('M',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select concat('N',OBJECTID) OBJECTID , Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select concat('S',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion


)

select top 100 * from fkopl where fastighetsKoppling is not null
order by fastighetsKoppling
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select concat('M',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select concat('N',OBJECTID) OBJECTID , Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select concat('S',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion


)

select top 100 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select concat('M',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select concat('N',OBJECTID) OBJECTID , Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select concat('S',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion


)

select top 100 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select concat('M',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select concat('N',OBJECTID) OBJECTID , Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select concat('S',OBJECTID) OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from bad order by f,OBJECTID
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from  sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P inner join (select OBJECTID from bad where f = 'M') q on (q.OBJECTID)
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from  sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P mp inner join (select OBJECTID from bad where f = 'M') q on q.OBJECTID = mp.OBJECTID
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from  sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P mp where objectid in (select OBJECTID from bad where f = 'M')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from  sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')
union
select * from  sde_miljo_halsoskydd.gng.RENING_NORRA_P  where objectid in (select OBJECTID from bad where f = 'N')
union
select * from  sde_miljo_halsoskydd.gng.RENING_SODRA_P  where objectid in (select OBJECTID from bad where f = 'S')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')
;
select * from sde_miljo_halsoskydd.gng.RENING_NORRA_P  where objectid in (select OBJECTID from bad where f = 'N')
;
select * from sde_miljo_halsoskydd.gng.RENING_SODRA_P  where objectid in (select OBJECTID from bad where f = 'S')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

--select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')
;
select * from sde_miljo_halsoskydd.gng.RENING_NORRA_P  where objectid in (select OBJECTID from bad where f = 'N')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

--select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')

select * from sde_miljo_halsoskydd.gng.RENING_NORRA_P  where objectid in (select OBJECTID from bad where f = 'N')
;-- -. . -..- - / . -. - .-. -.--
with reningarUNion      as (
select 'M' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
select 'N' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
select 'S' f ,OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,fkopl as (
	select f,OBJECTID, nullif(Fastighet_rening,'') fastighetsKoppling from reningarUNion
--union 	select OBJECTID, nullif(Kommentarer,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_1,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_2,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_3,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_4,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_5,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_6,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_7,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_8,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_9,'') from reningarUNion
union 	select f,OBJECTID, nullif(Anslutna_fastigheter_10,'') from reningarUNion
)

,bad as (select top 20 * from fkopl where len(fastighetsKoppling) > 1 and fastighetsKoppling is not null
order by fastighetsKoppling)

--select * from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P where objectid in (select OBJECTID from bad where f = 'M')

--select * from sde_miljo_halsoskydd.gng.RENING_NORRA_P  where objectid in (select OBJECTID from bad where f = 'N');
select * from sde_miljo_halsoskydd.gng.RENING_SODRA_P  where objectid in (select OBJECTID from bad where f = 'S')
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(charindex(' ',@searchstring,0))
select @searchSocken
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
select @searchSocken
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))

declare @searchFastighet nvarchar(50);
set @searchFastighet = left(@searchstring,charindex(' ',@searchstring,len(@searchSocken)))
select @searchFastighet
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))

declare @searchFastighet nvarchar(50);
set @searchFastighet = left(RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)),charindex(' ',@searchstring,len(@searchSocken)))
select @searchFastighet
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))

declare @searchFastighet nvarchar(50);
set @searchFastighet = trim(left(RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)),charindex(' ',@searchstring,len(@searchSocken))))
select @searchFastighet
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))

declare @searchFastighet nvarchar(50);
set @searchFastighet = left(RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1),charindex(' ',@searchstring,len(@searchSocken)))
select @searchFastighet
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @searchSocken nvarchar(50);
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
declare @withoutSocken nvarchar(50);
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
select @withoutSocken
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @searchFastighet nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);

set @searchstring = 'FARDHEM GARDARVE 1:8'
set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)

set @searchFastighetsNr = '1:10'

set @searchFastighet = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
select @searchFastighet
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);

set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
 select right(@withoutSocken,len(@withoutSocken)/2)
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken)-1)
select @searchFastighetsNr
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr



;

with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			Utskick_datum utskGiltigtTom,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as smalldatetime) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as smalldatetime) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				cast(Tillstand_giltigt_tomas smalldatetime),		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as smalldatetime) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				cast(Tillstand_giltigt_tomas as smalldatetime),		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as smalldatetime) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				cast(Tillstand_giltigt_tom as smalldatetime),		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as datetime2) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				cast(Tillstand_giltigt_tom as datetime2),		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, nullif(Arendenummer,'')  dianr, 	Status,			cast(Utskick_datum as date) utskGiltigtTom ,			'' m2M3,						Slamhamtning,  						Beslut_datum, 	Utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, 	q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, nullif(Diarienummer,'') , 		Typ_byggnad,				cast(Tillstand_giltigt_tom as date),		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, 	q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   			null,							null, 		concat(Storlek_m2,''),  					reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, 	q)
	    from rening
    )

select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allR
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(Storlek_m2,''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(Antal_byggnader,'') byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_tillstand,'')	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(Storlek_m2,''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	concat(Antal_hushall_rening,'')		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(round(Storlek_m3,1),':t:',round(Storlek_m,1),':m2:',round(Storlek_m2,1))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(Storlek_m2,''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(try_cast(Storlek_m2 as int),''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(dianr, Status, utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50);
declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);
set @searchstring = 'FARDHEM GARDARVE 1:8'

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(try_cast(Storlek_m2 as int),''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(try_cast(Storlek_m2 as int),''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(try_cast(Storlek_m2 as int),''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, cast(Beslut_datum as date)  Beslut_datum, cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,			'' m2M3,										Slamhamtning,  						Beslut_datum, 	utforddatum,  	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		Tillstand_giltigt_tom,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)	,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 				concat(try_cast(Storlek_m2 as int),''),  								reningstyp, 						Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_rening as int) 		,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			Utskick_datum,						'' m2M3,													Slamhamtning,						Beslut_datum,	utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		try_cast(Tillstand_giltigt_tom as date) ,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 							concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						Beslut_datum,	Utford_datum,	try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						Beslut_datum,	utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,		concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	Beslut_datum, 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 							concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						Beslut_datum,	Utford_datum,	try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),''),	utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),	Utford_datum,	try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 	Utford_datum, 	try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),	Utford_datum,	try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'stora ire'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'st ire'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'ire'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro ire'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),':t:',try_cast(Storlek_m as int),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro ire'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),nullif(concat(':t:',try_cast(Storlek_m as int)),':t:0'),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
declare @searchstring nvarchar(50); set @searchstring = 'lärbro ire 1:17'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)

,enskiltSokterm as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)
,unionMedSearchTerm as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,flaggSearchTerm as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,flagg as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
from flaggSearchTerm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,enskilt as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
from enskiltSokterm
where q like concat(@searchSocken,'%')
	and
      q like  concat('%',@fastighetsBlock,'%')
      	and
      q like  concat('%',@searchFastighetsNr,'%'))

,rening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
from unionMedSearchTerm
where q like concat(@searchSocken,'%')
      and
      q like  concat('%',@fastighetsBlock,'%')
      and
      q like  concat('%',@searchFastighetsNr,'%'))
,allR as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from flagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),nullif(concat(':t:',try_cast(Storlek_m as int)),':t:0'),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from enskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from rening
    )
,allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from allR

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
--handles even incomplete searchterms as long as socken is complete
declare @searchstring nvarchar(50); set @searchstring = 'annex 1:17'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)


,    reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    enskiltSokterm     as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,    reningSokterm	as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3,
    				Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8,
    				Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,    flaggSearchTerm    as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,    SearchFlagg        as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
			    from flaggSearchTerm where
		      q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    SearchEnskilt      as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
		from enskiltSokterm
		where q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    searchRening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
		from reningSokterm
		where q like concat(@searchSocken,'%')
		      and
		      q like  concat('%',@fastighetsBlock,'%')
		      and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    unionReningFLaggEnskilt as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from SearchFlagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),nullif(concat(':t:',try_cast(Storlek_m as int)),':t:0'),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from SearchEnskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from searchRening
    )

,    allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from unionReningFLaggEnskilt

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
--handles even incomplete searchterms as long as socken is complete
declare @searchstring nvarchar(50); set @searchstring = 'bro annex'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)


,    reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    enskiltSokterm     as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,    reningSokterm	as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3,
    				Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8,
    				Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,    flaggSearchTerm    as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,    SearchFlagg        as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
			    from flaggSearchTerm where
		      q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    SearchEnskilt      as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
		from enskiltSokterm
		where q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    searchRening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
		from reningSokterm
		where q like concat(@searchSocken,'%')
		      and
		      q like  concat('%',@fastighetsBlock,'%')
		      and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    unionReningFLaggEnskilt as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from SearchFlagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),nullif(concat(':t:',try_cast(Storlek_m as int)),':t:0'),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from SearchEnskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from searchRening
    )

,    allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from unionReningFLaggEnskilt

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status
;-- -. . -..- - / . -. - .-. -.--
--handles even incomplete searchterms as long as socken is complete
declare @searchstring nvarchar(50); set @searchstring = 'FARDHEM GARDARVE 1:8'

declare @fastighetsBlock nvarchar(50);
declare @withoutSocken nvarchar(50);
declare @searchSocken nvarchar(50);
declare @searchFastighetsNr nvarchar(50);
declare @halfWithoutSocken nvarchar(50);

set @searchSocken = left(@searchstring,charindex(' ',@searchstring,0))
set @withoutSocken = RIGHT(@searchstring,LEN(@searchstring)-LEN(@searchSocken)-1)
set @fastighetsBlock = left(@withoutSocken,charindex(' ',@searchstring,len(@searchSocken)))
-- Statement : is always on second half of string
set @halfWithoutSocken = right(@withoutSocken,len(@withoutSocken)/2)
set @searchFastighetsNr = RIGHT(@halfWithoutSocken,LEN(@halfWithoutSocken)-charindex(' ',@halfWithoutSocken))
select @searchFastighetsNr

;
with enskiltUnion as (
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_NORRA_P union
    select OBJECTID, Diarienummer, Fastighet_tilstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_mellersta_P union
    select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning
    	    from sde_miljo_halsoskydd.gng.ENSKILT_AVLOPP_SODRA_P)


,    reningarUNion      as (
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_MELLERSTA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_NORRA_P union
	select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10
		from sde_miljo_halsoskydd.gng.RENING_SODRA_P)

,    enskiltSokterm     as (select *, concat(Fastighet_rening,Fastighet_tillstand,Anteckning) q from enskiltUnion)
,    reningSokterm	as (select *,concat(Fastighet_rening, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3,
    				Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8,
    				Anslutna_fastigheter_9, Anslutna_fastigheter_10) q from reningarUNion)
,    flaggSearchTerm    as ( select *, concat(Fastighet_tillstand,FASTIGHET) q from sde_miljo_halsoskydd.gng.FLAGGSKIKTET_P)

,    SearchFlagg        as (select OBJECTID, FASTIGHET, Fastighet_tillstand, Arendenummer, Beslut_datum, Status, Utskick_datum, Anteckning, Utforddatum, Slamhamtning, Antal_byggnader, alltidsant, Shape, GDB_GEOMATTR_DATA, skapad_datum, andrad_datum, q
			    from flaggSearchTerm where
		      q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    SearchEnskilt      as (select OBJECTID, Diarienummer, Fastighet_tillstand, Typ_byggnad, Antal_hushall_tillstand, Fastighet_rening, Typ_slamavskiljare, Storlek_m3, Typ_rening, Storlek_m2, Typ_sluten_tank, Storlek_m, Beslut_datum, Utford_datum, Avgift, Tillstand_giltigt_tom, Anteckning, q
		from enskiltSokterm
		where q like concat(@searchSocken,'%')
			and
		      q like  concat('%',@fastighetsBlock,'%')
			and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    searchRening as (select OBJECTID, Fastighet_rening, Antal_hushall_rening, reningstyp, Storlek_m2, Beslut_datum, Utford_datum, Kommentarer, Anslutna_fastigheter_1, Anslutna_fastigheter_2, Anslutna_fastigheter_3, Anslutna_fastigheter_4, Anslutna_fastigheter_5, Anslutna_fastigheter_6, Anslutna_fastigheter_7, Anslutna_fastigheter_8, Anslutna_fastigheter_9, Anslutna_fastigheter_10, q
		from reningSokterm
		where q like concat(@searchSocken,'%')
		      and
		      q like  concat('%',@fastighetsBlock,'%')
		      and
		      q like  concat('%',@searchFastighetsNr,'%'))

,    unionReningFLaggEnskilt as (
    select 'flagg' typ,	OBJECTID, 	     FASTIGHET, 	Fastighet_tillstand, Arendenummer, 	Status,			concat(try_cast(Utskick_datum as date),'') Utskick_datum,						'' m2M3,													Slamhamtning,						concat(try_cast(Beslut_datum as date),'') Beslut_datum,	concat(try_cast(utforddatum as date),'') utforddatum, 	concat(try_cast(Antal_byggnader as int),'')   byggnader	,concat(Anteckning, q) other
	    from SearchFlagg union
    select 'enskilt' typ,	OBJECTID,    Fastighet_rening, 	Fastighet_tillstand, Diarienummer, 	Typ_byggnad,		concat(try_cast(Tillstand_giltigt_tom as date),'')  ,							concat(try_cast(Storlek_m3 as int),nullif(concat(':t:',try_cast(Storlek_m as int)),':t:0'),':m2:',try_cast(Storlek_m2 as int))   ,	concat(Typ_slamavskiljare,Typ_sluten_tank,Typ_rening), 	concat(try_cast(Beslut_datum as date),''), 		concat(try_cast(Utford_datum as date),''), 		try_cast(Antal_hushall_tillstand as int)		,concat(Anteckning, q, Avgift)
	    from SearchEnskilt union
    select 'rening' typ,	OBJECTID,    Fastighet_rening, 	null,		     null, 	   	null,			null, 													concat(try_cast(Storlek_m2 as int),''),  									reningstyp,						concat(try_cast(Beslut_datum as date),''),		concat(try_cast(Utford_datum as date),''),		try_cast(Antal_hushall_rening as int) 			,concat(Kommentarer, q)
	    from searchRening
    )

,    allRFormat as (
    select typ, OBJECTID, FASTIGHET, Fastighet_tillstand, nullif(Arendenummer,'')  dianr, Status, try_cast(Utskick_datum as date) utskGiltigtTom , m2M3, Slamhamtning, try_cast(Beslut_datum as date)  Beslut_datum, try_cast(Utforddatum as date) utforddatum, cast(byggnader as int) byggnader, other
    from unionReningFLaggEnskilt

)


select typ, OBJECTID ,
       iif(fastighet is not null and Fastighet_tillstand is not null And (fastighet <> Fastighet_tillstand),
    concat(fastighet, ',til:',Fastighet_tillstand),
    coalesce(Fastighet_tillstand, fastighet)
    ) as fas,   concat(nullif(concat(dianr,'_'),'_'), nullif(concat(Status,'_'),'_'),utskGiltigtTom) status, m2M3, Slamhamtning, Beslut_datum, Utforddatum, byggnader, other
from allRFormat
order by Fastighet_tillstand,FASTIGHET ,dianr,Status