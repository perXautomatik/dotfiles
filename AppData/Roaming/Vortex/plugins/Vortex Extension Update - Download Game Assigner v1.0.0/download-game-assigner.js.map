{"version":3,"sources":["webpack://download-game-assigner/webpack/bootstrap","webpack://download-game-assigner/./src/actions.ts","webpack://download-game-assigner/./src/index.ts","webpack://download-game-assigner/./src/reducer.ts","webpack://download-game-assigner/./src/views/DownloadAssignmentSettings.tsx","webpack://download-game-assigner/external \"react\"","webpack://download-game-assigner/external \"react-bootstrap\"","webpack://download-game-assigner/external \"react-i18next\"","webpack://download-game-assigner/external \"react-redux\"","webpack://download-game-assigner/external \"redux-act\"","webpack://download-game-assigner/external \"vortex-api\""],"names":[],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFa;AACb,8CAA8C,cAAc;AAC5D;AACA,oBAAoB,mBAAO,CAAC,4BAAW;AACvC,2GAA2G,2DAA2D;AACtK,iHAAiH,0BAA0B;AAC3I,2FAA2F;;;;;;;;;;;;;ACN9E;AACb,8CAA8C,cAAc;AAC5D,qBAAqB,mBAAO,CAAC,8BAAY;AACzC,kBAAkB,mBAAO,CAAC,mCAAW;AACrC;AACA;AACA,+EAA+E,mBAAO,CAAC,sFAAoC,WAAW,EAAE;AACxI;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,kBAAkB;AAClE;AACA;AACA,iGAAiG;AACjG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qGAAqG,yHAAyH;AAC9N;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;;;;;;;;;;;;;ACrCa;AACb,8CAA8C,cAAc;AAC5D;AACA,gBAAgB,mBAAO,CAAC,mCAAW;AACnC,qBAAqB,mBAAO,CAAC,8BAAY;AACzC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClDa;AACb,8CAA8C,cAAc;AAC5D,cAAc,mBAAO,CAAC,oBAAO;AAC7B,qBAAqB,mBAAO,CAAC,8BAAY;AACzC,0BAA0B,mBAAO,CAAC,wCAAiB;AACnD,wBAAwB,mBAAO,CAAC,oCAAe;AAC/C,sBAAsB,mBAAO,CAAC,gCAAa;AAC3C,kBAAkB,mBAAO,CAAC,oCAAY;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,eAAe,IAAI;AACnB,eAAe,0BAA0B;AACzC;AACA;AACA;AACA;AACA;AACA,4DAA4D,mEAAmE;AAC/H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,6FAA6F;AAC5J,mEAAmE,YAAY;AAC/E;AACA;AACA,+DAA+D,2FAA2F;AAC1J,mEAAmE,YAAY;AAC/E;AACA;AACA,+EAA+E,uGAAuG;AACtL,4EAA4E,cAAc;AAC1F;AACA,+DAA+D,2DAA2D;AAC1H,4DAA4D,gBAAgB;AAC5E;AACA;AACA;AACA;AACA,eAAe,aAAa;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,0BAA0B;AACzC,eAAe,iBAAiB;AAChC;AACA;AACA,qBAAqB,0BAA0B;AAC/C;AACA;AACA;AACA;AACA,eAAe,kBAAkB;AACjC;AACA;AACA;AACA,eAAe,0BAA0B;AACzC,eAAe,kBAAkB;AACjC;AACA;AACA;AACA,kFAAkF,iBAAiB;AACnG;AACA;AACA;AACA,eAAe,iCAAiC;AAChD;AACA;AACA,+CAA+C,0BAA0B,WAAW,IAAI,WAAW,YAAY,EAAE,GAAG;AACpH;AACA;AACA;AACA,mEAAmE,2DAA2D;AAC9H,gEAAgE,iBAAiB;AACjF,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kGAAkG;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC5HA,kC;;;;;;;;;;;ACAA,4C;;;;;;;;;;;ACAA,0C;;;;;;;;;;;ACAA,wC;;;;;;;;;;;ACAA,sC;;;;;;;;;;;ACAA,uC","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.resetAutoAssignRules = exports.deleteAutoAssignRule = exports.addAutoAssignRule = void 0;\r\nconst redux_act_1 = require(\"redux-act\");\r\nexports.addAutoAssignRule = redux_act_1.createAction('ADD_AUTOASSIGN_RULE', (downloadFor, assignGame) => ({ downloadFor, assignGame, timeAdded: new Date().getTime() }));\r\nexports.deleteAutoAssignRule = redux_act_1.createAction('DELETE_AUTOASSIGN_RULE', (downloadFor, assignGame) => ({ downloadFor, assignGame }));\r\nexports.resetAutoAssignRules = redux_act_1.createAction('RESET_AUTOASSIGN_RULES', () => ({}));\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst vortex_api_1 = require(\"vortex-api\");\r\nconst reducer_1 = require(\"./reducer\");\r\nfunction main(context) {\r\n    context.registerReducer(['settings', 'downloadAssigner'], reducer_1.autoAssignerReducer);\r\n    context.registerSettings('Download', vortex_api_1.util.LazyComponent(() => require('./views/DownloadAssignmentSettings')), () => { }, () => true, 100);\r\n    context.once(() => {\r\n        context.api.onStateChange(['persistent', 'downloads', 'files'], (prevDLs, newDLs) => updateGames(prevDLs, newDLs, context.api));\r\n    });\r\n    return true;\r\n}\r\nfunction updateGames(prevDLs, newDLs, api) {\r\n    const prevIds = Object.keys(prevDLs);\r\n    const newIds = Object.keys(newDLs);\r\n    if (prevIds.length < newIds.length) {\r\n        const found = newIds.filter(dl => prevIds.indexOf(dl) === -1)\r\n            .map(newDownload => (Object.assign({ id: newDownload }, newDLs[newDownload])));\r\n        const state = api.store.getState();\r\n        const rules = vortex_api_1.util.getSafe(state, ['settings', 'downloadAssigner', 'rules'], []);\r\n        const games = vortex_api_1.util.getSafe(state, ['settings', 'gameMode', 'discovered'], {});\r\n        found.forEach((newDownload) => {\r\n            const filteredRules = rules.filter(r => newDownload.game.includes(r.downloadFor));\r\n            filteredRules.forEach((rule) => {\r\n                var _a;\r\n                if (!games[rule.assignGame])\r\n                    return;\r\n                if (newDownload.game.includes(rule.downloadFor) && !newDownload.game.includes(rule.assignGame)) {\r\n                    const newGames = [...newDownload.game];\r\n                    newGames.push(rule.assignGame);\r\n                    vortex_api_1.log('info', 'Automatically assigning compatible game to download', { dl: ((_a = newDownload.modInfo) === null || _a === void 0 ? void 0 : _a.name) || newDownload.id, game: rule.assignGame });\r\n                    api.store.dispatch(vortex_api_1.actions.setCompatibleGames(newDownload.id, newGames));\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\nexports.default = main;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.autoAssignerReducer = void 0;\r\nconst actions = require(\"./actions\");\r\nconst vortex_api_1 = require(\"vortex-api\");\r\nconst defaultRules = [\r\n    {\r\n        downloadFor: \"enderal\",\r\n        assignGame: \"skyrim\",\r\n        timeAdded: 0\r\n    },\r\n    {\r\n        downloadFor: \"enderalspecialedition\",\r\n        assignGame: \"skyrimse\",\r\n        timeAdded: 1\r\n    },\r\n    {\r\n        downloadFor: \"skyrimse\",\r\n        assignGame: \"skyrimvr\",\r\n        timeAdded: 3\r\n    },\r\n    {\r\n        downloadFor: \"fallout4\",\r\n        assignGame: \"fallout4vr\",\r\n        timeAdded: 2\r\n    },\r\n    {\r\n        downloadFor: \"xcom2\",\r\n        assignGame: \"xcom2-wotc\",\r\n        timeAdded: 4\r\n    }\r\n];\r\nconst autoAssignerReducer = {\r\n    reducers: {\r\n        [actions.addAutoAssignRule]: (state, payload) => {\r\n            const rules = vortex_api_1.util.getSafe(state, ['rules'], []);\r\n            rules.push(payload);\r\n            return vortex_api_1.util.setSafe(state, ['rules'], rules);\r\n        },\r\n        [actions.deleteAutoAssignRule]: (state, payload) => {\r\n            const rules = vortex_api_1.util.getSafe(state, ['rules'], []);\r\n            const newRules = rules.filter(r => r.assignGame !== payload.assignGame && r.downloadFor !== payload.downloadFor);\r\n            return vortex_api_1.util.setSafe(state, ['rules'], newRules);\r\n        },\r\n        [actions.resetAutoAssignRules]: (state, payload) => vortex_api_1.util.setSafe(state, ['rules'], [...defaultRules]),\r\n    },\r\n    defaults: {\r\n        rules: [...defaultRules]\r\n    }\r\n};\r\nexports.autoAssignerReducer = autoAssignerReducer;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst React = require(\"react\");\r\nconst vortex_api_1 = require(\"vortex-api\");\r\nconst react_bootstrap_1 = require(\"react-bootstrap\");\r\nconst react_i18next_1 = require(\"react-i18next\");\r\nconst react_redux_1 = require(\"react-redux\");\r\nconst actions_1 = require(\"../actions\");\r\nclass DownloadAssignmentSettings extends vortex_api_1.ComponentEx {\r\n    constructor(props) {\r\n        super(props);\r\n        this.initState({\r\n            downloadFor: '',\r\n            assignGame: ''\r\n        });\r\n    }\r\n    render() {\r\n        const { t } = this.props;\r\n        const { downloadFor, assignGame } = this.state;\r\n        const recommendTitle = t('Use a set of recommended defaults based on the common combinations of games this feature would be useful for.');\r\n        return (React.createElement(\"form\", null,\r\n            React.createElement(react_bootstrap_1.FormGroup, null,\r\n                React.createElement(react_bootstrap_1.ControlLabel, null,\r\n                    t('Download Game Assignments'),\r\n                    React.createElement(vortex_api_1.More, { id: 'more-downloadassigner', name: t('Download Game Assignment') }, t('When Vortex adds a new download from Nexus Mods, these settings will be used to decide which games to assign as compatible to each archive.'\r\n                        + 'This will prevent Vortex from reminding you that the mod was intended for a different game during installation and ensure it correctly shows up '\r\n                        + 'in the downloads tab while your preferred game is active.'))),\r\n                React.createElement(react_bootstrap_1.HelpBlock, null, t('Add a new row to automatically mark downloaded archives for the game in the first column as compatible with game in the second column.')),\r\n                React.createElement(react_bootstrap_1.Table, null,\r\n                    React.createElement(\"thead\", null,\r\n                        React.createElement(\"tr\", null,\r\n                            React.createElement(\"th\", null, t('Downloads for')),\r\n                            React.createElement(\"th\", null, t('are compatible with')),\r\n                            React.createElement(\"th\", null, t('Actions')))),\r\n                    React.createElement(\"tbody\", null,\r\n                        React.createElement(\"tr\", null,\r\n                            React.createElement(\"td\", null,\r\n                                React.createElement(\"select\", { className: 'form-control', value: downloadFor, onChange: this.handleDownloadFor.bind(this) },\r\n                                    React.createElement(\"option\", { value: '' }, t('Select game')),\r\n                                    this.gameList(true))),\r\n                            React.createElement(\"td\", null,\r\n                                React.createElement(\"select\", { className: 'form-control', value: assignGame, onChange: this.handleAssignGame.bind(this) },\r\n                                    React.createElement(\"option\", { value: '' }, t('Select game')),\r\n                                    this.gameList(false))),\r\n                            React.createElement(\"td\", null,\r\n                                React.createElement(react_bootstrap_1.Button, { disabled: !downloadFor || !assignGame, title: t('Add new rule'), onClick: this.addNewRule.bind(this) },\r\n                                    React.createElement(vortex_api_1.Icon, { name: 'add' })))),\r\n                        this.ruleList())),\r\n                React.createElement(react_bootstrap_1.Button, { title: recommendTitle, onClick: this.defaults.bind(this) },\r\n                    React.createElement(vortex_api_1.Icon, { name: 'smart' }),\r\n                    \" \",\r\n                    t('Use recommended')))));\r\n    }\r\n    handleDownloadFor(event) {\r\n        const { assignGame } = this.state;\r\n        let newValue = event.target.value;\r\n        if (assignGame === newValue)\r\n            newValue = undefined;\r\n        this.nextState.downloadFor = newValue;\r\n    }\r\n    handleAssignGame(event) {\r\n        const { downloadFor } = this.state;\r\n        let newValue = event.target.value;\r\n        if (downloadFor === newValue)\r\n            newValue = undefined;\r\n        this.nextState.assignGame = newValue;\r\n    }\r\n    addNewRule() {\r\n        const { downloadFor, assignGame } = this.state;\r\n        const { addRule, rules } = this.props;\r\n        const existingRule = rules.find(r => r.assignGame === assignGame && r.downloadFor === downloadFor);\r\n        if (!existingRule)\r\n            addRule({ downloadFor, assignGame });\r\n        this.nextState.assignGame = '';\r\n        this.nextState.downloadFor = '';\r\n    }\r\n    defaults() {\r\n        const { resetToDefaults } = this.props;\r\n        resetToDefaults();\r\n    }\r\n    gameList(primary) {\r\n        const { downloadFor, assignGame } = this.state;\r\n        const { games, gameName } = this.props;\r\n        const filterValue = !primary ? downloadFor : assignGame;\r\n        const filteredGames = games.filter(g => g.id !== filterValue)\r\n            .sort((a, b) => gameName(a.id) < gameName(b.id) ? -1 : 1);\r\n        const options = filteredGames.map(game => (React.createElement(\"option\", { value: game.id }, gameName(game.id))));\r\n        return (React.createElement(React.Fragment, null, options));\r\n    }\r\n    ruleList() {\r\n        const { t, rules, deleteRule, gameName } = this.props;\r\n        const listing = rules.sort(sortRulesByTime).map(rule => {\r\n            const ruleAdded = (rule.timeAdded > 0) ? new Date(rule.timeAdded).toLocaleDateString() : t('by default');\r\n            return (React.createElement(\"tr\", { title: t('Rule created {{ruleAdded}}', { replace: { ruleAdded } }) },\r\n                React.createElement(\"td\", null, gameName(rule.downloadFor)),\r\n                React.createElement(\"td\", null, gameName(rule.assignGame)),\r\n                React.createElement(\"td\", null,\r\n                    React.createElement(react_bootstrap_1.Button, { onClick: () => deleteRule(rule), title: t('Delete rule') },\r\n                        React.createElement(vortex_api_1.Icon, { name: 'delete' })))));\r\n        });\r\n        return (React.createElement(React.Fragment, null, listing));\r\n    }\r\n}\r\nfunction sortRulesByTime(a, b) {\r\n    return a.timeAdded > b.timeAdded ? 1 : -1;\r\n}\r\nfunction mapStateToProps(state) {\r\n    const rules = vortex_api_1.util.getSafe(state, ['settings', 'downloadAssigner', 'rules'], []);\r\n    const discovered = vortex_api_1.util.getSafe(state, ['settings', 'gameMode', 'discovered'], {});\r\n    const games = vortex_api_1.selectors.knownGames(state);\r\n    return {\r\n        rules,\r\n        discovered,\r\n        games,\r\n        gameName: (gameId) => vortex_api_1.selectors.gameName(state, gameId)\r\n    };\r\n}\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        addRule: (rule) => dispatch(actions_1.addAutoAssignRule(rule.downloadFor, rule.assignGame)),\r\n        deleteRule: (rule) => dispatch(actions_1.deleteAutoAssignRule(rule.downloadFor, rule.assignGame)),\r\n        resetToDefaults: () => dispatch(actions_1.resetAutoAssignRules(undefined)),\r\n    };\r\n}\r\nexports.default = react_i18next_1.withTranslation(['download-game-assigner'])(react_redux_1.connect(mapStateToProps, mapDispatchToProps)(DownloadAssignmentSettings));\r\n","module.exports = require(\"react\");","module.exports = require(\"react-bootstrap\");","module.exports = require(\"react-i18next\");","module.exports = require(\"react-redux\");","module.exports = require(\"redux-act\");","module.exports = require(\"vortex-api\");"],"sourceRoot":""}